{"ast":null,"code":"import fetch from 'cross-fetch';\nimport AppbaseAnalytics from '@appbaseio/analytics';\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nvar highlightResults = function highlightResults(result) {\n  var data = _extends({}, result);\n\n  if (data.highlight) {\n    Object.keys(data.highlight).forEach(function (highlightItem) {\n      var _extends2;\n\n      var highlightValue = data.highlight[highlightItem][0];\n      data._source = _extends({}, data._source, (_extends2 = {}, _extends2[highlightItem] = highlightValue, _extends2));\n    });\n  }\n\n  return data;\n};\n\nvar parseHits = function parseHits(hits) {\n  var results = [];\n\n  if (hits) {\n    results = [].concat(hits).map(function (item) {\n      var streamProps = {};\n\n      if (item._updated) {\n        streamProps._updated = item._updated;\n      } else if (item._deleted) {\n        streamProps._deleted = item._deleted;\n      }\n\n      var data = highlightResults(item);\n      var result = Object.keys(data).filter(function (key) {\n        return key !== '_source';\n      }).reduce(function (obj, key) {\n        // eslint-disable-next-line\n        obj[key] = data[key];\n        return obj;\n      }, _extends({}, data._source, {}, streamProps));\n      return result;\n    });\n  }\n\n  return results;\n}; // flattens a nested array\n\n\nvar flatten = function flatten(arr) {\n  return arr.reduce(function (flat, toFlatten) {\n    return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);\n  }, []);\n}; // helper function to extract suggestions\n\n\nvar extractSuggestion = function extractSuggestion(val) {\n  if (typeof val === 'object') {\n    if (Array.isArray(val)) {\n      return flatten(val);\n    }\n\n    return null;\n  }\n\n  return val;\n};\n\nvar getSuggestions = function getSuggestions(fields, suggestions, currentValue) {\n  if (fields === void 0) {\n    fields = [];\n  }\n\n  if (currentValue === void 0) {\n    currentValue = '';\n  }\n\n  var suggestionsList = [];\n  var labelsList = [];\n\n  var populateSuggestionsList = function populateSuggestionsList(val, parsedSource, source) {\n    // check if the suggestion includes the current value\n    // and not already included in other suggestions\n    var isWordMatch = currentValue.trim().split(' ').some(function (term) {\n      return String(val).toLowerCase().includes(term);\n    });\n\n    if (isWordMatch && !labelsList.includes(val) || source._promoted) {\n      var defaultOption = {\n        label: val,\n        value: val,\n        source: source\n      };\n      labelsList = [].concat(labelsList, [val]);\n      suggestionsList = [].concat(suggestionsList, [defaultOption]);\n    }\n  };\n\n  var parseField = function parseField(parsedSource, field, source) {\n    if (field === void 0) {\n      field = '';\n    }\n\n    if (source === void 0) {\n      source = parsedSource;\n    }\n\n    if (typeof parsedSource === 'object') {\n      var fieldNodes = field.split('.');\n      var label = parsedSource[fieldNodes[0]];\n\n      if (label) {\n        if (fieldNodes.length > 1) {\n          // nested fields of the 'foo.bar.zoo' variety\n          var children = field.substring(fieldNodes[0].length + 1);\n\n          if (Array.isArray(label)) {\n            label.forEach(function (arrayItem) {\n              parseField(arrayItem, children, source);\n            });\n          } else {\n            parseField(label, children, source);\n          }\n        } else {\n          var val = extractSuggestion(label);\n\n          if (val) {\n            if (Array.isArray(val)) {\n              val.forEach(function (suggestion) {\n                return populateSuggestionsList(suggestion, parsedSource, source);\n              });\n            } else {\n              populateSuggestionsList(val, parsedSource, source);\n            }\n          }\n        }\n      }\n    }\n  };\n\n  suggestions.forEach(function (item) {\n    var _score = item._score,\n        _index = item._index,\n        _type = item._type,\n        _id = item._id;\n\n    var source = _extends({}, item, {\n      _id: _id,\n      _index: _index,\n      _score: _score,\n      _type: _type\n    });\n\n    fields.forEach(function (field) {\n      parseField(source, field);\n    });\n  });\n  return suggestionsList;\n};\n\nfunction parseCompAggToHits(aggFieldName, buckets) {\n  if (buckets === void 0) {\n    buckets = [];\n  }\n\n  return buckets.map(function (bucket) {\n    // eslint-disable-next-line camelcase\n    var doc_count = bucket.doc_count,\n        key = bucket.key,\n        hitsData = bucket[aggFieldName];\n    return _extends({\n      _doc_count: doc_count,\n      _key: key[aggFieldName]\n    }, hitsData.hits.hits[0]);\n  });\n}\n\nvar Results = /*#__PURE__*/function () {\n  // An array of results obtained from the applied query.\n  // Raw response returned by ES query\n  // Results parser\n  function Results(data) {\n    var _this = this;\n\n    _defineProperty(this, \"data\", void 0);\n\n    _defineProperty(this, \"raw\", void 0);\n\n    _defineProperty(this, \"parseResults\", void 0);\n\n    _defineProperty(this, \"setRaw\", function (rawResponse) {\n      // set response\n      _this.raw = rawResponse;\n\n      if (rawResponse.hits && rawResponse.hits.hits) {\n        _this.setData(rawResponse.hits.hits);\n      }\n    });\n\n    this.data = data || [];\n  } // Total number of results found\n\n\n  var _proto = Results.prototype; // Method to set data explicitly\n\n  _proto.setData = function setData(data) {\n    // parse hits\n    var filteredResults = parseHits(data); // filter results & remove duplicates if any\n\n    if (this.promotedData.length) {\n      var ids = this.promotedData.map(function (item) {\n        return item._id;\n      }).filter(Boolean);\n\n      if (ids) {\n        filteredResults = filteredResults.filter(function (item) {\n          return !ids.includes(item._id);\n        });\n      }\n\n      filteredResults = [].concat(this.promotedData.map(function (dataItem) {\n        return _extends({}, dataItem, {\n          _promoted: true\n        });\n      }), filteredResults);\n    } // set data\n\n\n    if (this.parseResults) {\n      this.data = this.parseResults(filteredResults, data);\n    } else {\n      this.data = filteredResults;\n    }\n  };\n\n  _createClass(Results, [{\n    key: \"numberOfResults\",\n    get: function get() {\n      // calculate from raw response\n      if (this.raw && this.raw.hits) {\n        return typeof this.raw.hits.total === 'object' ? this.raw.hits.total.value : this.raw.hits.total;\n      }\n\n      return 0;\n    } // Total time taken by request (in ms)\n\n  }, {\n    key: \"time\",\n    get: function get() {\n      // calculate from raw response\n      if (this.raw) {\n        return this.raw.took;\n      }\n\n      return 0;\n    } // no of hidden results found\n\n  }, {\n    key: \"hidden\",\n    get: function get() {\n      if (this.raw && this.raw.hits) {\n        return this.raw.hits.hidden || 0;\n      }\n\n      return 0;\n    } // no of promoted results found\n\n  }, {\n    key: \"promoted\",\n    get: function get() {\n      if (this.raw && this.raw.promoted) {\n        return this.raw.promoted.length;\n      }\n\n      return 0;\n    } // An array of promoted results obtained from the applied query.\n\n  }, {\n    key: \"promotedData\",\n    get: function get() {\n      if (this.raw && this.raw.promoted) {\n        return this.raw.promoted || [];\n      }\n\n      return [];\n    } // An object of raw response as-is from elasticsearch query\n\n  }, {\n    key: \"rawData\",\n    get: function get() {\n      return this.raw || {};\n    } // object of custom data applied through queryRules\n    // only works when `enableAppbase=true`\n\n  }, {\n    key: \"customData\",\n    get: function get() {\n      if (this.raw && this.raw.customData) {\n        return this.raw.customData || {};\n      }\n\n      return {};\n    }\n  }]);\n\n  return Results;\n}();\n\nvar Observable = /*#__PURE__*/function () {\n  function Observable() {\n    _defineProperty(this, \"observers\", void 0);\n\n    this.observers = [];\n  }\n\n  var _proto = Observable.prototype;\n\n  _proto.subscribe = function subscribe(fn, propertiesToSubscribe) {\n    this.observers.push({\n      callback: fn,\n      properties: propertiesToSubscribe\n    });\n  };\n\n  _proto.unsubscribe = function unsubscribe(fn) {\n    if (fn) {\n      this.observers = this.observers.filter(function (item) {\n        if (item.callback !== fn) {\n          return item;\n        }\n\n        return null;\n      });\n    } else {\n      this.observers = [];\n    }\n  };\n\n  _proto.next = function next(o, property, thisObj) {\n    var scope = thisObj || window;\n    this.observers.forEach(function (item) {\n      // filter by subscribed properties\n      if (item.properties === undefined) {\n        item.callback.call(scope, o);\n      } else if (item.properties instanceof Array && item.properties.length && item.properties.includes(property)) {\n        item.callback.call(scope, o);\n      } else if (typeof item.properties === 'string' && item.properties && item.properties === property) {\n        item.callback.call(scope, o);\n      }\n    });\n  };\n\n  return Observable;\n}();\n\nvar CompositeAggregationResults = /*#__PURE__*/function () {\n  // An array of composite aggregations obtained from the applied aggs in options.\n  // useful when loading data of greater size\n  // Raw aggregations returned by ES query\n  function CompositeAggregationResults(data) {\n    _defineProperty(this, \"data\", void 0);\n\n    _defineProperty(this, \"afterKey\", void 0);\n\n    _defineProperty(this, \"raw\", void 0);\n\n    this.data = data || [];\n  } // An object of raw response as-is from elasticsearch query\n\n\n  var _proto = CompositeAggregationResults.prototype;\n\n  _proto.setRaw = function setRaw(rawResponse) {\n    // set response\n    this.raw = rawResponse;\n    if (rawResponse.after_key) this.setAfterKey(rawResponse.after_key);\n  };\n\n  _proto.setAfterKey = function setAfterKey(key) {\n    this.afterKey = key;\n  } // Method to set data explicitly\n  ;\n\n  _proto.setData = function setData(aggField, data) {\n    // parse aggregation buckets\n    this.data = parseCompAggToHits(aggField, data);\n  };\n\n  _createClass(CompositeAggregationResults, [{\n    key: \"rawData\",\n    get: function get() {\n      return this.raw || {};\n    }\n  }]);\n\n  return CompositeAggregationResults;\n}();\n\nvar MIC_STATUS = {\n  inactive: 'INACTIVE',\n  active: 'ACTIVE',\n  denied: 'DENIED'\n};\nvar REQUEST_STATUS = {\n  inactive: 'INACTIVE',\n  pending: 'PENDING',\n  error: 'ERROR'\n};\nvar defaultOptions = {\n  triggerQuery: true,\n  triggerSuggestionsQuery: false,\n  stateChanges: true\n};\nvar defaultOption = {\n  stateChanges: true\n};\n\nvar Searchbase = /*#__PURE__*/function () {\n  // es index name\n  // es url\n  // use rs v3 api\n  // get query suggestions from `.suggestions` index\n  // auth credentials if any\n  // to enable the recording of analytics\n  // input value i.e query term\n  // custom headers object\n  // suggestions\n  // query suggestions\n  // composite aggregations\n  // suggestions query error\n  // results\n  // results query error\n  // state changes subject\n  // request status\n  // suggestions request status\n  // following are the es query options\n\n  /* ------------- change events -------------------------------- */\n  // called when value changes\n  // called when results change\n  // called when suggestions change\n  // called when query suggestions change\n  // called when composite aggregations change\n  // called when there is an error while fetching results\n  // called when there is an error while fetching suggestions\n  // called when request status changes\n  // called when suggestions request status changes\n  // called when query changes\n  // called when suggestions query changes\n  // called when mic status changes\n\n  /* ---- callbacks to create the side effects while querying ----- */\n\n  /* ------ Private properties only for the internal use ----------- */\n  // counterpart of the query\n  // counterpart of the suggestions query\n  // mic status\n  // mic instance\n  // analytics instance\n  // query search ID\n  function Searchbase(_ref) {\n    var _this = this;\n\n    var index = _ref.index,\n        url = _ref.url,\n        enableAppbase = _ref.enableAppbase,\n        enableQuerySuggestions = _ref.enableQuerySuggestions,\n        credentials = _ref.credentials,\n        appbaseConfig = _ref.appbaseConfig,\n        headers = _ref.headers,\n        value = _ref.value,\n        _suggestions = _ref.suggestions,\n        querySuggestions = _ref.querySuggestions,\n        _results = _ref.results,\n        fuzziness = _ref.fuzziness,\n        searchOperators = _ref.searchOperators,\n        queryFormat = _ref.queryFormat,\n        size = _ref.size,\n        from = _ref.from,\n        dataField = _ref.dataField,\n        aggregationField = _ref.aggregationField,\n        includeFields = _ref.includeFields,\n        excludeFields = _ref.excludeFields,\n        transformQuery = _ref.transformQuery,\n        transformSuggestionsQuery = _ref.transformSuggestionsQuery,\n        transformRequest = _ref.transformRequest,\n        transformResponse = _ref.transformResponse,\n        beforeValueChange = _ref.beforeValueChange,\n        sortBy = _ref.sortBy,\n        nestedField = _ref.nestedField,\n        sortOptions = _ref.sortOptions,\n        sortByField = _ref.sortByField,\n        highlight = _ref.highlight,\n        highlightField = _ref.highlightField;\n\n    _defineProperty(this, \"index\", void 0);\n\n    _defineProperty(this, \"url\", void 0);\n\n    _defineProperty(this, \"enableAppbase\", void 0);\n\n    _defineProperty(this, \"enableQuerySuggestions\", void 0);\n\n    _defineProperty(this, \"credentials\", void 0);\n\n    _defineProperty(this, \"appbaseConfig\", void 0);\n\n    _defineProperty(this, \"value\", void 0);\n\n    _defineProperty(this, \"headers\", void 0);\n\n    _defineProperty(this, \"suggestions\", void 0);\n\n    _defineProperty(this, \"querySuggestions\", void 0);\n\n    _defineProperty(this, \"aggregationData\", void 0);\n\n    _defineProperty(this, \"suggestionsError\", void 0);\n\n    _defineProperty(this, \"results\", void 0);\n\n    _defineProperty(this, \"error\", void 0);\n\n    _defineProperty(this, \"stateChanges\", void 0);\n\n    _defineProperty(this, \"requestStatus\", void 0);\n\n    _defineProperty(this, \"suggestionsRequestStatus\", void 0);\n\n    _defineProperty(this, \"nestedField\", void 0);\n\n    _defineProperty(this, \"queryFormat\", void 0);\n\n    _defineProperty(this, \"searchOperators\", void 0);\n\n    _defineProperty(this, \"size\", void 0);\n\n    _defineProperty(this, \"from\", void 0);\n\n    _defineProperty(this, \"fuzziness\", void 0);\n\n    _defineProperty(this, \"sortBy\", void 0);\n\n    _defineProperty(this, \"sortByField\", void 0);\n\n    _defineProperty(this, \"dataField\", void 0);\n\n    _defineProperty(this, \"aggregationField\", void 0);\n\n    _defineProperty(this, \"includeFields\", void 0);\n\n    _defineProperty(this, \"excludeFields\", void 0);\n\n    _defineProperty(this, \"sortOptions\", void 0);\n\n    _defineProperty(this, \"highlight\", void 0);\n\n    _defineProperty(this, \"highlightField\", void 0);\n\n    _defineProperty(this, \"onValueChange\", void 0);\n\n    _defineProperty(this, \"onResults\", void 0);\n\n    _defineProperty(this, \"onSuggestions\", void 0);\n\n    _defineProperty(this, \"onQuerySuggestions\", void 0);\n\n    _defineProperty(this, \"onAggregationData\", void 0);\n\n    _defineProperty(this, \"onError\", void 0);\n\n    _defineProperty(this, \"onSuggestionsError\", void 0);\n\n    _defineProperty(this, \"onRequestStatusChange\", void 0);\n\n    _defineProperty(this, \"onSuggestionsRequestStatusChange\", void 0);\n\n    _defineProperty(this, \"onQueryChange\", void 0);\n\n    _defineProperty(this, \"onSuggestionsQueryChange\", void 0);\n\n    _defineProperty(this, \"onMicStatusChange\", void 0);\n\n    _defineProperty(this, \"transformQuery\", void 0);\n\n    _defineProperty(this, \"transformSuggestionsQuery\", void 0);\n\n    _defineProperty(this, \"transformRequest\", void 0);\n\n    _defineProperty(this, \"transformResponse\", void 0);\n\n    _defineProperty(this, \"beforeValueChange\", void 0);\n\n    _defineProperty(this, \"_query\", void 0);\n\n    _defineProperty(this, \"_suggestionsQuery\", void 0);\n\n    _defineProperty(this, \"_queryOptions\", void 0);\n\n    _defineProperty(this, \"_micStatus\", void 0);\n\n    _defineProperty(this, \"_micInstance\", void 0);\n\n    _defineProperty(this, \"_analyticsInstance\", void 0);\n\n    _defineProperty(this, \"_queryId\", void 0);\n\n    _defineProperty(this, \"onMicClick\", function (micOptions, options) {\n      if (micOptions === void 0) {\n        micOptions = {};\n      }\n\n      if (options === void 0) {\n        options = defaultOptions;\n      }\n\n      var prevStatus = _this._micStatus;\n\n      if (typeof window !== 'undefined') {\n        window.SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition || null;\n      }\n\n      if (window && window.SpeechRecognition && prevStatus !== MIC_STATUS.denied) {\n        if (prevStatus === MIC_STATUS.active) {\n          _this._setMicStatus(MIC_STATUS.inactive, options);\n        }\n\n        var _window = window,\n            SpeechRecognition = _window.SpeechRecognition;\n\n        if (_this._micInstance) {\n          _this._stopMic();\n\n          return;\n        }\n\n        _this._micInstance = new SpeechRecognition();\n        _this._micInstance.continuous = true;\n        _this._micInstance.interimResults = true;\n        Object.assign(_this._micInstance, micOptions);\n\n        _this._micInstance.start();\n\n        _this._micInstance.onstart = function () {\n          _this._setMicStatus(MIC_STATUS.active, options);\n        };\n\n        _this._micInstance.onresult = function (_ref2) {\n          var results = _ref2.results;\n\n          if (results && results[0] && results[0].isFinal) {\n            _this._stopMic();\n          }\n\n          _this._handleVoiceResults({\n            results: results\n          }, options);\n        };\n\n        _this._micInstance.onerror = function (e) {\n          if (e.error === 'no-speech' || e.error === 'audio-capture') {\n            _this._setMicStatus(MIC_STATUS.inactive, options);\n          } else if (e.error === 'not-allowed') {\n            _this._setMicStatus(MIC_STATUS.denied, options);\n          }\n\n          console.error(e);\n        };\n      }\n    });\n\n    _defineProperty(this, \"recordClick\", function (objects, isSuggestionClick) {\n      if (isSuggestionClick === void 0) {\n        isSuggestionClick = false;\n      }\n\n      if (_this._analyticsInstance && _this._queryId) {\n        _this._analyticsInstance.click({\n          queryID: _this._queryId,\n          objects: objects,\n          isSuggestionClick: isSuggestionClick\n        });\n      }\n    });\n\n    _defineProperty(this, \"recordConversions\", function (objects) {\n      if (_this._analyticsInstance && _this._queryId) {\n        _this._analyticsInstance.conversion({\n          queryID: _this._queryId,\n          objects: objects\n        });\n      }\n    });\n\n    _defineProperty(this, \"_handleVoiceResults\", function (_ref3, options) {\n      var results = _ref3.results;\n\n      if (options === void 0) {\n        options = defaultOptions;\n      }\n\n      if (results && results[0] && results[0].isFinal && results[0][0] && results[0][0].transcript && results[0][0].transcript.trim()) {\n        _this.setValue(results[0][0].transcript.trim(), options);\n      }\n    });\n\n    _defineProperty(this, \"_stopMic\", function () {\n      if (_this._micInstance) {\n        _this._micInstance.stop();\n\n        _this._micInstance = null;\n\n        _this._setMicStatus(MIC_STATUS.inactive);\n      }\n    });\n\n    _defineProperty(this, \"_setMicStatus\", function (status, options) {\n      if (options === void 0) {\n        options = defaultOptions;\n      }\n\n      var prevStatus = _this._micStatus;\n      _this._micStatus = status;\n\n      _this._applyOptions(options, 'micStatus', prevStatus, _this._micStatus);\n    });\n\n    _defineProperty(this, \"_parseSuggestions\", function (suggestions, sourceSuggestions) {\n      var fields = _this.getDataFields();\n\n      if (fields.length === 0 && sourceSuggestions && Array.isArray(sourceSuggestions) && sourceSuggestions.length > 0 && sourceSuggestions[0] && sourceSuggestions[0]._source) {\n        // Extract fields from _source\n        fields = Object.keys(sourceSuggestions[0]._source);\n      }\n\n      return getSuggestions(fields, suggestions, _this.value).slice(0, _this.size);\n    });\n\n    _defineProperty(this, \"_parseQuerySuggestions\", function (suggestions) {\n      var fields = ['key', 'key.autosuggest', 'key.search'];\n      return getSuggestions(fields, suggestions, _this.value);\n    });\n\n    if (!index) {\n      throw new Error('Please provide a valid index.');\n    }\n\n    if (!url) {\n      throw new Error('Please provide a valid url.');\n    }\n\n    if (!(enableAppbase || dataField)) {\n      throw new Error('Please provide a valid data field.');\n    }\n\n    this.index = index;\n    this.url = url;\n    this.enableAppbase = enableAppbase || false;\n    this.enableQuerySuggestions = enableQuerySuggestions || false;\n    this.appbaseConfig = appbaseConfig;\n    this._analyticsInstance = AppbaseAnalytics.init({\n      index: index,\n      url: url,\n      credentials: credentials\n    });\n    this.dataField = dataField;\n    this.aggregationField = aggregationField;\n    this.credentials = credentials || '';\n    this.nestedField = nestedField;\n    this.queryFormat = queryFormat || 'or';\n    this.fuzziness = fuzziness || 0;\n    this.searchOperators = searchOperators || false;\n    this.size = Number(size) || 10;\n    this.from = Number(from) || 0;\n    this.sortBy = sortBy;\n    this.includeFields = includeFields || ['*'];\n    this.excludeFields = excludeFields || [];\n    this.sortOptions = sortOptions || null;\n    this.sortByField = sortByField;\n    this.highlight = highlight;\n    this.highlightField = highlightField;\n    this.requestStatus = REQUEST_STATUS.inactive;\n    this.suggestionsRequestStatus = REQUEST_STATUS.inactive;\n    this.transformRequest = transformRequest || null;\n    this.transformResponse = transformResponse || null;\n    this.transformQuery = transformQuery || null;\n    this.transformSuggestionsQuery = transformSuggestionsQuery || null;\n    this.beforeValueChange = beforeValueChange || null; // Initialize the state changes observable\n\n    this.stateChanges = new Observable(); // Initialize the results\n\n    this.suggestions = new Results(_suggestions); // Add suggestions parser\n\n    this.suggestions.parseResults = this._parseSuggestions; // Initialize query suggestions\n\n    this.querySuggestions = new Results(querySuggestions); // Add suggestions parser\n\n    this.querySuggestions.parseResults = this._parseQuerySuggestions;\n    this.results = new Results(_results); // composite aggs instance\n\n    this.aggregationData = new CompositeAggregationResults(); // Initialize headers\n\n    this.headers = {\n      Accept: 'application/json',\n      'Content-Type': 'application/json'\n    };\n\n    if (this.credentials) {\n      this.headers = _extends({}, this.headers, {\n        Authorization: \"Basic \" + btoa(this.credentials)\n      });\n    }\n\n    if (headers) {\n      this.setHeaders(headers, {\n        stateChanges: false\n      });\n    }\n\n    if (value) {\n      this.setValue(value, {\n        stateChanges: true\n      });\n    } else {\n      this.value = '';\n    }\n  } // getters\n\n\n  var _proto = Searchbase.prototype; // Method to subscribe the state changes\n\n  _proto.subscribeToStateChanges = function subscribeToStateChanges(fn, propertiesToSubscribe) {\n    this.stateChanges.subscribe(fn, propertiesToSubscribe);\n  } // Method to unsubscribe the state changes\n  ;\n\n  _proto.unsubscribeToStateChanges = function unsubscribeToStateChanges(fn) {\n    this.stateChanges.unsubscribe(fn);\n  } // Method to set the custom headers\n  ;\n\n  _proto.setHeaders = function setHeaders(headers, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.headers;\n    this.headers = _extends({}, this.headers, {}, headers);\n\n    this._applyOptions(options, 'headers', prev, this.headers);\n  } // Method to set the size option\n  ;\n\n  _proto.setSize = function setSize(size, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.size;\n    this.size = size;\n\n    this._applyOptions(options, 'size', prev, this.size);\n  } // Method to set the from option\n  ;\n\n  _proto.setFrom = function setFrom(from, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.from;\n    this.from = from;\n\n    this._applyOptions(options, 'from', prev, this.from);\n  } // Method to set the fuzziness option\n  ;\n\n  _proto.setFuzziness = function setFuzziness(fuzziness, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.fuzziness;\n    this.fuzziness = fuzziness;\n\n    this._applyOptions(options, 'fuzziness', prev, this.fuzziness);\n  } // Method to set the includeFields option\n  ;\n\n  _proto.setIncludeFields = function setIncludeFields(includeFields, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.includeFields;\n    this.includeFields = includeFields;\n\n    this._applyOptions(options, 'includeFields', prev, includeFields);\n  } // Method to set the excludeFields option\n  ;\n\n  _proto.setExcludeFields = function setExcludeFields(excludeFields, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.excludeFields;\n    this.excludeFields = excludeFields;\n\n    this._applyOptions(options, 'excludeFields', prev, excludeFields);\n  } // Method to set the sortBy option\n  ;\n\n  _proto.setSortBy = function setSortBy(sortBy, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.sortBy;\n    this.sortBy = sortBy;\n\n    this._applyOptions(options, 'sortBy', prev, sortBy);\n  } // Method to set the sortByField option\n  ;\n\n  _proto.setSortByField = function setSortByField(sortByField, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.sortByField;\n    this.sortByField = sortByField;\n\n    this._applyOptions(options, 'sortByField', prev, sortByField);\n  } // Method to set the nestedField option\n  ;\n\n  _proto.setNestedField = function setNestedField(nestedField, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.nestedField;\n    this.nestedField = nestedField;\n\n    this._applyOptions(options, 'nestedField', prev, nestedField);\n  } // Method to set the dataField option\n  ;\n\n  _proto.setDataField = function setDataField(dataField, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.dataField;\n    this.dataField = dataField;\n\n    this._applyOptions(options, 'dataField', prev, dataField);\n  } // Method to set the custom results\n  ;\n\n  _proto.setResults = function setResults(results, options) {\n    if (options === void 0) {\n      options = defaultOption;\n    }\n\n    if (results) {\n      var _prev = this.results;\n      this.results = new Results(results);\n\n      this._applyOptions({\n        stateChanges: options.stateChanges\n      }, 'results', _prev, this.results);\n    }\n  } // Method to set the custom suggestions\n  ;\n\n  _proto.setSuggestions = function setSuggestions(suggestions, options) {\n    if (options === void 0) {\n      options = defaultOption;\n    }\n\n    if (suggestions) {\n      var _prev2 = this.suggestions;\n      this.suggestions = new Results(suggestions);\n      this.suggestions.parseResults = this._parseSuggestions;\n\n      this._applyOptions({\n        stateChanges: options.stateChanges\n      }, 'suggestions', _prev2, this.suggestions);\n    }\n  } // Method to set the value\n  ;\n\n  _proto.setValue = function setValue(value, options) {\n    var _this2 = this;\n\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var performUpdate = function performUpdate() {\n      var prev = _this2.value;\n      _this2.value = value;\n\n      _this2._applyOptions(options, 'value', prev, _this2.value);\n    };\n\n    if (this.beforeValueChange) {\n      this.beforeValueChange(value).then(performUpdate)[\"catch\"](function (e) {\n        console.warn('beforeValueChange rejected the promise with ', e);\n      });\n    } else {\n      performUpdate();\n    }\n  } // mic event\n  ; // Method to execute the query\n\n\n  _proto.triggerQuery = function triggerQuery(options) {\n    var _this3 = this;\n\n    if (options === void 0) {\n      options = defaultOption;\n    }\n\n    var handleError = function handleError(err) {\n      _this3._setError(err, {\n        stateChanges: options.stateChanges\n      });\n\n      console.error(err);\n      return Promise.reject(err);\n    };\n\n    try {\n      this._updateQuery();\n\n      this._setRequestStatus(REQUEST_STATUS.pending);\n\n      var transformQuery = this.transformQuery ? this.transformQuery(this.query) : new Promise(function (res) {\n        return res(_this3.query);\n      });\n      return transformQuery.then(function (finalQuery) {\n        _this3._fetchRequest(finalQuery).then(function (results) {\n          _this3._setRequestStatus(REQUEST_STATUS.inactive);\n\n          var prev = _this3.results;\n          var rawResults = results;\n          if (_this3.enableAppbase) rawResults = results.SearchResult;\n\n          _this3.results.setRaw(rawResults);\n\n          _this3._applyOptions({\n            stateChanges: options.stateChanges\n          }, 'results', prev, _this3.results);\n\n          return Promise.resolve(rawResults);\n        })[\"catch\"](handleError);\n      })[\"catch\"](handleError);\n    } catch (err) {\n      return handleError(err);\n    }\n  } // Method to execute the suggestions query\n  ;\n\n  _proto.triggerSuggestionsQuery = function triggerSuggestionsQuery(options) {\n    var _this4 = this;\n\n    if (options === void 0) {\n      options = defaultOption;\n    }\n\n    var handleError = function handleError(err) {\n      _this4._setSuggestionsError(err, {\n        stateChanges: options.stateChanges\n      });\n\n      console.error(err);\n      return Promise.reject(err);\n    };\n\n    try {\n      this._updateSuggestionsQuery();\n\n      this._setSuggestionsRequestStatus(REQUEST_STATUS.pending);\n\n      var transformSuggestionsQuery = this.transformSuggestionsQuery ? this.transformSuggestionsQuery(this.suggestionsQuery) : new Promise(function (res) {\n        return res(_this4.suggestionsQuery);\n      });\n      return transformSuggestionsQuery.then(function (finalQuery) {\n        _this4._fetchRequest(finalQuery).then(function (suggestions) {\n          var rawSuggestions = suggestions;\n          if (_this4.enableAppbase) rawSuggestions = suggestions.DataSearch;\n\n          if (_this4.enableAppbase && _this4.enableQuerySuggestions) {\n            _this4._fetchRequest(_this4.getSuggestionsQuery(), true).then(function (rawQuerySuggestions) {\n              _this4._setSuggestionsRequestStatus(REQUEST_STATUS.inactive);\n\n              _this4._handleQuerySuggestionsResponse(rawQuerySuggestions, options);\n            })[\"catch\"](handleError);\n          } else _this4._setSuggestionsRequestStatus(REQUEST_STATUS.inactive);\n\n          if (rawSuggestions.aggregations) {\n            _this4._handleCompositeAggsResponse(_this4.aggregationField, rawSuggestions.aggregations, options);\n          }\n\n          var prev = _this4.suggestions;\n\n          _this4.suggestions.setRaw(rawSuggestions);\n\n          _this4._applyOptions({\n            stateChanges: options.stateChanges\n          }, 'suggestions', prev, _this4.suggestions);\n\n          return Promise.resolve(rawSuggestions);\n        })[\"catch\"](handleError);\n      })[\"catch\"](handleError);\n    } catch (err) {\n      return handleError(err);\n    }\n  };\n\n  _proto.getSuggestionsQuery = function getSuggestionsQuery() {\n    return {\n      query: [{\n        id: 'DataSearch__suggestions',\n        dataField: ['key', 'key.autosuggest', 'key.search'],\n        searchOperators: this.searchOperators,\n        size: 5,\n        value: this.value,\n        defaultQuery: {\n          sort: [{\n            count: {\n              order: 'desc'\n            }\n          }]\n        }\n      }]\n    };\n  }\n  /*\n   methods to record analytics\n  */\n  // use this methods to record a search click event\n  ;\n\n  _proto._handleCompositeAggsResponse = function _handleCompositeAggsResponse(aggregationField, aggsResponse, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.aggregationData;\n    this.aggregationData.setRaw(aggsResponse[aggregationField]);\n    this.aggregationData.setData(aggregationField, aggsResponse[aggregationField].buckets);\n\n    this._applyOptions({\n      stateChanges: options.stateChanges\n    }, 'aggregations', prev, this.aggregationData);\n  };\n\n  _proto._handleTransformResponse = function _handleTransformResponse(res) {\n    if (this.transformResponse && typeof this.transformResponse === 'function') {\n      return this.transformResponse(res);\n    }\n\n    return new Promise(function (resolve) {\n      return resolve(res);\n    });\n  };\n\n  _proto._handleTransformRequest = function _handleTransformRequest(requestOptions) {\n    if (this.transformRequest && typeof this.transformRequest === 'function') {\n      return this.transformRequest(requestOptions);\n    }\n\n    return new Promise(function (resolve) {\n      return resolve(requestOptions);\n    });\n  };\n\n  _proto._handleQuerySuggestionsResponse = function _handleQuerySuggestionsResponse(rawQuerySuggestions, options) {\n    var prev = this.querySuggestions;\n    var querySuggestions = rawQuerySuggestions && rawQuerySuggestions.DataSearch__suggestions;\n    this.querySuggestions.setRaw(querySuggestions);\n\n    this._applyOptions({\n      stateChanges: options.stateChanges\n    }, 'querySuggestions', prev, this.querySuggestions);\n  };\n\n  _proto._fetchRequest = function _fetchRequest(requestBody, isQuerySuggestionsAPI) {\n    var _this5 = this;\n\n    if (isQuerySuggestionsAPI === void 0) {\n      isQuerySuggestionsAPI = false;\n    }\n\n    var requestOptions = {\n      method: 'POST',\n      body: JSON.stringify(requestBody),\n      headers: _extends({}, this.headers)\n    };\n    return new Promise(function (resolve, reject) {\n      _this5._handleTransformRequest(requestOptions).then(function (finalRequestOptions) {\n        // set timestamp in request\n        var timestamp = Date.now();\n        var suffix = '_search';\n        if (_this5.enableAppbase) suffix = '_reactivesearch.v3';\n        var index = isQuerySuggestionsAPI ? '.suggestions' : _this5.index;\n        return fetch(_this5.url + \"/\" + index + \"/\" + suffix, finalRequestOptions).then(function (res) {\n          var responseHeaders = res.headers; // set search id\n\n          if (res.headers) {\n            _this5._queryId = res.headers.get('X-Search-Id') || null;\n          }\n\n          if (res.status >= 500) {\n            return reject(res);\n          }\n\n          if (res.status >= 400) {\n            return reject(res);\n          }\n\n          return res.json().then(function (data) {\n            _this5._handleTransformResponse(data).then(function (transformedData) {\n              if (transformedData && Object.prototype.hasOwnProperty.call(transformedData, 'error')) {\n                reject(transformedData);\n              }\n\n              var response = _extends({}, transformedData, {\n                _timestamp: timestamp,\n                _headers: responseHeaders\n              });\n\n              return resolve(response);\n            })[\"catch\"](function (e) {\n              console.warn('transformResponse rejected the promise with ', e);\n              return reject(e);\n            });\n          });\n        })[\"catch\"](function (e) {\n          return reject(e);\n        });\n      })[\"catch\"](function (e) {\n        console.warn('transformRequest rejected the promise with ', e);\n        return reject(e);\n      });\n    });\n  };\n\n  _proto._setSuggestionsError = function _setSuggestionsError(suggestionsError, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    this._setSuggestionsRequestStatus(REQUEST_STATUS.error);\n\n    var prev = this.suggestionsError;\n    this.suggestionsError = suggestionsError;\n\n    this._applyOptions(options, 'suggestionsError', prev, this.suggestionsError);\n  };\n\n  _proto._setError = function _setError(error, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    this._setRequestStatus(REQUEST_STATUS.error);\n\n    var prev = this.error;\n    this.error = error;\n\n    this._applyOptions(options, 'error', prev, this.error);\n  };\n\n  _proto._setRequestStatus = function _setRequestStatus(requestStatus) {\n    var prev = this.requestStatus;\n    this.requestStatus = requestStatus;\n\n    this._applyOptions({\n      stateChanges: true\n    }, 'requestStatus', prev, this.requestStatus);\n  };\n\n  _proto._setSuggestionsRequestStatus = function _setSuggestionsRequestStatus(suggestionsRequestStatus) {\n    var prev = this.suggestionsRequestStatus;\n    this.suggestionsRequestStatus = suggestionsRequestStatus;\n\n    this._applyOptions({\n      stateChanges: true\n    }, 'suggestionsRequestStatus', prev, this.suggestionsRequestStatus);\n  } // Method to set the default query value\n  ;\n\n  _proto._updateQuery = function _updateQuery(query, queryOptions) {\n    var prevQuery;\n\n    if (this.enableAppbase) {\n      prevQuery = _extends({}, this._query);\n      this._query = {\n        query: [_extends({}, this.getAppbaseSuggestionsQuery(), {\n          execute: false\n        }), this.getAppbaseResultQuery()],\n        settings: this.getAppbaseSettings()\n      };\n    } else prevQuery = this.getPreviousQuery(query, queryOptions);\n\n    this._applyOptions({\n      stateChanges: false\n    }, 'query', prevQuery, this._query);\n  };\n\n  _proto.getAppbaseSettings = function getAppbaseSettings() {\n    var _this$appbaseConfig = this.appbaseConfig,\n        recordAnalytics = _this$appbaseConfig.recordAnalytics,\n        customEvents = _this$appbaseConfig.customEvents,\n        enableQueryRules = _this$appbaseConfig.enableQueryRules,\n        userId = _this$appbaseConfig.userId;\n    return {\n      recordAnalytics: recordAnalytics,\n      customEvents: customEvents,\n      enableQueryRules: enableQueryRules,\n      userId: userId\n    };\n  };\n\n  _proto.getAppbaseResultQuery = function getAppbaseResultQuery() {\n    return {\n      id: 'SearchResult',\n      dataField: this.getDataFields(),\n      from: this.from,\n      size: this.size,\n      sortBy: this.sortBy,\n      includeFields: this.includeFields,\n      excludeFields: this.excludeFields,\n      react: {\n        and: 'DataSearch'\n      }\n    };\n  };\n\n  _proto.getPreviousQuery = function getPreviousQuery(query, queryOptions) {\n    // Set default query here\n    var finalQueryOptions = Searchbase.generateQueryOptions({\n      excludeFields: this.excludeFields,\n      includeFields: this.includeFields,\n      size: this.size,\n      from: this.from,\n      sortBy: this.sortBy,\n      sortByField: this.sortByField,\n      sortOptions: this.sortOptions\n    });\n    /**\n     * First priority goes to the custom query set by user otherwise execute the default query\n     * If none of the two exists execute the match_all\n     */\n\n    var finalQuery = query || Searchbase.defaultQuery(this.value, {\n      dataField: this.dataField,\n      searchOperators: this.searchOperators,\n      queryFormat: this.queryFormat,\n      fuzziness: this.fuzziness,\n      nestedField: this.nestedField\n    }) || {\n      match_all: {}\n    };\n    var prevQuery = this._query;\n    this._query = _extends({\n      query: finalQuery\n    }, Searchbase.highlightQuery(this.highlight, this.highlightField, this.dataField), {}, finalQueryOptions, {}, queryOptions);\n    return prevQuery;\n  };\n\n  _proto._updateSuggestionsQuery = function _updateSuggestionsQuery(query, queryOptions) {\n    var prevQuery;\n\n    if (this.enableAppbase) {\n      prevQuery = _extends({}, this._suggestionsQuery);\n      this._suggestionsQuery = {\n        query: [this.getAppbaseSuggestionsQuery()],\n        settings: this.getAppbaseSettings()\n      };\n    } else prevQuery = this.getPreviousSuggestionsQuery(query, queryOptions);\n\n    this._applyOptions({\n      stateChanges: false\n    }, 'suggestionsQuery', prevQuery, this._suggestionsQuery);\n  };\n\n  _proto.getAppbaseSuggestionsQuery = function getAppbaseSuggestionsQuery() {\n    return {\n      id: 'DataSearch',\n      dataField: this.getDataFields(),\n      value: this.value,\n      queryFormat: this.queryFormat,\n      nestedField: this.nestedField,\n      from: this.from,\n      size: this.size,\n      sortBy: this.sortBy,\n      aggregationField: this.aggregationField,\n      includeFields: this.includeFields,\n      excludeFields: this.excludeFields,\n      fuzziness: this.fuzziness,\n      searchOperators: this.searchOperators,\n      highlight: this.highlight,\n      highlightField: this.highlightField\n    };\n  };\n\n  _proto.getPreviousSuggestionsQuery = function getPreviousSuggestionsQuery(query, queryOptions) {\n    // Set default suggestions query here\n    var finalQueryOptions = Searchbase.generateQueryOptions({\n      aggregationField: this.aggregationField,\n      size: this.size\n    });\n    /**\n     * First priority goes to the custom query set by user otherwise execute the default query\n     * If none of the two exists execute the match_all\n     */\n\n    var finalQuery = query || Searchbase.defaultQuery(this.value, {\n      dataField: this.dataField,\n      searchOperators: this.searchOperators,\n      queryFormat: this.queryFormat,\n      fuzziness: this.fuzziness,\n      nestedField: this.nestedField\n    }) || {\n      match_all: {}\n    };\n\n    var prevQuery = _extends({}, this._suggestionsQuery);\n\n    this._suggestionsQuery = _extends({\n      query: finalQuery\n    }, Searchbase.highlightQuery(this.highlight, this.highlightField, this.dataField), {}, finalQueryOptions, {}, queryOptions);\n    return prevQuery;\n  };\n\n  _proto.getDataFields = function getDataFields() {\n    var fields = [];\n\n    if (this.dataField === 'string') {\n      fields = [this.dataField];\n    } else if (Array.isArray(this.dataField)) {\n      this.dataField.forEach(function (dataField) {\n        if (typeof dataField === 'object') {\n          fields.push(dataField.field);\n        } else {\n          fields.push(dataField);\n        }\n      });\n    }\n\n    return fields;\n  } // Method to apply the changed based on set options\n  ;\n\n  _proto._applyOptions = function _applyOptions(options, key, prevValue, nextValue) {\n    // Trigger mic events\n    if (key === 'micStatus' && this.onMicStatusChange) {\n      this.onMicStatusChange(nextValue, prevValue);\n    } // Trigger events\n\n\n    if (key === 'query' && this.onQueryChange) {\n      this.onQueryChange(nextValue, prevValue);\n    }\n\n    if (key === 'suggestionsQuery' && this.onSuggestionsQueryChange) {\n      this.onSuggestionsQueryChange(nextValue, prevValue);\n    }\n\n    if (key === 'value' && this.onValueChange) {\n      this.onValueChange(nextValue, prevValue);\n    }\n\n    if (key === 'error' && this.onError) {\n      this.onError(nextValue);\n    }\n\n    if (key === 'suggestionsError' && this.onSuggestionsError) {\n      this.onSuggestionsError(nextValue);\n    }\n\n    if (key === 'results' && this.onResults) {\n      this.onResults(nextValue, prevValue);\n    }\n\n    if (key === 'suggestions' && this.onSuggestions) {\n      this.onSuggestions(nextValue, prevValue);\n    }\n\n    if (key === 'querySuggestions' && this.onQuerySuggestions) {\n      this.onQuerySuggestions(nextValue, prevValue);\n    }\n\n    if (key === 'aggregations' && this.onAggregationData) {\n      this.onAggregationData(nextValue, prevValue);\n    }\n\n    if (key === 'requestStatus' && this.onRequestStatusChange) {\n      this.onRequestStatusChange(nextValue, prevValue);\n    }\n\n    if (key === 'suggestionsRequestStatus' && this.onSuggestionsRequestStatusChange) {\n      this.onSuggestionsRequestStatusChange(nextValue, prevValue);\n    }\n\n    if (options.triggerQuery) {\n      this.triggerQuery();\n    }\n\n    if (options.triggerSuggestionsQuery) {\n      this.triggerSuggestionsQuery();\n    }\n\n    if (options.stateChanges !== false) {\n      var _this$stateChanges$ne;\n\n      this.stateChanges.next((_this$stateChanges$ne = {}, _this$stateChanges$ne[key] = {\n        prev: prevValue,\n        next: nextValue\n      }, _this$stateChanges$ne), key);\n    }\n  };\n\n  _createClass(Searchbase, [{\n    key: \"micStatus\",\n    get: function get() {\n      return this._micStatus;\n    }\n  }, {\n    key: \"micInstance\",\n    get: function get() {\n      return this._micInstance;\n    }\n  }, {\n    key: \"micActive\",\n    get: function get() {\n      return this._micStatus === MIC_STATUS.active;\n    }\n  }, {\n    key: \"micInactive\",\n    get: function get() {\n      return this._micStatus === MIC_STATUS.inactive;\n    }\n  }, {\n    key: \"micDenied\",\n    get: function get() {\n      return this._micStatus === MIC_STATUS.denied;\n    }\n  }, {\n    key: \"query\",\n    get: function get() {\n      return this._query;\n    }\n  }, {\n    key: \"suggestionsQuery\",\n    get: function get() {\n      return this._suggestionsQuery;\n    }\n  }, {\n    key: \"requestPending\",\n    get: function get() {\n      return this.requestStatus === REQUEST_STATUS.pending;\n    }\n  }, {\n    key: \"suggestionsRequestPending\",\n    get: function get() {\n      return this.suggestionsRequestStatus === REQUEST_STATUS.pending;\n    }\n  }]);\n\n  return Searchbase;\n}();\n/* ------------------ Static methods ------------------------------ */\n// function to generate the default query DSL\n\n\n_defineProperty(Searchbase, \"defaultQuery\", void 0);\n\n_defineProperty(Searchbase, \"shouldQuery\", void 0);\n\n_defineProperty(Searchbase, \"highlightQuery\", void 0);\n\n_defineProperty(Searchbase, \"compositeAggsQuery\", void 0);\n\n_defineProperty(Searchbase, \"generateQueryOptions\", void 0);\n\nSearchbase.defaultQuery = function (value, options) {\n  var finalQuery = null;\n  var fields;\n\n  if (value) {\n    if (Array.isArray(options.dataField)) {\n      fields = options.dataField;\n    } else {\n      fields = [options.dataField];\n    }\n\n    if (options.searchOperators) {\n      finalQuery = {\n        simple_query_string: Searchbase.shouldQuery(value, fields, options)\n      };\n    } else {\n      finalQuery = {\n        bool: {\n          should: Searchbase.shouldQuery(value, fields, options),\n          minimum_should_match: '1'\n        }\n      };\n    }\n  }\n\n  if (value === '') {\n    finalQuery = null;\n  }\n\n  if (finalQuery && options.nestedField) {\n    finalQuery = {\n      nested: {\n        path: options.nestedField,\n        query: finalQuery\n      }\n    };\n  }\n\n  return finalQuery;\n}; // helper function of default query\n\n\nSearchbase.shouldQuery = function (value, dataFields, options) {\n  if (options === void 0) {\n    options = {\n      searchOperators: false,\n      queryFormat: 'or',\n      fuzziness: 0\n    };\n  }\n\n  var fields = dataFields.map(function (dataField) {\n    if (typeof dataField === 'object') {\n      return \"\" + dataField.field + (dataField.weight ? \"^\" + dataField.weight : '');\n    }\n\n    return dataField;\n  });\n\n  if (options.searchOperators) {\n    return {\n      query: value,\n      fields: fields,\n      default_operator: options.queryFormat\n    };\n  }\n\n  if (options.queryFormat === 'and') {\n    return [{\n      multi_match: {\n        query: value,\n        fields: fields,\n        type: 'cross_fields',\n        operator: 'and'\n      }\n    }, {\n      multi_match: {\n        query: value,\n        fields: fields,\n        type: 'phrase',\n        operator: 'and'\n      }\n    }];\n  }\n\n  return [{\n    multi_match: {\n      query: value,\n      fields: fields,\n      type: 'best_fields',\n      operator: 'or',\n      fuzziness: options.fuzziness\n    }\n  }, {\n    multi_match: {\n      query: value,\n      fields: fields,\n      type: 'phrase',\n      operator: 'or'\n    }\n  }];\n}; // helper function to generate highlight query\n\n\nSearchbase.highlightQuery = function (highlight, highlightFields, dataFields) {\n  if (!highlight) return null;\n  var fields = {};\n  var highlightField = highlightFields || dataFields;\n  var flatHighlightedFields = typeof highlightFields === 'string' ? [highlightFields] : highlightFields;\n\n  if (typeof highlightField === 'string') {\n    fields[highlightField] = {};\n  } else if (Array.isArray(highlightField)) {\n    highlightField.forEach(function (item) {\n      if (typeof item === 'object') fields[item.field] = {};else fields[item] = {};\n    });\n  }\n\n  return {\n    highlight: _extends({\n      pre_tags: ['<mark>'],\n      post_tags: ['</mark>'],\n      fields: fields\n    }, flatHighlightedFields && {\n      require_field_match: false\n    })\n  };\n}; // helper function to generate composite aggregations query\n\n\nSearchbase.compositeAggsQuery = function (aggregationField, size) {\n  var _ref4, _aggs, _aggs2;\n\n  return {\n    aggs: (_aggs2 = {}, _aggs2[aggregationField] = {\n      composite: {\n        sources: [(_ref4 = {}, _ref4[aggregationField] = {\n          terms: {\n            field: aggregationField\n          }\n        }, _ref4)],\n        size: size\n      },\n      aggs: (_aggs = {}, _aggs[aggregationField] = {\n        top_hits: {\n          size: 1\n        }\n      }, _aggs)\n    }, _aggs2)\n  };\n}; // function to generate the query DSL options\n\n\nSearchbase.generateQueryOptions = function (options) {\n  var finalOptions = {};\n\n  if (options.size !== undefined) {\n    finalOptions.size = options.size;\n  }\n\n  if (options.from !== undefined) {\n    finalOptions.from = options.from;\n  }\n\n  if (options.includeFields || options.excludeFields) {\n    var source = {};\n\n    if (options.includeFields) {\n      source.includes = options.includeFields;\n    }\n\n    if (options.excludeFields) {\n      source.excludes = options.excludeFields;\n    }\n\n    finalOptions._source = source;\n  }\n\n  if (options.sortOptions) {\n    var _ref5;\n\n    finalOptions.sort = [(_ref5 = {}, _ref5[options.sortOptions[0].dataField] = {\n      order: options.sortOptions[0].sortBy\n    }, _ref5)];\n  } else if (options.sortBy && options.sortByField) {\n    var _ref6;\n\n    finalOptions.sort = [(_ref6 = {}, _ref6[options.sortByField] = {\n      order: options.sortBy\n    }, _ref6)];\n  }\n\n  if (options.aggregationField) {\n    finalOptions.aggs = Searchbase.compositeAggsQuery(options.aggregationField, options.size || 0).aggs;\n  }\n\n  return finalOptions;\n};\n\nexport default Searchbase;","map":{"version":3,"sources":["/Users/rogetgeoffroy/Desktop/Folders/react_js_folder/react-live-search-app/live-search/node_modules/@appbaseio/searchbase/dist/@appbaseio/searchbase.es.js"],"names":["fetch","AppbaseAnalytics","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","Constructor","protoProps","staticProps","prototype","_defineProperty","obj","value","_extends","assign","arguments","source","hasOwnProperty","call","apply","highlightResults","result","data","highlight","keys","forEach","highlightItem","_extends2","highlightValue","_source","parseHits","hits","results","concat","map","item","streamProps","_updated","_deleted","filter","reduce","flatten","arr","flat","toFlatten","Array","isArray","extractSuggestion","val","getSuggestions","fields","suggestions","currentValue","suggestionsList","labelsList","populateSuggestionsList","parsedSource","isWordMatch","trim","split","some","term","String","toLowerCase","includes","_promoted","defaultOption","label","parseField","field","fieldNodes","children","substring","arrayItem","suggestion","_score","_index","_type","_id","parseCompAggToHits","aggFieldName","buckets","bucket","doc_count","hitsData","_doc_count","_key","Results","_this","rawResponse","raw","setData","_proto","filteredResults","promotedData","ids","Boolean","dataItem","parseResults","get","total","took","hidden","promoted","customData","Observable","observers","subscribe","fn","propertiesToSubscribe","push","callback","properties","unsubscribe","next","o","property","thisObj","scope","window","undefined","CompositeAggregationResults","setRaw","after_key","setAfterKey","afterKey","aggField","MIC_STATUS","inactive","active","denied","REQUEST_STATUS","pending","error","defaultOptions","triggerQuery","triggerSuggestionsQuery","stateChanges","Searchbase","_ref","index","url","enableAppbase","enableQuerySuggestions","credentials","appbaseConfig","headers","_suggestions","querySuggestions","_results","fuzziness","searchOperators","queryFormat","size","from","dataField","aggregationField","includeFields","excludeFields","transformQuery","transformSuggestionsQuery","transformRequest","transformResponse","beforeValueChange","sortBy","nestedField","sortOptions","sortByField","highlightField","micOptions","options","prevStatus","_micStatus","SpeechRecognition","webkitSpeechRecognition","_setMicStatus","_window","_micInstance","_stopMic","continuous","interimResults","start","onstart","onresult","_ref2","isFinal","_handleVoiceResults","onerror","e","console","objects","isSuggestionClick","_analyticsInstance","_queryId","click","queryID","conversion","_ref3","transcript","setValue","stop","status","_applyOptions","sourceSuggestions","getDataFields","slice","Error","init","Number","requestStatus","suggestionsRequestStatus","_parseSuggestions","_parseQuerySuggestions","aggregationData","Accept","Authorization","btoa","setHeaders","subscribeToStateChanges","unsubscribeToStateChanges","prev","setSize","setFrom","setFuzziness","setIncludeFields","setExcludeFields","setSortBy","setSortByField","setNestedField","setDataField","setResults","_prev","setSuggestions","_prev2","_this2","performUpdate","then","warn","_this3","handleError","err","_setError","Promise","reject","_updateQuery","_setRequestStatus","query","res","finalQuery","_fetchRequest","rawResults","SearchResult","resolve","_this4","_setSuggestionsError","_updateSuggestionsQuery","_setSuggestionsRequestStatus","suggestionsQuery","rawSuggestions","DataSearch","getSuggestionsQuery","rawQuerySuggestions","_handleQuerySuggestionsResponse","aggregations","_handleCompositeAggsResponse","id","defaultQuery","sort","count","order","aggsResponse","_handleTransformResponse","_handleTransformRequest","requestOptions","DataSearch__suggestions","requestBody","isQuerySuggestionsAPI","_this5","method","body","JSON","stringify","finalRequestOptions","timestamp","Date","now","suffix","responseHeaders","json","transformedData","response","_timestamp","_headers","suggestionsError","queryOptions","prevQuery","_query","getAppbaseSuggestionsQuery","execute","getAppbaseResultQuery","settings","getAppbaseSettings","getPreviousQuery","_this$appbaseConfig","recordAnalytics","customEvents","enableQueryRules","userId","react","and","finalQueryOptions","generateQueryOptions","match_all","highlightQuery","_suggestionsQuery","getPreviousSuggestionsQuery","prevValue","nextValue","onMicStatusChange","onQueryChange","onSuggestionsQueryChange","onValueChange","onError","onSuggestionsError","onResults","onSuggestions","onQuerySuggestions","onAggregationData","onRequestStatusChange","onSuggestionsRequestStatusChange","_this$stateChanges$ne","simple_query_string","shouldQuery","bool","should","minimum_should_match","nested","path","dataFields","weight","default_operator","multi_match","type","operator","highlightFields","flatHighlightedFields","pre_tags","post_tags","require_field_match","compositeAggsQuery","_ref4","_aggs","_aggs2","aggs","composite","sources","terms","top_hits","finalOptions","excludes","_ref5","_ref6"],"mappings":"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","sourcesContent":["import fetch from 'cross-fetch';\nimport AppbaseAnalytics from '@appbaseio/analytics';\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nvar highlightResults = function highlightResults(result) {\n  var data = _extends({}, result);\n\n  if (data.highlight) {\n    Object.keys(data.highlight).forEach(function (highlightItem) {\n      var _extends2;\n\n      var highlightValue = data.highlight[highlightItem][0];\n      data._source = _extends({}, data._source, (_extends2 = {}, _extends2[highlightItem] = highlightValue, _extends2));\n    });\n  }\n\n  return data;\n};\nvar parseHits = function parseHits(hits) {\n  var results = [];\n\n  if (hits) {\n    results = [].concat(hits).map(function (item) {\n      var streamProps = {};\n\n      if (item._updated) {\n        streamProps._updated = item._updated;\n      } else if (item._deleted) {\n        streamProps._deleted = item._deleted;\n      }\n\n      var data = highlightResults(item);\n      var result = Object.keys(data).filter(function (key) {\n        return key !== '_source';\n      }).reduce(function (obj, key) {\n        // eslint-disable-next-line\n        obj[key] = data[key];\n        return obj;\n      }, _extends({}, data._source, {}, streamProps));\n      return result;\n    });\n  }\n\n  return results;\n}; // flattens a nested array\n\nvar flatten = function flatten(arr) {\n  return arr.reduce(function (flat, toFlatten) {\n    return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);\n  }, []);\n}; // helper function to extract suggestions\n\nvar extractSuggestion = function extractSuggestion(val) {\n  if (typeof val === 'object') {\n    if (Array.isArray(val)) {\n      return flatten(val);\n    }\n\n    return null;\n  }\n\n  return val;\n};\nvar getSuggestions = function getSuggestions(fields, suggestions, currentValue) {\n  if (fields === void 0) {\n    fields = [];\n  }\n\n  if (currentValue === void 0) {\n    currentValue = '';\n  }\n\n  var suggestionsList = [];\n  var labelsList = [];\n\n  var populateSuggestionsList = function populateSuggestionsList(val, parsedSource, source) {\n    // check if the suggestion includes the current value\n    // and not already included in other suggestions\n    var isWordMatch = currentValue.trim().split(' ').some(function (term) {\n      return String(val).toLowerCase().includes(term);\n    });\n\n    if (isWordMatch && !labelsList.includes(val) || source._promoted) {\n      var defaultOption = {\n        label: val,\n        value: val,\n        source: source\n      };\n      labelsList = [].concat(labelsList, [val]);\n      suggestionsList = [].concat(suggestionsList, [defaultOption]);\n    }\n  };\n\n  var parseField = function parseField(parsedSource, field, source) {\n    if (field === void 0) {\n      field = '';\n    }\n\n    if (source === void 0) {\n      source = parsedSource;\n    }\n\n    if (typeof parsedSource === 'object') {\n      var fieldNodes = field.split('.');\n      var label = parsedSource[fieldNodes[0]];\n\n      if (label) {\n        if (fieldNodes.length > 1) {\n          // nested fields of the 'foo.bar.zoo' variety\n          var children = field.substring(fieldNodes[0].length + 1);\n\n          if (Array.isArray(label)) {\n            label.forEach(function (arrayItem) {\n              parseField(arrayItem, children, source);\n            });\n          } else {\n            parseField(label, children, source);\n          }\n        } else {\n          var val = extractSuggestion(label);\n\n          if (val) {\n            if (Array.isArray(val)) {\n              val.forEach(function (suggestion) {\n                return populateSuggestionsList(suggestion, parsedSource, source);\n              });\n            } else {\n              populateSuggestionsList(val, parsedSource, source);\n            }\n          }\n        }\n      }\n    }\n  };\n\n  suggestions.forEach(function (item) {\n    var _score = item._score,\n        _index = item._index,\n        _type = item._type,\n        _id = item._id;\n\n    var source = _extends({}, item, {\n      _id: _id,\n      _index: _index,\n      _score: _score,\n      _type: _type\n    });\n\n    fields.forEach(function (field) {\n      parseField(source, field);\n    });\n  });\n  return suggestionsList;\n};\nfunction parseCompAggToHits(aggFieldName, buckets) {\n  if (buckets === void 0) {\n    buckets = [];\n  }\n\n  return buckets.map(function (bucket) {\n    // eslint-disable-next-line camelcase\n    var doc_count = bucket.doc_count,\n        key = bucket.key,\n        hitsData = bucket[aggFieldName];\n    return _extends({\n      _doc_count: doc_count,\n      _key: key[aggFieldName]\n    }, hitsData.hits.hits[0]);\n  });\n}\n\nvar Results =\n/*#__PURE__*/\nfunction () {\n  // An array of results obtained from the applied query.\n  // Raw response returned by ES query\n  // Results parser\n  function Results(data) {\n    var _this = this;\n\n    _defineProperty(this, \"data\", void 0);\n\n    _defineProperty(this, \"raw\", void 0);\n\n    _defineProperty(this, \"parseResults\", void 0);\n\n    _defineProperty(this, \"setRaw\", function (rawResponse) {\n      // set response\n      _this.raw = rawResponse;\n\n      if (rawResponse.hits && rawResponse.hits.hits) {\n        _this.setData(rawResponse.hits.hits);\n      }\n    });\n\n    this.data = data || [];\n  } // Total number of results found\n\n\n  var _proto = Results.prototype;\n\n  // Method to set data explicitly\n  _proto.setData = function setData(data) {\n    // parse hits\n    var filteredResults = parseHits(data); // filter results & remove duplicates if any\n\n    if (this.promotedData.length) {\n      var ids = this.promotedData.map(function (item) {\n        return item._id;\n      }).filter(Boolean);\n\n      if (ids) {\n        filteredResults = filteredResults.filter(function (item) {\n          return !ids.includes(item._id);\n        });\n      }\n\n      filteredResults = [].concat(this.promotedData.map(function (dataItem) {\n        return _extends({}, dataItem, {\n          _promoted: true\n        });\n      }), filteredResults);\n    } // set data\n\n\n    if (this.parseResults) {\n      this.data = this.parseResults(filteredResults, data);\n    } else {\n      this.data = filteredResults;\n    }\n  };\n\n  _createClass(Results, [{\n    key: \"numberOfResults\",\n    get: function get() {\n      // calculate from raw response\n      if (this.raw && this.raw.hits) {\n        return typeof this.raw.hits.total === 'object' ? this.raw.hits.total.value : this.raw.hits.total;\n      }\n\n      return 0;\n    } // Total time taken by request (in ms)\n\n  }, {\n    key: \"time\",\n    get: function get() {\n      // calculate from raw response\n      if (this.raw) {\n        return this.raw.took;\n      }\n\n      return 0;\n    } // no of hidden results found\n\n  }, {\n    key: \"hidden\",\n    get: function get() {\n      if (this.raw && this.raw.hits) {\n        return this.raw.hits.hidden || 0;\n      }\n\n      return 0;\n    } // no of promoted results found\n\n  }, {\n    key: \"promoted\",\n    get: function get() {\n      if (this.raw && this.raw.promoted) {\n        return this.raw.promoted.length;\n      }\n\n      return 0;\n    } // An array of promoted results obtained from the applied query.\n\n  }, {\n    key: \"promotedData\",\n    get: function get() {\n      if (this.raw && this.raw.promoted) {\n        return this.raw.promoted || [];\n      }\n\n      return [];\n    } // An object of raw response as-is from elasticsearch query\n\n  }, {\n    key: \"rawData\",\n    get: function get() {\n      return this.raw || {};\n    } // object of custom data applied through queryRules\n    // only works when `enableAppbase=true`\n\n  }, {\n    key: \"customData\",\n    get: function get() {\n      if (this.raw && this.raw.customData) {\n        return this.raw.customData || {};\n      }\n\n      return {};\n    }\n  }]);\n\n  return Results;\n}();\n\nvar Observable =\n/*#__PURE__*/\nfunction () {\n  function Observable() {\n    _defineProperty(this, \"observers\", void 0);\n\n    this.observers = [];\n  }\n\n  var _proto = Observable.prototype;\n\n  _proto.subscribe = function subscribe(fn, propertiesToSubscribe) {\n    this.observers.push({\n      callback: fn,\n      properties: propertiesToSubscribe\n    });\n  };\n\n  _proto.unsubscribe = function unsubscribe(fn) {\n    if (fn) {\n      this.observers = this.observers.filter(function (item) {\n        if (item.callback !== fn) {\n          return item;\n        }\n\n        return null;\n      });\n    } else {\n      this.observers = [];\n    }\n  };\n\n  _proto.next = function next(o, property, thisObj) {\n    var scope = thisObj || window;\n    this.observers.forEach(function (item) {\n      // filter by subscribed properties\n      if (item.properties === undefined) {\n        item.callback.call(scope, o);\n      } else if (item.properties instanceof Array && item.properties.length && item.properties.includes(property)) {\n        item.callback.call(scope, o);\n      } else if (typeof item.properties === 'string' && item.properties && item.properties === property) {\n        item.callback.call(scope, o);\n      }\n    });\n  };\n\n  return Observable;\n}();\n\nvar CompositeAggregationResults =\n/*#__PURE__*/\nfunction () {\n  // An array of composite aggregations obtained from the applied aggs in options.\n  // useful when loading data of greater size\n  // Raw aggregations returned by ES query\n  function CompositeAggregationResults(data) {\n    _defineProperty(this, \"data\", void 0);\n\n    _defineProperty(this, \"afterKey\", void 0);\n\n    _defineProperty(this, \"raw\", void 0);\n\n    this.data = data || [];\n  } // An object of raw response as-is from elasticsearch query\n\n\n  var _proto = CompositeAggregationResults.prototype;\n\n  _proto.setRaw = function setRaw(rawResponse) {\n    // set response\n    this.raw = rawResponse;\n    if (rawResponse.after_key) this.setAfterKey(rawResponse.after_key);\n  };\n\n  _proto.setAfterKey = function setAfterKey(key) {\n    this.afterKey = key;\n  } // Method to set data explicitly\n  ;\n\n  _proto.setData = function setData(aggField, data) {\n    // parse aggregation buckets\n    this.data = parseCompAggToHits(aggField, data);\n  };\n\n  _createClass(CompositeAggregationResults, [{\n    key: \"rawData\",\n    get: function get() {\n      return this.raw || {};\n    }\n  }]);\n\n  return CompositeAggregationResults;\n}();\n\nvar MIC_STATUS = {\n  inactive: 'INACTIVE',\n  active: 'ACTIVE',\n  denied: 'DENIED'\n};\nvar REQUEST_STATUS = {\n  inactive: 'INACTIVE',\n  pending: 'PENDING',\n  error: 'ERROR'\n};\nvar defaultOptions = {\n  triggerQuery: true,\n  triggerSuggestionsQuery: false,\n  stateChanges: true\n};\nvar defaultOption = {\n  stateChanges: true\n};\n\nvar Searchbase =\n/*#__PURE__*/\nfunction () {\n  // es index name\n  // es url\n  // use rs v3 api\n  // get query suggestions from `.suggestions` index\n  // auth credentials if any\n  // to enable the recording of analytics\n  // input value i.e query term\n  // custom headers object\n  // suggestions\n  // query suggestions\n  // composite aggregations\n  // suggestions query error\n  // results\n  // results query error\n  // state changes subject\n  // request status\n  // suggestions request status\n  // following are the es query options\n\n  /* ------------- change events -------------------------------- */\n  // called when value changes\n  // called when results change\n  // called when suggestions change\n  // called when query suggestions change\n  // called when composite aggregations change\n  // called when there is an error while fetching results\n  // called when there is an error while fetching suggestions\n  // called when request status changes\n  // called when suggestions request status changes\n  // called when query changes\n  // called when suggestions query changes\n  // called when mic status changes\n\n  /* ---- callbacks to create the side effects while querying ----- */\n\n  /* ------ Private properties only for the internal use ----------- */\n  // counterpart of the query\n  // counterpart of the suggestions query\n  // mic status\n  // mic instance\n  // analytics instance\n  // query search ID\n  function Searchbase(_ref) {\n    var _this = this;\n\n    var index = _ref.index,\n        url = _ref.url,\n        enableAppbase = _ref.enableAppbase,\n        enableQuerySuggestions = _ref.enableQuerySuggestions,\n        credentials = _ref.credentials,\n        appbaseConfig = _ref.appbaseConfig,\n        headers = _ref.headers,\n        value = _ref.value,\n        _suggestions = _ref.suggestions,\n        querySuggestions = _ref.querySuggestions,\n        _results = _ref.results,\n        fuzziness = _ref.fuzziness,\n        searchOperators = _ref.searchOperators,\n        queryFormat = _ref.queryFormat,\n        size = _ref.size,\n        from = _ref.from,\n        dataField = _ref.dataField,\n        aggregationField = _ref.aggregationField,\n        includeFields = _ref.includeFields,\n        excludeFields = _ref.excludeFields,\n        transformQuery = _ref.transformQuery,\n        transformSuggestionsQuery = _ref.transformSuggestionsQuery,\n        transformRequest = _ref.transformRequest,\n        transformResponse = _ref.transformResponse,\n        beforeValueChange = _ref.beforeValueChange,\n        sortBy = _ref.sortBy,\n        nestedField = _ref.nestedField,\n        sortOptions = _ref.sortOptions,\n        sortByField = _ref.sortByField,\n        highlight = _ref.highlight,\n        highlightField = _ref.highlightField;\n\n    _defineProperty(this, \"index\", void 0);\n\n    _defineProperty(this, \"url\", void 0);\n\n    _defineProperty(this, \"enableAppbase\", void 0);\n\n    _defineProperty(this, \"enableQuerySuggestions\", void 0);\n\n    _defineProperty(this, \"credentials\", void 0);\n\n    _defineProperty(this, \"appbaseConfig\", void 0);\n\n    _defineProperty(this, \"value\", void 0);\n\n    _defineProperty(this, \"headers\", void 0);\n\n    _defineProperty(this, \"suggestions\", void 0);\n\n    _defineProperty(this, \"querySuggestions\", void 0);\n\n    _defineProperty(this, \"aggregationData\", void 0);\n\n    _defineProperty(this, \"suggestionsError\", void 0);\n\n    _defineProperty(this, \"results\", void 0);\n\n    _defineProperty(this, \"error\", void 0);\n\n    _defineProperty(this, \"stateChanges\", void 0);\n\n    _defineProperty(this, \"requestStatus\", void 0);\n\n    _defineProperty(this, \"suggestionsRequestStatus\", void 0);\n\n    _defineProperty(this, \"nestedField\", void 0);\n\n    _defineProperty(this, \"queryFormat\", void 0);\n\n    _defineProperty(this, \"searchOperators\", void 0);\n\n    _defineProperty(this, \"size\", void 0);\n\n    _defineProperty(this, \"from\", void 0);\n\n    _defineProperty(this, \"fuzziness\", void 0);\n\n    _defineProperty(this, \"sortBy\", void 0);\n\n    _defineProperty(this, \"sortByField\", void 0);\n\n    _defineProperty(this, \"dataField\", void 0);\n\n    _defineProperty(this, \"aggregationField\", void 0);\n\n    _defineProperty(this, \"includeFields\", void 0);\n\n    _defineProperty(this, \"excludeFields\", void 0);\n\n    _defineProperty(this, \"sortOptions\", void 0);\n\n    _defineProperty(this, \"highlight\", void 0);\n\n    _defineProperty(this, \"highlightField\", void 0);\n\n    _defineProperty(this, \"onValueChange\", void 0);\n\n    _defineProperty(this, \"onResults\", void 0);\n\n    _defineProperty(this, \"onSuggestions\", void 0);\n\n    _defineProperty(this, \"onQuerySuggestions\", void 0);\n\n    _defineProperty(this, \"onAggregationData\", void 0);\n\n    _defineProperty(this, \"onError\", void 0);\n\n    _defineProperty(this, \"onSuggestionsError\", void 0);\n\n    _defineProperty(this, \"onRequestStatusChange\", void 0);\n\n    _defineProperty(this, \"onSuggestionsRequestStatusChange\", void 0);\n\n    _defineProperty(this, \"onQueryChange\", void 0);\n\n    _defineProperty(this, \"onSuggestionsQueryChange\", void 0);\n\n    _defineProperty(this, \"onMicStatusChange\", void 0);\n\n    _defineProperty(this, \"transformQuery\", void 0);\n\n    _defineProperty(this, \"transformSuggestionsQuery\", void 0);\n\n    _defineProperty(this, \"transformRequest\", void 0);\n\n    _defineProperty(this, \"transformResponse\", void 0);\n\n    _defineProperty(this, \"beforeValueChange\", void 0);\n\n    _defineProperty(this, \"_query\", void 0);\n\n    _defineProperty(this, \"_suggestionsQuery\", void 0);\n\n    _defineProperty(this, \"_queryOptions\", void 0);\n\n    _defineProperty(this, \"_micStatus\", void 0);\n\n    _defineProperty(this, \"_micInstance\", void 0);\n\n    _defineProperty(this, \"_analyticsInstance\", void 0);\n\n    _defineProperty(this, \"_queryId\", void 0);\n\n    _defineProperty(this, \"onMicClick\", function (micOptions, options) {\n      if (micOptions === void 0) {\n        micOptions = {};\n      }\n\n      if (options === void 0) {\n        options = defaultOptions;\n      }\n\n      var prevStatus = _this._micStatus;\n\n      if (typeof window !== 'undefined') {\n        window.SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition || null;\n      }\n\n      if (window && window.SpeechRecognition && prevStatus !== MIC_STATUS.denied) {\n        if (prevStatus === MIC_STATUS.active) {\n          _this._setMicStatus(MIC_STATUS.inactive, options);\n        }\n\n        var _window = window,\n            SpeechRecognition = _window.SpeechRecognition;\n\n        if (_this._micInstance) {\n          _this._stopMic();\n\n          return;\n        }\n\n        _this._micInstance = new SpeechRecognition();\n        _this._micInstance.continuous = true;\n        _this._micInstance.interimResults = true;\n        Object.assign(_this._micInstance, micOptions);\n\n        _this._micInstance.start();\n\n        _this._micInstance.onstart = function () {\n          _this._setMicStatus(MIC_STATUS.active, options);\n        };\n\n        _this._micInstance.onresult = function (_ref2) {\n          var results = _ref2.results;\n\n          if (results && results[0] && results[0].isFinal) {\n            _this._stopMic();\n          }\n\n          _this._handleVoiceResults({\n            results: results\n          }, options);\n        };\n\n        _this._micInstance.onerror = function (e) {\n          if (e.error === 'no-speech' || e.error === 'audio-capture') {\n            _this._setMicStatus(MIC_STATUS.inactive, options);\n          } else if (e.error === 'not-allowed') {\n            _this._setMicStatus(MIC_STATUS.denied, options);\n          }\n\n          console.error(e);\n        };\n      }\n    });\n\n    _defineProperty(this, \"recordClick\", function (objects, isSuggestionClick) {\n      if (isSuggestionClick === void 0) {\n        isSuggestionClick = false;\n      }\n\n      if (_this._analyticsInstance && _this._queryId) {\n        _this._analyticsInstance.click({\n          queryID: _this._queryId,\n          objects: objects,\n          isSuggestionClick: isSuggestionClick\n        });\n      }\n    });\n\n    _defineProperty(this, \"recordConversions\", function (objects) {\n      if (_this._analyticsInstance && _this._queryId) {\n        _this._analyticsInstance.conversion({\n          queryID: _this._queryId,\n          objects: objects\n        });\n      }\n    });\n\n    _defineProperty(this, \"_handleVoiceResults\", function (_ref3, options) {\n      var results = _ref3.results;\n\n      if (options === void 0) {\n        options = defaultOptions;\n      }\n\n      if (results && results[0] && results[0].isFinal && results[0][0] && results[0][0].transcript && results[0][0].transcript.trim()) {\n        _this.setValue(results[0][0].transcript.trim(), options);\n      }\n    });\n\n    _defineProperty(this, \"_stopMic\", function () {\n      if (_this._micInstance) {\n        _this._micInstance.stop();\n\n        _this._micInstance = null;\n\n        _this._setMicStatus(MIC_STATUS.inactive);\n      }\n    });\n\n    _defineProperty(this, \"_setMicStatus\", function (status, options) {\n      if (options === void 0) {\n        options = defaultOptions;\n      }\n\n      var prevStatus = _this._micStatus;\n      _this._micStatus = status;\n\n      _this._applyOptions(options, 'micStatus', prevStatus, _this._micStatus);\n    });\n\n    _defineProperty(this, \"_parseSuggestions\", function (suggestions, sourceSuggestions) {\n      var fields = _this.getDataFields();\n\n      if (fields.length === 0 && sourceSuggestions && Array.isArray(sourceSuggestions) && sourceSuggestions.length > 0 && sourceSuggestions[0] && sourceSuggestions[0]._source) {\n        // Extract fields from _source\n        fields = Object.keys(sourceSuggestions[0]._source);\n      }\n\n      return getSuggestions(fields, suggestions, _this.value).slice(0, _this.size);\n    });\n\n    _defineProperty(this, \"_parseQuerySuggestions\", function (suggestions) {\n      var fields = ['key', 'key.autosuggest', 'key.search'];\n      return getSuggestions(fields, suggestions, _this.value);\n    });\n\n    if (!index) {\n      throw new Error('Please provide a valid index.');\n    }\n\n    if (!url) {\n      throw new Error('Please provide a valid url.');\n    }\n\n    if (!(enableAppbase || dataField)) {\n      throw new Error('Please provide a valid data field.');\n    }\n\n    this.index = index;\n    this.url = url;\n    this.enableAppbase = enableAppbase || false;\n    this.enableQuerySuggestions = enableQuerySuggestions || false;\n    this.appbaseConfig = appbaseConfig;\n    this._analyticsInstance = AppbaseAnalytics.init({\n      index: index,\n      url: url,\n      credentials: credentials\n    });\n    this.dataField = dataField;\n    this.aggregationField = aggregationField;\n    this.credentials = credentials || '';\n    this.nestedField = nestedField;\n    this.queryFormat = queryFormat || 'or';\n    this.fuzziness = fuzziness || 0;\n    this.searchOperators = searchOperators || false;\n    this.size = Number(size) || 10;\n    this.from = Number(from) || 0;\n    this.sortBy = sortBy;\n    this.includeFields = includeFields || ['*'];\n    this.excludeFields = excludeFields || [];\n    this.sortOptions = sortOptions || null;\n    this.sortByField = sortByField;\n    this.highlight = highlight;\n    this.highlightField = highlightField;\n    this.requestStatus = REQUEST_STATUS.inactive;\n    this.suggestionsRequestStatus = REQUEST_STATUS.inactive;\n    this.transformRequest = transformRequest || null;\n    this.transformResponse = transformResponse || null;\n    this.transformQuery = transformQuery || null;\n    this.transformSuggestionsQuery = transformSuggestionsQuery || null;\n    this.beforeValueChange = beforeValueChange || null; // Initialize the state changes observable\n\n    this.stateChanges = new Observable(); // Initialize the results\n\n    this.suggestions = new Results(_suggestions); // Add suggestions parser\n\n    this.suggestions.parseResults = this._parseSuggestions; // Initialize query suggestions\n\n    this.querySuggestions = new Results(querySuggestions); // Add suggestions parser\n\n    this.querySuggestions.parseResults = this._parseQuerySuggestions;\n    this.results = new Results(_results); // composite aggs instance\n\n    this.aggregationData = new CompositeAggregationResults(); // Initialize headers\n\n    this.headers = {\n      Accept: 'application/json',\n      'Content-Type': 'application/json'\n    };\n\n    if (this.credentials) {\n      this.headers = _extends({}, this.headers, {\n        Authorization: \"Basic \" + btoa(this.credentials)\n      });\n    }\n\n    if (headers) {\n      this.setHeaders(headers, {\n        stateChanges: false\n      });\n    }\n\n    if (value) {\n      this.setValue(value, {\n        stateChanges: true\n      });\n    } else {\n      this.value = '';\n    }\n  } // getters\n\n\n  var _proto = Searchbase.prototype;\n\n  // Method to subscribe the state changes\n  _proto.subscribeToStateChanges = function subscribeToStateChanges(fn, propertiesToSubscribe) {\n    this.stateChanges.subscribe(fn, propertiesToSubscribe);\n  } // Method to unsubscribe the state changes\n  ;\n\n  _proto.unsubscribeToStateChanges = function unsubscribeToStateChanges(fn) {\n    this.stateChanges.unsubscribe(fn);\n  } // Method to set the custom headers\n  ;\n\n  _proto.setHeaders = function setHeaders(headers, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.headers;\n    this.headers = _extends({}, this.headers, {}, headers);\n\n    this._applyOptions(options, 'headers', prev, this.headers);\n  } // Method to set the size option\n  ;\n\n  _proto.setSize = function setSize(size, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.size;\n    this.size = size;\n\n    this._applyOptions(options, 'size', prev, this.size);\n  } // Method to set the from option\n  ;\n\n  _proto.setFrom = function setFrom(from, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.from;\n    this.from = from;\n\n    this._applyOptions(options, 'from', prev, this.from);\n  } // Method to set the fuzziness option\n  ;\n\n  _proto.setFuzziness = function setFuzziness(fuzziness, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.fuzziness;\n    this.fuzziness = fuzziness;\n\n    this._applyOptions(options, 'fuzziness', prev, this.fuzziness);\n  } // Method to set the includeFields option\n  ;\n\n  _proto.setIncludeFields = function setIncludeFields(includeFields, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.includeFields;\n    this.includeFields = includeFields;\n\n    this._applyOptions(options, 'includeFields', prev, includeFields);\n  } // Method to set the excludeFields option\n  ;\n\n  _proto.setExcludeFields = function setExcludeFields(excludeFields, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.excludeFields;\n    this.excludeFields = excludeFields;\n\n    this._applyOptions(options, 'excludeFields', prev, excludeFields);\n  } // Method to set the sortBy option\n  ;\n\n  _proto.setSortBy = function setSortBy(sortBy, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.sortBy;\n    this.sortBy = sortBy;\n\n    this._applyOptions(options, 'sortBy', prev, sortBy);\n  } // Method to set the sortByField option\n  ;\n\n  _proto.setSortByField = function setSortByField(sortByField, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.sortByField;\n    this.sortByField = sortByField;\n\n    this._applyOptions(options, 'sortByField', prev, sortByField);\n  } // Method to set the nestedField option\n  ;\n\n  _proto.setNestedField = function setNestedField(nestedField, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.nestedField;\n    this.nestedField = nestedField;\n\n    this._applyOptions(options, 'nestedField', prev, nestedField);\n  } // Method to set the dataField option\n  ;\n\n  _proto.setDataField = function setDataField(dataField, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.dataField;\n    this.dataField = dataField;\n\n    this._applyOptions(options, 'dataField', prev, dataField);\n  } // Method to set the custom results\n  ;\n\n  _proto.setResults = function setResults(results, options) {\n    if (options === void 0) {\n      options = defaultOption;\n    }\n\n    if (results) {\n      var _prev = this.results;\n      this.results = new Results(results);\n\n      this._applyOptions({\n        stateChanges: options.stateChanges\n      }, 'results', _prev, this.results);\n    }\n  } // Method to set the custom suggestions\n  ;\n\n  _proto.setSuggestions = function setSuggestions(suggestions, options) {\n    if (options === void 0) {\n      options = defaultOption;\n    }\n\n    if (suggestions) {\n      var _prev2 = this.suggestions;\n      this.suggestions = new Results(suggestions);\n      this.suggestions.parseResults = this._parseSuggestions;\n\n      this._applyOptions({\n        stateChanges: options.stateChanges\n      }, 'suggestions', _prev2, this.suggestions);\n    }\n  } // Method to set the value\n  ;\n\n  _proto.setValue = function setValue(value, options) {\n    var _this2 = this;\n\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var performUpdate = function performUpdate() {\n      var prev = _this2.value;\n      _this2.value = value;\n\n      _this2._applyOptions(options, 'value', prev, _this2.value);\n    };\n\n    if (this.beforeValueChange) {\n      this.beforeValueChange(value).then(performUpdate)[\"catch\"](function (e) {\n        console.warn('beforeValueChange rejected the promise with ', e);\n      });\n    } else {\n      performUpdate();\n    }\n  } // mic event\n  ;\n\n  // Method to execute the query\n  _proto.triggerQuery = function triggerQuery(options) {\n    var _this3 = this;\n\n    if (options === void 0) {\n      options = defaultOption;\n    }\n\n    var handleError = function handleError(err) {\n      _this3._setError(err, {\n        stateChanges: options.stateChanges\n      });\n\n      console.error(err);\n      return Promise.reject(err);\n    };\n\n    try {\n      this._updateQuery();\n\n      this._setRequestStatus(REQUEST_STATUS.pending);\n\n      var transformQuery = this.transformQuery ? this.transformQuery(this.query) : new Promise(function (res) {\n        return res(_this3.query);\n      });\n      return transformQuery.then(function (finalQuery) {\n        _this3._fetchRequest(finalQuery).then(function (results) {\n          _this3._setRequestStatus(REQUEST_STATUS.inactive);\n\n          var prev = _this3.results;\n          var rawResults = results;\n          if (_this3.enableAppbase) rawResults = results.SearchResult;\n\n          _this3.results.setRaw(rawResults);\n\n          _this3._applyOptions({\n            stateChanges: options.stateChanges\n          }, 'results', prev, _this3.results);\n\n          return Promise.resolve(rawResults);\n        })[\"catch\"](handleError);\n      })[\"catch\"](handleError);\n    } catch (err) {\n      return handleError(err);\n    }\n  } // Method to execute the suggestions query\n  ;\n\n  _proto.triggerSuggestionsQuery = function triggerSuggestionsQuery(options) {\n    var _this4 = this;\n\n    if (options === void 0) {\n      options = defaultOption;\n    }\n\n    var handleError = function handleError(err) {\n      _this4._setSuggestionsError(err, {\n        stateChanges: options.stateChanges\n      });\n\n      console.error(err);\n      return Promise.reject(err);\n    };\n\n    try {\n      this._updateSuggestionsQuery();\n\n      this._setSuggestionsRequestStatus(REQUEST_STATUS.pending);\n\n      var transformSuggestionsQuery = this.transformSuggestionsQuery ? this.transformSuggestionsQuery(this.suggestionsQuery) : new Promise(function (res) {\n        return res(_this4.suggestionsQuery);\n      });\n      return transformSuggestionsQuery.then(function (finalQuery) {\n        _this4._fetchRequest(finalQuery).then(function (suggestions) {\n          var rawSuggestions = suggestions;\n          if (_this4.enableAppbase) rawSuggestions = suggestions.DataSearch;\n\n          if (_this4.enableAppbase && _this4.enableQuerySuggestions) {\n            _this4._fetchRequest(_this4.getSuggestionsQuery(), true).then(function (rawQuerySuggestions) {\n              _this4._setSuggestionsRequestStatus(REQUEST_STATUS.inactive);\n\n              _this4._handleQuerySuggestionsResponse(rawQuerySuggestions, options);\n            })[\"catch\"](handleError);\n          } else _this4._setSuggestionsRequestStatus(REQUEST_STATUS.inactive);\n\n          if (rawSuggestions.aggregations) {\n            _this4._handleCompositeAggsResponse(_this4.aggregationField, rawSuggestions.aggregations, options);\n          }\n\n          var prev = _this4.suggestions;\n\n          _this4.suggestions.setRaw(rawSuggestions);\n\n          _this4._applyOptions({\n            stateChanges: options.stateChanges\n          }, 'suggestions', prev, _this4.suggestions);\n\n          return Promise.resolve(rawSuggestions);\n        })[\"catch\"](handleError);\n      })[\"catch\"](handleError);\n    } catch (err) {\n      return handleError(err);\n    }\n  };\n\n  _proto.getSuggestionsQuery = function getSuggestionsQuery() {\n    return {\n      query: [{\n        id: 'DataSearch__suggestions',\n        dataField: ['key', 'key.autosuggest', 'key.search'],\n        searchOperators: this.searchOperators,\n        size: 5,\n        value: this.value,\n        defaultQuery: {\n          sort: [{\n            count: {\n              order: 'desc'\n            }\n          }]\n        }\n      }]\n    };\n  }\n  /*\n   methods to record analytics\n  */\n  // use this methods to record a search click event\n  ;\n\n  _proto._handleCompositeAggsResponse = function _handleCompositeAggsResponse(aggregationField, aggsResponse, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var prev = this.aggregationData;\n    this.aggregationData.setRaw(aggsResponse[aggregationField]);\n    this.aggregationData.setData(aggregationField, aggsResponse[aggregationField].buckets);\n\n    this._applyOptions({\n      stateChanges: options.stateChanges\n    }, 'aggregations', prev, this.aggregationData);\n  };\n\n  _proto._handleTransformResponse = function _handleTransformResponse(res) {\n    if (this.transformResponse && typeof this.transformResponse === 'function') {\n      return this.transformResponse(res);\n    }\n\n    return new Promise(function (resolve) {\n      return resolve(res);\n    });\n  };\n\n  _proto._handleTransformRequest = function _handleTransformRequest(requestOptions) {\n    if (this.transformRequest && typeof this.transformRequest === 'function') {\n      return this.transformRequest(requestOptions);\n    }\n\n    return new Promise(function (resolve) {\n      return resolve(requestOptions);\n    });\n  };\n\n  _proto._handleQuerySuggestionsResponse = function _handleQuerySuggestionsResponse(rawQuerySuggestions, options) {\n    var prev = this.querySuggestions;\n    var querySuggestions = rawQuerySuggestions && rawQuerySuggestions.DataSearch__suggestions;\n    this.querySuggestions.setRaw(querySuggestions);\n\n    this._applyOptions({\n      stateChanges: options.stateChanges\n    }, 'querySuggestions', prev, this.querySuggestions);\n  };\n\n  _proto._fetchRequest = function _fetchRequest(requestBody, isQuerySuggestionsAPI) {\n    var _this5 = this;\n\n    if (isQuerySuggestionsAPI === void 0) {\n      isQuerySuggestionsAPI = false;\n    }\n\n    var requestOptions = {\n      method: 'POST',\n      body: JSON.stringify(requestBody),\n      headers: _extends({}, this.headers)\n    };\n    return new Promise(function (resolve, reject) {\n      _this5._handleTransformRequest(requestOptions).then(function (finalRequestOptions) {\n        // set timestamp in request\n        var timestamp = Date.now();\n        var suffix = '_search';\n        if (_this5.enableAppbase) suffix = '_reactivesearch.v3';\n        var index = isQuerySuggestionsAPI ? '.suggestions' : _this5.index;\n        return fetch(_this5.url + \"/\" + index + \"/\" + suffix, finalRequestOptions).then(function (res) {\n          var responseHeaders = res.headers; // set search id\n\n          if (res.headers) {\n            _this5._queryId = res.headers.get('X-Search-Id') || null;\n          }\n\n          if (res.status >= 500) {\n            return reject(res);\n          }\n\n          if (res.status >= 400) {\n            return reject(res);\n          }\n\n          return res.json().then(function (data) {\n            _this5._handleTransformResponse(data).then(function (transformedData) {\n              if (transformedData && Object.prototype.hasOwnProperty.call(transformedData, 'error')) {\n                reject(transformedData);\n              }\n\n              var response = _extends({}, transformedData, {\n                _timestamp: timestamp,\n                _headers: responseHeaders\n              });\n\n              return resolve(response);\n            })[\"catch\"](function (e) {\n              console.warn('transformResponse rejected the promise with ', e);\n              return reject(e);\n            });\n          });\n        })[\"catch\"](function (e) {\n          return reject(e);\n        });\n      })[\"catch\"](function (e) {\n        console.warn('transformRequest rejected the promise with ', e);\n        return reject(e);\n      });\n    });\n  };\n\n  _proto._setSuggestionsError = function _setSuggestionsError(suggestionsError, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    this._setSuggestionsRequestStatus(REQUEST_STATUS.error);\n\n    var prev = this.suggestionsError;\n    this.suggestionsError = suggestionsError;\n\n    this._applyOptions(options, 'suggestionsError', prev, this.suggestionsError);\n  };\n\n  _proto._setError = function _setError(error, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    this._setRequestStatus(REQUEST_STATUS.error);\n\n    var prev = this.error;\n    this.error = error;\n\n    this._applyOptions(options, 'error', prev, this.error);\n  };\n\n  _proto._setRequestStatus = function _setRequestStatus(requestStatus) {\n    var prev = this.requestStatus;\n    this.requestStatus = requestStatus;\n\n    this._applyOptions({\n      stateChanges: true\n    }, 'requestStatus', prev, this.requestStatus);\n  };\n\n  _proto._setSuggestionsRequestStatus = function _setSuggestionsRequestStatus(suggestionsRequestStatus) {\n    var prev = this.suggestionsRequestStatus;\n    this.suggestionsRequestStatus = suggestionsRequestStatus;\n\n    this._applyOptions({\n      stateChanges: true\n    }, 'suggestionsRequestStatus', prev, this.suggestionsRequestStatus);\n  } // Method to set the default query value\n  ;\n\n  _proto._updateQuery = function _updateQuery(query, queryOptions) {\n    var prevQuery;\n\n    if (this.enableAppbase) {\n      prevQuery = _extends({}, this._query);\n      this._query = {\n        query: [_extends({}, this.getAppbaseSuggestionsQuery(), {\n          execute: false\n        }), this.getAppbaseResultQuery()],\n        settings: this.getAppbaseSettings()\n      };\n    } else prevQuery = this.getPreviousQuery(query, queryOptions);\n\n    this._applyOptions({\n      stateChanges: false\n    }, 'query', prevQuery, this._query);\n  };\n\n  _proto.getAppbaseSettings = function getAppbaseSettings() {\n    var _this$appbaseConfig = this.appbaseConfig,\n        recordAnalytics = _this$appbaseConfig.recordAnalytics,\n        customEvents = _this$appbaseConfig.customEvents,\n        enableQueryRules = _this$appbaseConfig.enableQueryRules,\n        userId = _this$appbaseConfig.userId;\n    return {\n      recordAnalytics: recordAnalytics,\n      customEvents: customEvents,\n      enableQueryRules: enableQueryRules,\n      userId: userId\n    };\n  };\n\n  _proto.getAppbaseResultQuery = function getAppbaseResultQuery() {\n    return {\n      id: 'SearchResult',\n      dataField: this.getDataFields(),\n      from: this.from,\n      size: this.size,\n      sortBy: this.sortBy,\n      includeFields: this.includeFields,\n      excludeFields: this.excludeFields,\n      react: {\n        and: 'DataSearch'\n      }\n    };\n  };\n\n  _proto.getPreviousQuery = function getPreviousQuery(query, queryOptions) {\n    // Set default query here\n    var finalQueryOptions = Searchbase.generateQueryOptions({\n      excludeFields: this.excludeFields,\n      includeFields: this.includeFields,\n      size: this.size,\n      from: this.from,\n      sortBy: this.sortBy,\n      sortByField: this.sortByField,\n      sortOptions: this.sortOptions\n    });\n    /**\n     * First priority goes to the custom query set by user otherwise execute the default query\n     * If none of the two exists execute the match_all\n     */\n\n    var finalQuery = query || Searchbase.defaultQuery(this.value, {\n      dataField: this.dataField,\n      searchOperators: this.searchOperators,\n      queryFormat: this.queryFormat,\n      fuzziness: this.fuzziness,\n      nestedField: this.nestedField\n    }) || {\n      match_all: {}\n    };\n    var prevQuery = this._query;\n    this._query = _extends({\n      query: finalQuery\n    }, Searchbase.highlightQuery(this.highlight, this.highlightField, this.dataField), {}, finalQueryOptions, {}, queryOptions);\n    return prevQuery;\n  };\n\n  _proto._updateSuggestionsQuery = function _updateSuggestionsQuery(query, queryOptions) {\n    var prevQuery;\n\n    if (this.enableAppbase) {\n      prevQuery = _extends({}, this._suggestionsQuery);\n      this._suggestionsQuery = {\n        query: [this.getAppbaseSuggestionsQuery()],\n        settings: this.getAppbaseSettings()\n      };\n    } else prevQuery = this.getPreviousSuggestionsQuery(query, queryOptions);\n\n    this._applyOptions({\n      stateChanges: false\n    }, 'suggestionsQuery', prevQuery, this._suggestionsQuery);\n  };\n\n  _proto.getAppbaseSuggestionsQuery = function getAppbaseSuggestionsQuery() {\n    return {\n      id: 'DataSearch',\n      dataField: this.getDataFields(),\n      value: this.value,\n      queryFormat: this.queryFormat,\n      nestedField: this.nestedField,\n      from: this.from,\n      size: this.size,\n      sortBy: this.sortBy,\n      aggregationField: this.aggregationField,\n      includeFields: this.includeFields,\n      excludeFields: this.excludeFields,\n      fuzziness: this.fuzziness,\n      searchOperators: this.searchOperators,\n      highlight: this.highlight,\n      highlightField: this.highlightField\n    };\n  };\n\n  _proto.getPreviousSuggestionsQuery = function getPreviousSuggestionsQuery(query, queryOptions) {\n    // Set default suggestions query here\n    var finalQueryOptions = Searchbase.generateQueryOptions({\n      aggregationField: this.aggregationField,\n      size: this.size\n    });\n    /**\n     * First priority goes to the custom query set by user otherwise execute the default query\n     * If none of the two exists execute the match_all\n     */\n\n    var finalQuery = query || Searchbase.defaultQuery(this.value, {\n      dataField: this.dataField,\n      searchOperators: this.searchOperators,\n      queryFormat: this.queryFormat,\n      fuzziness: this.fuzziness,\n      nestedField: this.nestedField\n    }) || {\n      match_all: {}\n    };\n\n    var prevQuery = _extends({}, this._suggestionsQuery);\n\n    this._suggestionsQuery = _extends({\n      query: finalQuery\n    }, Searchbase.highlightQuery(this.highlight, this.highlightField, this.dataField), {}, finalQueryOptions, {}, queryOptions);\n    return prevQuery;\n  };\n\n  _proto.getDataFields = function getDataFields() {\n    var fields = [];\n\n    if (this.dataField === 'string') {\n      fields = [this.dataField];\n    } else if (Array.isArray(this.dataField)) {\n      this.dataField.forEach(function (dataField) {\n        if (typeof dataField === 'object') {\n          fields.push(dataField.field);\n        } else {\n          fields.push(dataField);\n        }\n      });\n    }\n\n    return fields;\n  } // Method to apply the changed based on set options\n  ;\n\n  _proto._applyOptions = function _applyOptions(options, key, prevValue, nextValue) {\n    // Trigger mic events\n    if (key === 'micStatus' && this.onMicStatusChange) {\n      this.onMicStatusChange(nextValue, prevValue);\n    } // Trigger events\n\n\n    if (key === 'query' && this.onQueryChange) {\n      this.onQueryChange(nextValue, prevValue);\n    }\n\n    if (key === 'suggestionsQuery' && this.onSuggestionsQueryChange) {\n      this.onSuggestionsQueryChange(nextValue, prevValue);\n    }\n\n    if (key === 'value' && this.onValueChange) {\n      this.onValueChange(nextValue, prevValue);\n    }\n\n    if (key === 'error' && this.onError) {\n      this.onError(nextValue);\n    }\n\n    if (key === 'suggestionsError' && this.onSuggestionsError) {\n      this.onSuggestionsError(nextValue);\n    }\n\n    if (key === 'results' && this.onResults) {\n      this.onResults(nextValue, prevValue);\n    }\n\n    if (key === 'suggestions' && this.onSuggestions) {\n      this.onSuggestions(nextValue, prevValue);\n    }\n\n    if (key === 'querySuggestions' && this.onQuerySuggestions) {\n      this.onQuerySuggestions(nextValue, prevValue);\n    }\n\n    if (key === 'aggregations' && this.onAggregationData) {\n      this.onAggregationData(nextValue, prevValue);\n    }\n\n    if (key === 'requestStatus' && this.onRequestStatusChange) {\n      this.onRequestStatusChange(nextValue, prevValue);\n    }\n\n    if (key === 'suggestionsRequestStatus' && this.onSuggestionsRequestStatusChange) {\n      this.onSuggestionsRequestStatusChange(nextValue, prevValue);\n    }\n\n    if (options.triggerQuery) {\n      this.triggerQuery();\n    }\n\n    if (options.triggerSuggestionsQuery) {\n      this.triggerSuggestionsQuery();\n    }\n\n    if (options.stateChanges !== false) {\n      var _this$stateChanges$ne;\n\n      this.stateChanges.next((_this$stateChanges$ne = {}, _this$stateChanges$ne[key] = {\n        prev: prevValue,\n        next: nextValue\n      }, _this$stateChanges$ne), key);\n    }\n  };\n\n  _createClass(Searchbase, [{\n    key: \"micStatus\",\n    get: function get() {\n      return this._micStatus;\n    }\n  }, {\n    key: \"micInstance\",\n    get: function get() {\n      return this._micInstance;\n    }\n  }, {\n    key: \"micActive\",\n    get: function get() {\n      return this._micStatus === MIC_STATUS.active;\n    }\n  }, {\n    key: \"micInactive\",\n    get: function get() {\n      return this._micStatus === MIC_STATUS.inactive;\n    }\n  }, {\n    key: \"micDenied\",\n    get: function get() {\n      return this._micStatus === MIC_STATUS.denied;\n    }\n  }, {\n    key: \"query\",\n    get: function get() {\n      return this._query;\n    }\n  }, {\n    key: \"suggestionsQuery\",\n    get: function get() {\n      return this._suggestionsQuery;\n    }\n  }, {\n    key: \"requestPending\",\n    get: function get() {\n      return this.requestStatus === REQUEST_STATUS.pending;\n    }\n  }, {\n    key: \"suggestionsRequestPending\",\n    get: function get() {\n      return this.suggestionsRequestStatus === REQUEST_STATUS.pending;\n    }\n  }]);\n\n  return Searchbase;\n}();\n/* ------------------ Static methods ------------------------------ */\n// function to generate the default query DSL\n\n\n_defineProperty(Searchbase, \"defaultQuery\", void 0);\n\n_defineProperty(Searchbase, \"shouldQuery\", void 0);\n\n_defineProperty(Searchbase, \"highlightQuery\", void 0);\n\n_defineProperty(Searchbase, \"compositeAggsQuery\", void 0);\n\n_defineProperty(Searchbase, \"generateQueryOptions\", void 0);\n\nSearchbase.defaultQuery = function (value, options) {\n  var finalQuery = null;\n  var fields;\n\n  if (value) {\n    if (Array.isArray(options.dataField)) {\n      fields = options.dataField;\n    } else {\n      fields = [options.dataField];\n    }\n\n    if (options.searchOperators) {\n      finalQuery = {\n        simple_query_string: Searchbase.shouldQuery(value, fields, options)\n      };\n    } else {\n      finalQuery = {\n        bool: {\n          should: Searchbase.shouldQuery(value, fields, options),\n          minimum_should_match: '1'\n        }\n      };\n    }\n  }\n\n  if (value === '') {\n    finalQuery = null;\n  }\n\n  if (finalQuery && options.nestedField) {\n    finalQuery = {\n      nested: {\n        path: options.nestedField,\n        query: finalQuery\n      }\n    };\n  }\n\n  return finalQuery;\n}; // helper function of default query\n\n\nSearchbase.shouldQuery = function (value, dataFields, options) {\n  if (options === void 0) {\n    options = {\n      searchOperators: false,\n      queryFormat: 'or',\n      fuzziness: 0\n    };\n  }\n\n  var fields = dataFields.map(function (dataField) {\n    if (typeof dataField === 'object') {\n      return \"\" + dataField.field + (dataField.weight ? \"^\" + dataField.weight : '');\n    }\n\n    return dataField;\n  });\n\n  if (options.searchOperators) {\n    return {\n      query: value,\n      fields: fields,\n      default_operator: options.queryFormat\n    };\n  }\n\n  if (options.queryFormat === 'and') {\n    return [{\n      multi_match: {\n        query: value,\n        fields: fields,\n        type: 'cross_fields',\n        operator: 'and'\n      }\n    }, {\n      multi_match: {\n        query: value,\n        fields: fields,\n        type: 'phrase',\n        operator: 'and'\n      }\n    }];\n  }\n\n  return [{\n    multi_match: {\n      query: value,\n      fields: fields,\n      type: 'best_fields',\n      operator: 'or',\n      fuzziness: options.fuzziness\n    }\n  }, {\n    multi_match: {\n      query: value,\n      fields: fields,\n      type: 'phrase',\n      operator: 'or'\n    }\n  }];\n}; // helper function to generate highlight query\n\n\nSearchbase.highlightQuery = function (highlight, highlightFields, dataFields) {\n  if (!highlight) return null;\n  var fields = {};\n  var highlightField = highlightFields || dataFields;\n  var flatHighlightedFields = typeof highlightFields === 'string' ? [highlightFields] : highlightFields;\n\n  if (typeof highlightField === 'string') {\n    fields[highlightField] = {};\n  } else if (Array.isArray(highlightField)) {\n    highlightField.forEach(function (item) {\n      if (typeof item === 'object') fields[item.field] = {};else fields[item] = {};\n    });\n  }\n\n  return {\n    highlight: _extends({\n      pre_tags: ['<mark>'],\n      post_tags: ['</mark>'],\n      fields: fields\n    }, flatHighlightedFields && {\n      require_field_match: false\n    })\n  };\n}; // helper function to generate composite aggregations query\n\n\nSearchbase.compositeAggsQuery = function (aggregationField, size) {\n  var _ref4, _aggs, _aggs2;\n\n  return {\n    aggs: (_aggs2 = {}, _aggs2[aggregationField] = {\n      composite: {\n        sources: [(_ref4 = {}, _ref4[aggregationField] = {\n          terms: {\n            field: aggregationField\n          }\n        }, _ref4)],\n        size: size\n      },\n      aggs: (_aggs = {}, _aggs[aggregationField] = {\n        top_hits: {\n          size: 1\n        }\n      }, _aggs)\n    }, _aggs2)\n  };\n}; // function to generate the query DSL options\n\n\nSearchbase.generateQueryOptions = function (options) {\n  var finalOptions = {};\n\n  if (options.size !== undefined) {\n    finalOptions.size = options.size;\n  }\n\n  if (options.from !== undefined) {\n    finalOptions.from = options.from;\n  }\n\n  if (options.includeFields || options.excludeFields) {\n    var source = {};\n\n    if (options.includeFields) {\n      source.includes = options.includeFields;\n    }\n\n    if (options.excludeFields) {\n      source.excludes = options.excludeFields;\n    }\n\n    finalOptions._source = source;\n  }\n\n  if (options.sortOptions) {\n    var _ref5;\n\n    finalOptions.sort = [(_ref5 = {}, _ref5[options.sortOptions[0].dataField] = {\n      order: options.sortOptions[0].sortBy\n    }, _ref5)];\n  } else if (options.sortBy && options.sortByField) {\n    var _ref6;\n\n    finalOptions.sort = [(_ref6 = {}, _ref6[options.sortByField] = {\n      order: options.sortBy\n    }, _ref6)];\n  }\n\n  if (options.aggregationField) {\n    finalOptions.aggs = Searchbase.compositeAggsQuery(options.aggregationField, options.size || 0).aggs;\n  }\n\n  return finalOptions;\n};\n\nexport default Searchbase;\n"]},"metadata":{},"sourceType":"module"}