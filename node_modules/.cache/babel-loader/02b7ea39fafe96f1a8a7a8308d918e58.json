{"ast":null,"code":"import URL from 'url-parser-lite';\nimport querystring from 'querystring';\nimport fetch from 'cross-fetch';\nimport stringify from 'json-stable-stringify';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nfunction contains(string, substring) {\n  return string.indexOf(substring) !== -1;\n}\n\nfunction isAppbase(url) {\n  return contains(url, 'scalr.api.appbase.io');\n}\n\nfunction btoa() {\n  var input = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  var str = input;\n  var output = ''; // eslint-disable-next-line\n\n  for (var block = 0, charCode, i = 0, map = chars; str.charAt(i | 0) || (map = '=', i % 1); // eslint-disable-line no-bitwise\n  output += map.charAt(63 & block >> 8 - i % 1 * 8) // eslint-disable-line no-bitwise\n  ) {\n    charCode = str.charCodeAt(i += 3 / 4);\n\n    if (charCode > 0xff) {\n      throw new Error('\"btoa\" failed: The string to be encoded contains characters outside of the Latin1 range.');\n    }\n\n    block = block << 8 | charCode; // eslint-disable-line no-bitwise\n  }\n\n  return output;\n}\n\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0; // eslint-disable-line no-bitwise\n\n    var v = c === 'x' ? r : r & 0x3 | 0x8; // eslint-disable-line no-bitwise\n\n    return v.toString(16);\n  });\n}\n\nfunction validateRSQuery(query) {\n  var isSuggestionsAPI = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  if (query && Object.prototype.toString.call(query) === '[object Array]') {\n    for (var i = 0; i < query.length; i += 1) {\n      var q = query[i];\n\n      if (q) {\n        if (!q.id) {\n          return new Error('\\'id\\' field must be present in query object');\n        } // `dataField` is only optional for search types\n\n\n        if (q.type !== 'search' || isSuggestionsAPI) {\n          if (!q.dataField) return new Error('\\'dataField\\' field must be present in query object');\n        }\n\n        if (q.dataField && Object.prototype.toString.call(q.dataField) !== '[object Array]') {\n          return new Error('\\'dataField\\' field must be an array');\n        }\n      } else {\n        return new Error('query object can not have an empty value');\n      }\n    }\n\n    return true;\n  }\n\n  return new Error('invalid query value, \\'query\\' value must be an array');\n}\n\nfunction validate(object, fields) {\n  var invalid = [];\n  var emptyFor = {\n    object: null,\n    string: ''\n  };\n  var keys = Object.keys(fields);\n  keys.forEach(function (key) {\n    var type = fields[key]; // eslint-disable-next-line\n\n    if (_typeof(object[key]) !== type || object[key] === emptyFor[type]) {\n      invalid.push(key);\n    }\n  });\n  var missing = '';\n\n  for (var i = 0; i < invalid.length; i += 1) {\n    missing += invalid[i] + ', ';\n  }\n\n  if (invalid.length > 0) {\n    return new Error('fields missing: ' + missing);\n  }\n\n  return true;\n}\n\nfunction removeUndefined() {\n  var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (value || !(Object.keys(value).length === 0 && value.constructor === Object)) {\n    return JSON.parse(JSON.stringify(value));\n  }\n\n  return null;\n}\n/**\n * Send only when a connection is opened\n * @param {Object} socket\n * @param {Function} callback\n */\n\n\nfunction waitForSocketConnection(socket, callback) {\n  setTimeout(function () {\n    if (socket.readyState === 1) {\n      if (callback != null) {\n        callback();\n      }\n    } else {\n      waitForSocketConnection(socket, callback);\n    }\n  }, 5); // wait 5 ms for the connection...\n}\n\nfunction encodeHeaders() {\n  var headers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var shouldEncode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true; // Encode headers\n\n  var encodedHeaders = {};\n\n  if (shouldEncode) {\n    Object.keys(headers).forEach(function (header) {\n      encodedHeaders[header] = encodeURI(headers[header]);\n    });\n  } else {\n    encodedHeaders = headers;\n  }\n\n  return encodedHeaders;\n}\n/**\n * Returns an instance of Appbase client\n * @param {Object} config To configure properties\n * @param {String} config.url\n * @param {String} config.app\n * @param {String} config.credentials\n * @param {String} config.username\n * @param {String} config.password\n * A callback function which will be invoked before a fetch request made\n */\n\n\nfunction AppBase(config) {\n  var _URL = URL(config.url || ''),\n      _URL$auth = _URL.auth,\n      auth = _URL$auth === undefined ? null : _URL$auth,\n      _URL$host = _URL.host,\n      host = _URL$host === undefined ? '' : _URL$host,\n      _URL$path = _URL.path,\n      path = _URL$path === undefined ? '' : _URL$path,\n      _URL$protocol = _URL.protocol,\n      protocol = _URL$protocol === undefined ? '' : _URL$protocol;\n\n  var url = host + path; // Validate config and throw appropriate error\n\n  if (typeof url !== 'string' || url === '') {\n    throw new Error('URL not present in options.');\n  }\n\n  if (typeof config.app !== 'string' || config.app === '') {\n    throw new Error('App name is not present in options.');\n  }\n\n  if (typeof protocol !== 'string' || protocol === '') {\n    throw new Error('Protocol is not present in url. URL should be of the form https://scalr.api.appbase.io');\n  } // Parse url\n\n\n  if (url.slice(-1) === '/') {\n    url = url.slice(0, -1);\n  }\n\n  var credentials = auth || null;\n  /**\n   * Credentials can be provided as a part of the URL,\n   * as username, password args or as a credentials argument directly */\n\n  if (typeof config.credentials === 'string' && config.credentials !== '') {\n    // eslint-disable-next-line\n    credentials = config.credentials;\n  } else if (typeof config.username === 'string' && config.username !== '' && typeof config.password === 'string' && config.password !== '') {\n    credentials = config.username + ':' + config.password;\n  }\n\n  if (isAppbase(url) && credentials === null) {\n    throw new Error('Authentication information is not present. Did you add credentials?');\n  }\n\n  this.url = url;\n  this.protocol = protocol;\n  this.app = config.app;\n  this.credentials = credentials;\n  this.headers = {};\n}\n/**\n * To perform fetch request\n * @param {Object} args\n * @param {String} args.method\n * @param {String} args.path\n * @param {Object} args.params\n * @param {Object} args.body\n * @param {boolean} args.isSuggestionsAPI\n */\n\n\nfunction fetchRequest(args) {\n  var _this = this;\n\n  return new Promise(function (resolve, reject) {\n    var parsedArgs = removeUndefined(args);\n\n    try {\n      var method = parsedArgs.method,\n          path = parsedArgs.path,\n          params = parsedArgs.params,\n          body = parsedArgs.body,\n          isRSAPI = parsedArgs.isRSAPI,\n          isSuggestionsAPI = parsedArgs.isSuggestionsAPI;\n      var app = isSuggestionsAPI ? '.suggestions' : _this.app;\n      var bodyCopy = body;\n      var contentType = path.endsWith('msearch') || path.endsWith('bulk') ? 'application/x-ndjson' : 'application/json';\n      var headers = Object.assign({}, {\n        Accept: 'application/json',\n        'Content-Type': contentType\n      }, _this.headers);\n      var timestamp = Date.now();\n\n      if (_this.credentials) {\n        headers.Authorization = 'Basic ' + btoa(_this.credentials);\n      }\n\n      var requestOptions = {\n        method: method,\n        headers: headers\n      };\n\n      if (Array.isArray(bodyCopy)) {\n        var arrayBody = '';\n        bodyCopy.forEach(function (item) {\n          arrayBody += JSON.stringify(item);\n          arrayBody += '\\n';\n        });\n        bodyCopy = arrayBody;\n      } else {\n        bodyCopy = JSON.stringify(bodyCopy) || {};\n      }\n\n      if (Object.keys(bodyCopy).length !== 0) {\n        requestOptions.body = bodyCopy;\n      }\n\n      var handleTransformRequest = function handleTransformRequest(res) {\n        if (_this.transformRequest && typeof _this.transformRequest === 'function') {\n          var tarnsformRequestPromise = _this.transformRequest(res);\n\n          return tarnsformRequestPromise instanceof Promise ? tarnsformRequestPromise : Promise.resolve(tarnsformRequestPromise);\n        }\n\n        return Promise.resolve(res);\n      };\n\n      var responseHeaders = {};\n      var paramsString = '';\n\n      if (params) {\n        paramsString = '?' + querystring.stringify(params);\n      }\n\n      var finalURL = _this.protocol + '://' + _this.url + '/' + app + '/' + path + paramsString;\n      return handleTransformRequest(Object.assign({}, {\n        url: finalURL\n      }, requestOptions)).then(function (ts) {\n        var transformedRequest = Object.assign({}, ts);\n        var url = transformedRequest.url;\n        delete transformedRequest.url;\n        return fetch(url || finalURL, transformedRequest).then(function (res) {\n          if (res.status >= 500) {\n            return reject(res);\n          }\n\n          responseHeaders = res.headers;\n          return res.json().then(function (data) {\n            if (res.status >= 400) {\n              return reject(res);\n            }\n\n            if (data && data.error) {\n              return reject(data);\n            } // Handle error from RS API RESPONSE\n\n\n            if (isRSAPI && data && Object.prototype.toString.call(data) === '[object Object]') {\n              if (body && body.query && body.query instanceof Array) {\n                var errorResponses = 0;\n                var allResponses = body.query.filter(function (q) {\n                  return q.execute || q.execute === undefined;\n                }).length;\n\n                if (data) {\n                  Object.keys(data).forEach(function (key) {\n                    if (data[key] && Object.prototype.hasOwnProperty.call(data[key], 'error')) {\n                      errorResponses += 1;\n                    }\n                  });\n                } // reject only when all responses has error\n\n\n                if (errorResponses > 0 && allResponses === errorResponses) {\n                  return reject(data);\n                }\n              }\n            } // Handle error from _msearch response\n\n\n            if (data && data.responses instanceof Array) {\n              var _allResponses = data.responses.length;\n              var _errorResponses = data.responses.filter(function (entry) {\n                return Object.prototype.hasOwnProperty.call(entry, 'error');\n              }).length; // reject only when all responses has error\n\n              if (_allResponses === _errorResponses) {\n                return reject(data);\n              }\n            }\n\n            var response = Object.assign({}, data, {\n              _timestamp: timestamp,\n              _headers: responseHeaders\n            });\n            return resolve(response);\n          });\n        }).catch(function (e) {\n          return reject(e);\n        });\n      }).catch(function (err) {\n        return reject(err);\n      });\n    } catch (e) {\n      return reject(e);\n    }\n  });\n}\n\nvar WebSocket = typeof window !== 'undefined' ? window.WebSocket : require('ws');\n/**\n * To connect a web socket\n * @param {Object} args\n * @param {String} args.method\n * @param {String} args.path\n * @param {Object} args.params\n * @param {Object} args.body\n */\n\nfunction wsRequest(args, onData, onError, onClose) {\n  var _this = this;\n\n  try {\n    var parsedArgs = removeUndefined(args);\n    var method = parsedArgs.method,\n        path = parsedArgs.path,\n        params = parsedArgs.params;\n    var bodyCopy = args.body;\n\n    if (!bodyCopy || (typeof bodyCopy === 'undefined' ? 'undefined' : _typeof(bodyCopy)) !== 'object') {\n      bodyCopy = {};\n    }\n\n    var init = function init() {\n      _this.ws = new WebSocket('wss://' + _this.url + '/' + _this.app);\n      _this.id = uuidv4();\n      _this.request = {\n        id: _this.id,\n        path: _this.app + '/' + path + '?' + querystring.stringify(params),\n        method: method,\n        body: bodyCopy\n      };\n\n      if (_this.credentials) {\n        _this.request.authorization = 'Basic ' + btoa(_this.credentials);\n      }\n\n      _this.result = {};\n\n      _this.closeHandler = function () {\n        _this.wsClosed();\n      };\n\n      _this.errorHandler = function (err) {\n        _this.processError.apply(_this, [err]);\n      };\n\n      _this.messageHandler = function (message) {\n        var dataObj = JSON.parse(message.data);\n\n        if (dataObj.body && dataObj.body.status >= 400) {\n          _this.processError.apply(_this, [dataObj]);\n        } else {\n          _this.processMessage.apply(_this, [dataObj]);\n        }\n      };\n\n      _this.send = function (request) {\n        waitForSocketConnection(_this.ws, function () {\n          try {\n            _this.ws.send(JSON.stringify(request));\n          } catch (e) {\n            console.warn(e);\n          }\n        });\n      };\n\n      _this.ws.onmessage = _this.messageHandler;\n      _this.ws.onerror = _this.errorHandler;\n      _this.ws.onclose = _this.closeHandler;\n\n      _this.send(_this.request);\n\n      _this.result.stop = _this.stop;\n      _this.result.reconnect = _this.reconnect;\n      return _this.result;\n    };\n\n    this.wsClosed = function () {\n      if (onClose) {\n        onClose();\n      }\n    };\n\n    this.stop = function () {\n      _this.ws.onmessage = undefined;\n      _this.ws.onclose = undefined;\n      _this.ws.onerror = undefined;\n\n      _this.wsClosed();\n\n      var unsubRequest = JSON.parse(JSON.stringify(_this.request));\n      unsubRequest.unsubscribe = true;\n\n      if (_this.unsubscribed !== true) {\n        _this.send(unsubRequest);\n      }\n\n      _this.unsubscribed = true;\n    };\n\n    this.reconnect = function () {\n      _this.stop();\n\n      return wsRequest(args, onData, onError, onClose);\n    };\n\n    this.processError = function (err) {\n      if (onError) {\n        onError(err);\n      } else {\n        console.warn(err);\n      }\n    };\n\n    this.processMessage = function (origDataObj) {\n      var dataObj = JSON.parse(JSON.stringify(origDataObj));\n\n      if (!dataObj.id && dataObj.message) {\n        if (onError) {\n          onError(dataObj);\n        }\n\n        return;\n      }\n\n      if (dataObj.id === _this.id) {\n        if (dataObj.message) {\n          delete dataObj.id;\n\n          if (onError) {\n            onError(dataObj);\n          }\n\n          return;\n        }\n\n        if (dataObj.query_id) {\n          _this.query_id = dataObj.query_id;\n        }\n\n        if (dataObj.channel) {\n          _this.channel = dataObj.channel;\n        }\n\n        if (dataObj.body && dataObj.body !== '') {\n          if (onData) {\n            onData(dataObj.body);\n          }\n        }\n\n        return;\n      }\n\n      if (!dataObj.id && dataObj.channel && dataObj.channel === _this.channel) {\n        if (onData) {\n          onData(dataObj.event);\n        }\n      }\n    };\n\n    return init();\n  } catch (e) {\n    if (onError) {\n      onError(e);\n    } else {\n      console.warn(e);\n    }\n\n    return null;\n  }\n}\n/**\n * Index Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {String} args.id\n */\n\n\nfunction indexApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    type: 'string',\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      id = parsedArgs.id,\n      body = parsedArgs.body;\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  delete parsedArgs.id;\n  var path = void 0;\n\n  if (id) {\n    path = type + '/' + encodeURIComponent(id);\n  } else {\n    path = type;\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n/**\n * Get Service\n * @param {Object} args\n * @param {String} args.type\n * @param {String} args.id\n */\n\n\nfunction getApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    type: 'string',\n    id: 'string'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      id = parsedArgs.id;\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n  var path = type + '/' + encodeURIComponent(id);\n  return this.performFetchRequest({\n    method: 'GET',\n    path: path,\n    params: parsedArgs\n  });\n}\n/**\n * Update Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {String} args.id\n */\n\n\nfunction updateApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    type: 'string',\n    id: 'string',\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      id = parsedArgs.id,\n      body = parsedArgs.body;\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n  delete parsedArgs.body;\n  var path = type + '/' + encodeURIComponent(id) + '/_update';\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n/**\n * Delete Service\n * @param {Object} args\n * @param {String} args.type\n * @param {String} args.id\n */\n\n\nfunction deleteApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    type: 'string',\n    id: 'string'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      id = parsedArgs.id;\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n  var path = type + '/' + encodeURIComponent(id);\n  return this.performFetchRequest({\n    method: 'DELETE',\n    path: path,\n    params: parsedArgs\n  });\n}\n/**\n * Bulk Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\n\n\nfunction bulkApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      body = parsedArgs.body;\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  var path = void 0;\n\n  if (type) {\n    path = type + '/_bulk';\n  } else {\n    path = '/_bulk';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n/**\n * Search Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\n\n\nfunction searchApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = void 0;\n\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type.join();\n  } else {\n    // eslint-disable-next-line\n    type = parsedArgs.type;\n  }\n\n  var body = parsedArgs.body;\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  var path = void 0;\n\n  if (type) {\n    path = type + '/_search';\n  } else {\n    path = '_search';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n/**\n * Msearch Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\n\n\nfunction msearchApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = void 0;\n\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type.join();\n  } else {\n    type = parsedArgs.type;\n  }\n\n  var body = parsedArgs.body;\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  var path = void 0;\n\n  if (type) {\n    path = type + '/_msearch';\n  } else {\n    path = '_msearch';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n/**\n * ReactiveSearch API Service for v3\n * @param {Array<Object>} query\n * @param {Object} settings\n * @param {boolean} settings.recordAnalytics\n * @param {boolean} settings.userId\n * @param {boolean} settings.enableQueryRules\n * @param {boolean} settings.customEvents\n */\n\n\nfunction reactiveSearchv3Api(query, settings) {\n  var parsedSettings = removeUndefined(settings); // Validate query\n\n  var valid = validateRSQuery(query);\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var body = {\n    settings: parsedSettings,\n    query: query\n  };\n  return this.performFetchRequest({\n    method: 'POST',\n    path: '_reactivesearch.v3',\n    body: body,\n    isRSAPI: true\n  });\n}\n/**\n * Stream Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Boolean} args.stream\n * @param {String} args.id\n * @param {Function} onData\n * @param {Function} onError\n * @param {Function} onClose\n */\n\n\nfunction getStream(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    type: 'string',\n    id: 'string'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      id = parsedArgs.id;\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n  delete parsedArgs.stream;\n\n  if (parsedArgs.stream === true) {\n    parsedArgs.stream = 'true';\n  } else {\n    delete parsedArgs.stream;\n    parsedArgs.streamonly = 'true';\n  }\n\n  for (var _len = arguments.length, rest = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    rest[_key - 1] = arguments[_key];\n  }\n\n  return this.performWsRequest.apply(this, [{\n    method: 'GET',\n    path: type + '/' + encodeURIComponent(id),\n    params: parsedArgs\n  }].concat(rest));\n}\n/**\n * Search Stream\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {Boolean} args.stream\n * @param {Function} onData\n * @param {Function} onError\n * @param {Function} onClose\n */\n\n\nfunction searchStreamApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  if (parsedArgs.type === undefined || Array.isArray(parsedArgs.type) && parsedArgs.type.length === 0) {\n    throw new Error('Missing fields: type');\n  }\n\n  var type = void 0;\n\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type.join();\n  } else {\n    type = parsedArgs.type;\n  }\n\n  var body = parsedArgs.body;\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  delete parsedArgs.stream;\n  parsedArgs.streamonly = 'true';\n\n  for (var _len = arguments.length, rest = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    rest[_key - 1] = arguments[_key];\n  }\n\n  return this.performWsRequest.apply(this, [{\n    method: 'POST',\n    path: type + '/_search',\n    params: parsedArgs,\n    body: body\n  }].concat(rest));\n}\n/**\n * Webhook Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {Object} webhook\n * @param {Function} onData\n * @param {Function} onError\n * @param {Function} onClose\n */\n\n\nfunction searchStreamToURLApi(args, webhook) {\n  for (var _len = arguments.length, rest = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n    rest[_key - 2] = arguments[_key];\n  }\n\n  var _this = this;\n\n  var parsedArgs = removeUndefined(args);\n  var bodyCopy = parsedArgs.body;\n  var type = void 0;\n  var typeString = void 0; // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  if (parsedArgs.type === undefined || !(typeof parsedArgs.type === 'string' || Array.isArray(parsedArgs.type)) || parsedArgs.type === '' || parsedArgs.type.length === 0) {\n    throw new Error('fields missing: type');\n  }\n\n  valid = validate(parsedArgs.body, {\n    query: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type;\n    typeString = parsedArgs.type.join();\n  } else {\n    type = [parsedArgs.type];\n    typeString = parsedArgs.type;\n  }\n\n  var webhooks = [];\n  var _bodyCopy = bodyCopy,\n      query = _bodyCopy.query;\n\n  if (typeof webhook === 'string') {\n    var webHookObj = {};\n    webHookObj.url = webhook;\n    webHookObj.method = 'GET';\n    webhooks.push(webHookObj);\n  } else if (webhook.constructor === Array) {\n    webhooks = webhook;\n  } else if (webhook === Object(webhook)) {\n    webhooks.push(webhook);\n  } else {\n    throw new Error('fields missing: second argument(webhook) is necessary');\n  }\n\n  var populateBody = function populateBody() {\n    bodyCopy = {};\n    bodyCopy.webhooks = webhooks;\n    bodyCopy.query = query;\n    bodyCopy.type = type;\n  };\n\n  populateBody();\n  var encode64 = btoa(stringify(query));\n  var path = '.percolator/webhooks-0-' + typeString + '-0-' + encode64;\n\n  this.change = function () {\n    webhooks = [];\n\n    if (typeof parsedArgs === 'string') {\n      var webhook2 = {};\n      webhook2.url = parsedArgs;\n      webhook2.method = 'POST';\n      webhooks.push(webhook2);\n    } else if (parsedArgs.constructor === Array) {\n      webhooks = parsedArgs;\n    } else if (parsedArgs === Object(parsedArgs)) {\n      webhooks.push(parsedArgs);\n    } else {\n      throw new Error('fields missing: one of webhook or url fields is required');\n    }\n\n    populateBody();\n    return _this.performRequest('POST');\n  };\n\n  this.stop = function () {\n    bodyCopy = undefined;\n    return _this.performRequest('DELETE');\n  };\n\n  this.performRequest = function (method) {\n    var res = _this.performWsRequest.apply(_this, [{\n      method: method,\n      path: path,\n      body: bodyCopy\n    }].concat(rest));\n\n    res.change = _this.change;\n    res.stop = _this.stop;\n    return res;\n  };\n\n  return this.performRequest('POST');\n}\n/**\n * To get types\n */\n\n\nfunction getTypesService() {\n  var _this = this;\n\n  return new Promise(function (resolve, reject) {\n    try {\n      return _this.performFetchRequest({\n        method: 'GET',\n        path: '_mapping'\n      }).then(function (data) {\n        var types = Object.keys(data[_this.app].mappings).filter(function (type) {\n          return type !== '_default_';\n        });\n        return resolve(types);\n      });\n    } catch (e) {\n      return reject(e);\n    }\n  });\n}\n/**\n * To get mappings\n */\n\n\nfunction getMappings() {\n  return this.performFetchRequest({\n    method: 'GET',\n    path: '_mapping'\n  });\n}\n/**\n * ReactiveSearch suggestions API for v3\n * @param {Array<Object>} query\n * @param {Object} settings\n * @param {boolean} settings.recordAnalytics\n * @param {boolean} settings.userId\n * @param {boolean} settings.enableQueryRules\n * @param {boolean} settings.customEvents\n */\n\n\nfunction getSuggestionsv3Api(query, settings) {\n  var parsedSettings = removeUndefined(settings); // Validate query\n\n  var valid = validateRSQuery(query, true);\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var body = {\n    settings: parsedSettings,\n    query: query\n  };\n  return this.performFetchRequest({\n    method: 'POST',\n    path: '_reactivesearch.v3',\n    body: body,\n    isRSAPI: true,\n    isSuggestionsAPI: true\n  });\n}\n\nfunction index(config) {\n  var client = new AppBase(config);\n  AppBase.prototype.performFetchRequest = fetchRequest;\n  AppBase.prototype.performWsRequest = wsRequest;\n  AppBase.prototype.index = indexApi;\n  AppBase.prototype.get = getApi;\n  AppBase.prototype.update = updateApi;\n  AppBase.prototype.delete = deleteApi;\n  AppBase.prototype.bulk = bulkApi;\n  AppBase.prototype.search = searchApi;\n  AppBase.prototype.msearch = msearchApi;\n  AppBase.prototype.reactiveSearchv3 = reactiveSearchv3Api;\n  AppBase.prototype.getQuerySuggestions = getSuggestionsv3Api;\n  AppBase.prototype.getStream = getStream;\n  AppBase.prototype.searchStream = searchStreamApi;\n  AppBase.prototype.searchStreamToURL = searchStreamToURLApi;\n  AppBase.prototype.getTypes = getTypesService;\n  AppBase.prototype.getMappings = getMappings;\n\n  AppBase.prototype.setHeaders = function () {\n    var headers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var shouldEncode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false; // Encode headers\n\n    if (shouldEncode) {\n      this.headers = encodeHeaders(headers);\n    } else {\n      this.headers = headers;\n    }\n  };\n\n  if (typeof window !== 'undefined') {\n    window.Appbase = client;\n  }\n\n  return client;\n}\n\nexport default index;","map":{"version":3,"sources":["/Users/rogetgeoffroy/Desktop/Folders/react_js_folder/react-live-search-app/live-search/node_modules/appbase-js/dist/appbase-js.es.js"],"names":["URL","querystring","fetch","stringify","_typeof","Symbol","iterator","obj","constructor","prototype","contains","string","substring","indexOf","isAppbase","url","btoa","input","arguments","length","undefined","chars","str","output","block","charCode","i","map","charAt","charCodeAt","Error","uuidv4","replace","c","r","Math","random","v","toString","validateRSQuery","query","isSuggestionsAPI","Object","call","q","id","type","dataField","validate","object","fields","invalid","emptyFor","keys","forEach","key","push","missing","removeUndefined","value","JSON","parse","waitForSocketConnection","socket","callback","setTimeout","readyState","encodeHeaders","headers","shouldEncode","encodedHeaders","header","encodeURI","AppBase","config","_URL","_URL$auth","auth","_URL$host","host","_URL$path","path","_URL$protocol","protocol","app","slice","credentials","username","password","fetchRequest","args","_this","Promise","resolve","reject","parsedArgs","method","params","body","isRSAPI","bodyCopy","contentType","endsWith","assign","Accept","timestamp","Date","now","Authorization","requestOptions","Array","isArray","arrayBody","item","handleTransformRequest","res","transformRequest","tarnsformRequestPromise","responseHeaders","paramsString","finalURL","then","ts","transformedRequest","status","json","data","error","errorResponses","allResponses","filter","execute","hasOwnProperty","responses","_allResponses","_errorResponses","entry","response","_timestamp","_headers","catch","e","err","WebSocket","window","require","wsRequest","onData","onError","onClose","init","ws","request","authorization","result","closeHandler","wsClosed","errorHandler","processError","apply","messageHandler","message","dataObj","processMessage","send","console","warn","onmessage","onerror","onclose","stop","reconnect","unsubRequest","unsubscribe","unsubscribed","origDataObj","query_id","channel","event","indexApi","valid","encodeURIComponent","performFetchRequest","getApi","updateApi","deleteApi","bulkApi","searchApi","join","msearchApi","reactiveSearchv3Api","settings","parsedSettings","getStream","stream","streamonly","_len","rest","_key","performWsRequest","concat","searchStreamApi","searchStreamToURLApi","webhook","typeString","webhooks","_bodyCopy","webHookObj","populateBody","encode64","change","webhook2","performRequest","getTypesService","types","mappings","getMappings","getSuggestionsv3Api","index","client","get","update","delete","bulk","search","msearch","reactiveSearchv3","getQuerySuggestions","searchStream","searchStreamToURL","getTypes","setHeaders","Appbase"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,iBAAhB;AACA,OAAOC,WAAP,MAAwB,aAAxB;AACA,OAAOC,KAAP,MAAkB,aAAlB;AACA,OAAOC,SAAP,MAAsB,uBAAtB;;AAEA,IAAIC,OAAO,GAAG,OAAOC,MAAP,KAAkB,UAAlB,IAAgC,OAAOA,MAAM,CAACC,QAAd,KAA2B,QAA3D,GAAsE,UAAUC,GAAV,EAAe;AACjG,SAAO,OAAOA,GAAd;AACD,CAFa,GAEV,UAAUA,GAAV,EAAe;AACjB,SAAOA,GAAG,IAAI,OAAOF,MAAP,KAAkB,UAAzB,IAAuCE,GAAG,CAACC,WAAJ,KAAoBH,MAA3D,IAAqEE,GAAG,KAAKF,MAAM,CAACI,SAApF,GAAgG,QAAhG,GAA2G,OAAOF,GAAzH;AACD,CAJD;;AAMA,SAASG,QAAT,CAAkBC,MAAlB,EAA0BC,SAA1B,EAAqC;AACnC,SAAOD,MAAM,CAACE,OAAP,CAAeD,SAAf,MAA8B,CAAC,CAAtC;AACD;;AACD,SAASE,SAAT,CAAmBC,GAAnB,EAAwB;AACtB,SAAOL,QAAQ,CAACK,GAAD,EAAM,sBAAN,CAAf;AACD;;AACD,SAASC,IAAT,GAAgB;AACd,MAAIC,KAAK,GAAGC,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAhF;AAEA,MAAIG,KAAK,GAAG,mEAAZ;AACA,MAAIC,GAAG,GAAGL,KAAV;AACA,MAAIM,MAAM,GAAG,EAAb,CALc,CAOd;;AACA,OAAK,IAAIC,KAAK,GAAG,CAAZ,EAAeC,QAAf,EAAyBC,CAAC,GAAG,CAA7B,EAAgCC,GAAG,GAAGN,KAA3C,EAAkDC,GAAG,CAACM,MAAJ,CAAWF,CAAC,GAAG,CAAf,MAAsBC,GAAG,GAAG,GAAN,EAAWD,CAAC,GAAG,CAArC,CAAlD,EAA2F;AAC3FH,EAAAA,MAAM,IAAII,GAAG,CAACC,MAAJ,CAAW,KAAKJ,KAAK,IAAI,IAAIE,CAAC,GAAG,CAAJ,GAAQ,CAArC,CADV,CACkD;AADlD,IAEE;AACAD,IAAAA,QAAQ,GAAGH,GAAG,CAACO,UAAJ,CAAeH,CAAC,IAAI,IAAI,CAAxB,CAAX;;AAEA,QAAID,QAAQ,GAAG,IAAf,EAAqB;AACnB,YAAM,IAAIK,KAAJ,CAAU,0FAAV,CAAN;AACD;;AAEDN,IAAAA,KAAK,GAAGA,KAAK,IAAI,CAAT,GAAaC,QAArB,CAPA,CAO+B;AAChC;;AAED,SAAOF,MAAP;AACD;;AACD,SAASQ,MAAT,GAAkB;AAChB,SAAO,uCAAuCC,OAAvC,CAA+C,OAA/C,EAAwD,UAAUC,CAAV,EAAa;AAC1E,QAAIC,CAAC,GAAGC,IAAI,CAACC,MAAL,KAAgB,EAAhB,GAAqB,CAA7B,CAD0E,CAC1C;;AAEhC,QAAIC,CAAC,GAAGJ,CAAC,KAAK,GAAN,GAAYC,CAAZ,GAAgBA,CAAC,GAAG,GAAJ,GAAU,GAAlC,CAH0E,CAGnC;;AACvC,WAAOG,CAAC,CAACC,QAAF,CAAW,EAAX,CAAP;AACD,GALM,CAAP;AAMD;;AAED,SAASC,eAAT,CAAyBC,KAAzB,EAAgC;AAC9B,MAAIC,gBAAgB,GAAGvB,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,KAA3F;;AAEA,MAAIsB,KAAK,IAAIE,MAAM,CAACjC,SAAP,CAAiB6B,QAAjB,CAA0BK,IAA1B,CAA+BH,KAA/B,MAA0C,gBAAvD,EAAyE;AACvE,SAAK,IAAId,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGc,KAAK,CAACrB,MAA1B,EAAkCO,CAAC,IAAI,CAAvC,EAA0C;AACxC,UAAIkB,CAAC,GAAGJ,KAAK,CAACd,CAAD,CAAb;;AACA,UAAIkB,CAAJ,EAAO;AACL,YAAI,CAACA,CAAC,CAACC,EAAP,EAAW;AACT,iBAAO,IAAIf,KAAJ,CAAU,8CAAV,CAAP;AACD,SAHI,CAIL;;;AACA,YAAIc,CAAC,CAACE,IAAF,KAAW,QAAX,IAAuBL,gBAA3B,EAA6C;AAC3C,cAAI,CAACG,CAAC,CAACG,SAAP,EAAkB,OAAO,IAAIjB,KAAJ,CAAU,qDAAV,CAAP;AACnB;;AACD,YAAIc,CAAC,CAACG,SAAF,IAAeL,MAAM,CAACjC,SAAP,CAAiB6B,QAAjB,CAA0BK,IAA1B,CAA+BC,CAAC,CAACG,SAAjC,MAAgD,gBAAnE,EAAqF;AACnF,iBAAO,IAAIjB,KAAJ,CAAU,sCAAV,CAAP;AACD;AACF,OAXD,MAWO;AACL,eAAO,IAAIA,KAAJ,CAAU,0CAAV,CAAP;AACD;AACF;;AACD,WAAO,IAAP;AACD;;AACD,SAAO,IAAIA,KAAJ,CAAU,uDAAV,CAAP;AACD;;AAED,SAASkB,QAAT,CAAkBC,MAAlB,EAA0BC,MAA1B,EAAkC;AAChC,MAAIC,OAAO,GAAG,EAAd;AACA,MAAIC,QAAQ,GAAG;AACbH,IAAAA,MAAM,EAAE,IADK;AAEbtC,IAAAA,MAAM,EAAE;AAFK,GAAf;AAIA,MAAI0C,IAAI,GAAGX,MAAM,CAACW,IAAP,CAAYH,MAAZ,CAAX;AACAG,EAAAA,IAAI,CAACC,OAAL,CAAa,UAAUC,GAAV,EAAe;AAC1B,QAAIT,IAAI,GAAGI,MAAM,CAACK,GAAD,CAAjB,CAD0B,CAE1B;;AACA,QAAInD,OAAO,CAAC6C,MAAM,CAACM,GAAD,CAAP,CAAP,KAAyBT,IAAzB,IAAiCG,MAAM,CAACM,GAAD,CAAN,KAAgBH,QAAQ,CAACN,IAAD,CAA7D,EAAqE;AACnEK,MAAAA,OAAO,CAACK,IAAR,CAAaD,GAAb;AACD;AACF,GAND;AAOA,MAAIE,OAAO,GAAG,EAAd;;AACA,OAAK,IAAI/B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyB,OAAO,CAAChC,MAA5B,EAAoCO,CAAC,IAAI,CAAzC,EAA4C;AAC1C+B,IAAAA,OAAO,IAAIN,OAAO,CAACzB,CAAD,CAAP,GAAa,IAAxB;AACD;;AACD,MAAIyB,OAAO,CAAChC,MAAR,GAAiB,CAArB,EAAwB;AACtB,WAAO,IAAIW,KAAJ,CAAU,qBAAqB2B,OAA/B,CAAP;AACD;;AAED,SAAO,IAAP;AACD;;AAED,SAASC,eAAT,GAA2B;AACzB,MAAIC,KAAK,GAAGzC,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAhF;;AAEA,MAAIyC,KAAK,IAAI,EAAEjB,MAAM,CAACW,IAAP,CAAYM,KAAZ,EAAmBxC,MAAnB,KAA8B,CAA9B,IAAmCwC,KAAK,CAACnD,WAAN,KAAsBkC,MAA3D,CAAb,EAAiF;AAC/E,WAAOkB,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACzD,SAAL,CAAewD,KAAf,CAAX,CAAP;AACD;;AACD,SAAO,IAAP;AACD;AAED;;;;;;;AAKA,SAASG,uBAAT,CAAiCC,MAAjC,EAAyCC,QAAzC,EAAmD;AACjDC,EAAAA,UAAU,CAAC,YAAY;AACrB,QAAIF,MAAM,CAACG,UAAP,KAAsB,CAA1B,EAA6B;AAC3B,UAAIF,QAAQ,IAAI,IAAhB,EAAsB;AACpBA,QAAAA,QAAQ;AACT;AACF,KAJD,MAIO;AACLF,MAAAA,uBAAuB,CAACC,MAAD,EAASC,QAAT,CAAvB;AACD;AACF,GARS,EAQP,CARO,CAAV,CADiD,CAS1C;AACR;;AAED,SAASG,aAAT,GAAyB;AACvB,MAAIC,OAAO,GAAGlD,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAlF;AACA,MAAImD,YAAY,GAAGnD,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,IAAvF,CAFuB,CAIvB;;AACA,MAAIoD,cAAc,GAAG,EAArB;;AACA,MAAID,YAAJ,EAAkB;AAChB3B,IAAAA,MAAM,CAACW,IAAP,CAAYe,OAAZ,EAAqBd,OAArB,CAA6B,UAAUiB,MAAV,EAAkB;AAC7CD,MAAAA,cAAc,CAACC,MAAD,CAAd,GAAyBC,SAAS,CAACJ,OAAO,CAACG,MAAD,CAAR,CAAlC;AACD,KAFD;AAGD,GAJD,MAIO;AACLD,IAAAA,cAAc,GAAGF,OAAjB;AACD;;AACD,SAAOE,cAAP;AACD;AAED;;;;;;;;;;;;AAUA,SAASG,OAAT,CAAiBC,MAAjB,EAAyB;AACvB,MAAIC,IAAI,GAAG3E,GAAG,CAAC0E,MAAM,CAAC3D,GAAP,IAAc,EAAf,CAAd;AAAA,MACI6D,SAAS,GAAGD,IAAI,CAACE,IADrB;AAAA,MAEIA,IAAI,GAAGD,SAAS,KAAKxD,SAAd,GAA0B,IAA1B,GAAiCwD,SAF5C;AAAA,MAGIE,SAAS,GAAGH,IAAI,CAACI,IAHrB;AAAA,MAIIA,IAAI,GAAGD,SAAS,KAAK1D,SAAd,GAA0B,EAA1B,GAA+B0D,SAJ1C;AAAA,MAKIE,SAAS,GAAGL,IAAI,CAACM,IALrB;AAAA,MAMIA,IAAI,GAAGD,SAAS,KAAK5D,SAAd,GAA0B,EAA1B,GAA+B4D,SAN1C;AAAA,MAOIE,aAAa,GAAGP,IAAI,CAACQ,QAPzB;AAAA,MAQIA,QAAQ,GAAGD,aAAa,KAAK9D,SAAlB,GAA8B,EAA9B,GAAmC8D,aARlD;;AAUA,MAAInE,GAAG,GAAGgE,IAAI,GAAGE,IAAjB,CAXuB,CAavB;;AACA,MAAI,OAAOlE,GAAP,KAAe,QAAf,IAA2BA,GAAG,KAAK,EAAvC,EAA2C;AACzC,UAAM,IAAIe,KAAJ,CAAU,6BAAV,CAAN;AACD;;AACD,MAAI,OAAO4C,MAAM,CAACU,GAAd,KAAsB,QAAtB,IAAkCV,MAAM,CAACU,GAAP,KAAe,EAArD,EAAyD;AACvD,UAAM,IAAItD,KAAJ,CAAU,qCAAV,CAAN;AACD;;AACD,MAAI,OAAOqD,QAAP,KAAoB,QAApB,IAAgCA,QAAQ,KAAK,EAAjD,EAAqD;AACnD,UAAM,IAAIrD,KAAJ,CAAU,wFAAV,CAAN;AACD,GAtBsB,CAuBvB;;;AACA,MAAIf,GAAG,CAACsE,KAAJ,CAAU,CAAC,CAAX,MAAkB,GAAtB,EAA2B;AACzBtE,IAAAA,GAAG,GAAGA,GAAG,CAACsE,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAAN;AACD;;AACD,MAAIC,WAAW,GAAGT,IAAI,IAAI,IAA1B;AACA;;;;AAGA,MAAI,OAAOH,MAAM,CAACY,WAAd,KAA8B,QAA9B,IAA0CZ,MAAM,CAACY,WAAP,KAAuB,EAArE,EAAyE;AACvE;AACAA,IAAAA,WAAW,GAAGZ,MAAM,CAACY,WAArB;AACD,GAHD,MAGO,IAAI,OAAOZ,MAAM,CAACa,QAAd,KAA2B,QAA3B,IAAuCb,MAAM,CAACa,QAAP,KAAoB,EAA3D,IAAiE,OAAOb,MAAM,CAACc,QAAd,KAA2B,QAA5F,IAAwGd,MAAM,CAACc,QAAP,KAAoB,EAAhI,EAAoI;AACzIF,IAAAA,WAAW,GAAGZ,MAAM,CAACa,QAAP,GAAkB,GAAlB,GAAwBb,MAAM,CAACc,QAA7C;AACD;;AAED,MAAI1E,SAAS,CAACC,GAAD,CAAT,IAAkBuE,WAAW,KAAK,IAAtC,EAA4C;AAC1C,UAAM,IAAIxD,KAAJ,CAAU,qEAAV,CAAN;AACD;;AACD,OAAKf,GAAL,GAAWA,GAAX;AACA,OAAKoE,QAAL,GAAgBA,QAAhB;AACA,OAAKC,GAAL,GAAWV,MAAM,CAACU,GAAlB;AACA,OAAKE,WAAL,GAAmBA,WAAnB;AACA,OAAKlB,OAAL,GAAe,EAAf;AACD;AAED;;;;;;;;;;;AASA,SAASqB,YAAT,CAAsBC,IAAtB,EAA4B;AAC1B,MAAIC,KAAK,GAAG,IAAZ;;AAEA,SAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5C,QAAIC,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC;;AACA,QAAI;AACF,UAAIM,MAAM,GAAGD,UAAU,CAACC,MAAxB;AAAA,UACIf,IAAI,GAAGc,UAAU,CAACd,IADtB;AAAA,UAEIgB,MAAM,GAAGF,UAAU,CAACE,MAFxB;AAAA,UAGIC,IAAI,GAAGH,UAAU,CAACG,IAHtB;AAAA,UAIIC,OAAO,GAAGJ,UAAU,CAACI,OAJzB;AAAA,UAKI1D,gBAAgB,GAAGsD,UAAU,CAACtD,gBALlC;AAOA,UAAI2C,GAAG,GAAG3C,gBAAgB,GAAG,cAAH,GAAoBkD,KAAK,CAACP,GAApD;AACA,UAAIgB,QAAQ,GAAGF,IAAf;AACA,UAAIG,WAAW,GAAGpB,IAAI,CAACqB,QAAL,CAAc,SAAd,KAA4BrB,IAAI,CAACqB,QAAL,CAAc,MAAd,CAA5B,GAAoD,sBAApD,GAA6E,kBAA/F;AACA,UAAIlC,OAAO,GAAG1B,MAAM,CAAC6D,MAAP,CAAc,EAAd,EAAkB;AAC9BC,QAAAA,MAAM,EAAE,kBADsB;AAE9B,wBAAgBH;AAFc,OAAlB,EAGXV,KAAK,CAACvB,OAHK,CAAd;AAIA,UAAIqC,SAAS,GAAGC,IAAI,CAACC,GAAL,EAAhB;;AACA,UAAIhB,KAAK,CAACL,WAAV,EAAuB;AACrBlB,QAAAA,OAAO,CAACwC,aAAR,GAAwB,WAAW5F,IAAI,CAAC2E,KAAK,CAACL,WAAP,CAAvC;AACD;;AACD,UAAIuB,cAAc,GAAG;AACnBb,QAAAA,MAAM,EAAEA,MADW;AAEnB5B,QAAAA,OAAO,EAAEA;AAFU,OAArB;;AAIA,UAAI0C,KAAK,CAACC,OAAN,CAAcX,QAAd,CAAJ,EAA6B;AAC3B,YAAIY,SAAS,GAAG,EAAhB;AACAZ,QAAAA,QAAQ,CAAC9C,OAAT,CAAiB,UAAU2D,IAAV,EAAgB;AAC/BD,UAAAA,SAAS,IAAIpD,IAAI,CAACzD,SAAL,CAAe8G,IAAf,CAAb;AACAD,UAAAA,SAAS,IAAI,IAAb;AACD,SAHD;AAKAZ,QAAAA,QAAQ,GAAGY,SAAX;AACD,OARD,MAQO;AACLZ,QAAAA,QAAQ,GAAGxC,IAAI,CAACzD,SAAL,CAAeiG,QAAf,KAA4B,EAAvC;AACD;;AAED,UAAI1D,MAAM,CAACW,IAAP,CAAY+C,QAAZ,EAAsBjF,MAAtB,KAAiC,CAArC,EAAwC;AACtC0F,QAAAA,cAAc,CAACX,IAAf,GAAsBE,QAAtB;AACD;;AAED,UAAIc,sBAAsB,GAAG,SAASA,sBAAT,CAAgCC,GAAhC,EAAqC;AAChE,YAAIxB,KAAK,CAACyB,gBAAN,IAA0B,OAAOzB,KAAK,CAACyB,gBAAb,KAAkC,UAAhE,EAA4E;AAC1E,cAAIC,uBAAuB,GAAG1B,KAAK,CAACyB,gBAAN,CAAuBD,GAAvB,CAA9B;;AACA,iBAAOE,uBAAuB,YAAYzB,OAAnC,GAA6CyB,uBAA7C,GAAuEzB,OAAO,CAACC,OAAR,CAAgBwB,uBAAhB,CAA9E;AACD;;AACD,eAAOzB,OAAO,CAACC,OAAR,CAAgBsB,GAAhB,CAAP;AACD,OAND;;AAQA,UAAIG,eAAe,GAAG,EAAtB;AAEA,UAAIC,YAAY,GAAG,EAAnB;;AACA,UAAItB,MAAJ,EAAY;AACVsB,QAAAA,YAAY,GAAG,MAAMtH,WAAW,CAACE,SAAZ,CAAsB8F,MAAtB,CAArB;AACD;;AACD,UAAIuB,QAAQ,GAAG7B,KAAK,CAACR,QAAN,GAAiB,KAAjB,GAAyBQ,KAAK,CAAC5E,GAA/B,GAAqC,GAArC,GAA2CqE,GAA3C,GAAiD,GAAjD,GAAuDH,IAAvD,GAA8DsC,YAA7E;AACA,aAAOL,sBAAsB,CAACxE,MAAM,CAAC6D,MAAP,CAAc,EAAd,EAAkB;AAC9CxF,QAAAA,GAAG,EAAEyG;AADyC,OAAlB,EAE3BX,cAF2B,CAAD,CAAtB,CAEaY,IAFb,CAEkB,UAAUC,EAAV,EAAc;AACrC,YAAIC,kBAAkB,GAAGjF,MAAM,CAAC6D,MAAP,CAAc,EAAd,EAAkBmB,EAAlB,CAAzB;AACA,YAAI3G,GAAG,GAAG4G,kBAAkB,CAAC5G,GAA7B;AAEA,eAAO4G,kBAAkB,CAAC5G,GAA1B;AACA,eAAOb,KAAK,CAACa,GAAG,IAAIyG,QAAR,EAAkBG,kBAAlB,CAAL,CAA2CF,IAA3C,CAAgD,UAAUN,GAAV,EAAe;AACpE,cAAIA,GAAG,CAACS,MAAJ,IAAc,GAAlB,EAAuB;AACrB,mBAAO9B,MAAM,CAACqB,GAAD,CAAb;AACD;;AACDG,UAAAA,eAAe,GAAGH,GAAG,CAAC/C,OAAtB;AACA,iBAAO+C,GAAG,CAACU,IAAJ,GAAWJ,IAAX,CAAgB,UAAUK,IAAV,EAAgB;AACrC,gBAAIX,GAAG,CAACS,MAAJ,IAAc,GAAlB,EAAuB;AACrB,qBAAO9B,MAAM,CAACqB,GAAD,CAAb;AACD;;AACD,gBAAIW,IAAI,IAAIA,IAAI,CAACC,KAAjB,EAAwB;AACtB,qBAAOjC,MAAM,CAACgC,IAAD,CAAb;AACD,aANoC,CAOrC;;;AACA,gBAAI3B,OAAO,IAAI2B,IAAX,IAAmBpF,MAAM,CAACjC,SAAP,CAAiB6B,QAAjB,CAA0BK,IAA1B,CAA+BmF,IAA/B,MAAyC,iBAAhE,EAAmF;AACjF,kBAAI5B,IAAI,IAAIA,IAAI,CAAC1D,KAAb,IAAsB0D,IAAI,CAAC1D,KAAL,YAAsBsE,KAAhD,EAAuD;AACrD,oBAAIkB,cAAc,GAAG,CAArB;AACA,oBAAIC,YAAY,GAAG/B,IAAI,CAAC1D,KAAL,CAAW0F,MAAX,CAAkB,UAAUtF,CAAV,EAAa;AAChD,yBAAOA,CAAC,CAACuF,OAAF,IAAavF,CAAC,CAACuF,OAAF,KAAc/G,SAAlC;AACD,iBAFkB,EAEhBD,MAFH;;AAGA,oBAAI2G,IAAJ,EAAU;AACRpF,kBAAAA,MAAM,CAACW,IAAP,CAAYyE,IAAZ,EAAkBxE,OAAlB,CAA0B,UAAUC,GAAV,EAAe;AACvC,wBAAIuE,IAAI,CAACvE,GAAD,CAAJ,IAAab,MAAM,CAACjC,SAAP,CAAiB2H,cAAjB,CAAgCzF,IAAhC,CAAqCmF,IAAI,CAACvE,GAAD,CAAzC,EAAgD,OAAhD,CAAjB,EAA2E;AACzEyE,sBAAAA,cAAc,IAAI,CAAlB;AACD;AACF,mBAJD;AAKD,iBAXoD,CAYrD;;;AACA,oBAAIA,cAAc,GAAG,CAAjB,IAAsBC,YAAY,KAAKD,cAA3C,EAA2D;AACzD,yBAAOlC,MAAM,CAACgC,IAAD,CAAb;AACD;AACF;AACF,aA1BoC,CA4BrC;;;AACA,gBAAIA,IAAI,IAAIA,IAAI,CAACO,SAAL,YAA0BvB,KAAtC,EAA6C;AAC3C,kBAAIwB,aAAa,GAAGR,IAAI,CAACO,SAAL,CAAelH,MAAnC;AACA,kBAAIoH,eAAe,GAAGT,IAAI,CAACO,SAAL,CAAeH,MAAf,CAAsB,UAAUM,KAAV,EAAiB;AAC3D,uBAAO9F,MAAM,CAACjC,SAAP,CAAiB2H,cAAjB,CAAgCzF,IAAhC,CAAqC6F,KAArC,EAA4C,OAA5C,CAAP;AACD,eAFqB,EAEnBrH,MAFH,CAF2C,CAK3C;;AACA,kBAAImH,aAAa,KAAKC,eAAtB,EAAuC;AACrC,uBAAOzC,MAAM,CAACgC,IAAD,CAAb;AACD;AACF;;AACD,gBAAIW,QAAQ,GAAG/F,MAAM,CAAC6D,MAAP,CAAc,EAAd,EAAkBuB,IAAlB,EAAwB;AACrCY,cAAAA,UAAU,EAAEjC,SADyB;AAErCkC,cAAAA,QAAQ,EAAErB;AAF2B,aAAxB,CAAf;AAIA,mBAAOzB,OAAO,CAAC4C,QAAD,CAAd;AACD,WA5CM,CAAP;AA6CD,SAlDM,EAkDJG,KAlDI,CAkDE,UAAUC,CAAV,EAAa;AACpB,iBAAO/C,MAAM,CAAC+C,CAAD,CAAb;AACD,SApDM,CAAP;AAqDD,OA5DM,EA4DJD,KA5DI,CA4DE,UAAUE,GAAV,EAAe;AACtB,eAAOhD,MAAM,CAACgD,GAAD,CAAb;AACD,OA9DM,CAAP;AA+DD,KArHD,CAqHE,OAAOD,CAAP,EAAU;AACV,aAAO/C,MAAM,CAAC+C,CAAD,CAAb;AACD;AACF,GA1HM,CAAP;AA2HD;;AAED,IAAIE,SAAS,GAAG,OAAOC,MAAP,KAAkB,WAAlB,GAAgCA,MAAM,CAACD,SAAvC,GAAmDE,OAAO,CAAC,IAAD,CAA1E;AAEA;;;;;;;;;AAQA,SAASC,SAAT,CAAmBxD,IAAnB,EAAyByD,MAAzB,EAAiCC,OAAjC,EAA0CC,OAA1C,EAAmD;AACjD,MAAI1D,KAAK,GAAG,IAAZ;;AAEA,MAAI;AACF,QAAII,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC;AACA,QAAIM,MAAM,GAAGD,UAAU,CAACC,MAAxB;AAAA,QACIf,IAAI,GAAGc,UAAU,CAACd,IADtB;AAAA,QAEIgB,MAAM,GAAGF,UAAU,CAACE,MAFxB;AAIA,QAAIG,QAAQ,GAAGV,IAAI,CAACQ,IAApB;;AACA,QAAI,CAACE,QAAD,IAAa,CAAC,OAAOA,QAAP,KAAoB,WAApB,GAAkC,WAAlC,GAAgDhG,OAAO,CAACgG,QAAD,CAAxD,MAAwE,QAAzF,EAAmG;AACjGA,MAAAA,QAAQ,GAAG,EAAX;AACD;;AACD,QAAIkD,IAAI,GAAG,SAASA,IAAT,GAAgB;AACzB3D,MAAAA,KAAK,CAAC4D,EAAN,GAAW,IAAIR,SAAJ,CAAc,WAAWpD,KAAK,CAAC5E,GAAjB,GAAuB,GAAvB,GAA6B4E,KAAK,CAACP,GAAjD,CAAX;AACAO,MAAAA,KAAK,CAAC9C,EAAN,GAAWd,MAAM,EAAjB;AAEA4D,MAAAA,KAAK,CAAC6D,OAAN,GAAgB;AACd3G,QAAAA,EAAE,EAAE8C,KAAK,CAAC9C,EADI;AAEdoC,QAAAA,IAAI,EAAEU,KAAK,CAACP,GAAN,GAAY,GAAZ,GAAkBH,IAAlB,GAAyB,GAAzB,GAA+BhF,WAAW,CAACE,SAAZ,CAAsB8F,MAAtB,CAFvB;AAGdD,QAAAA,MAAM,EAAEA,MAHM;AAIdE,QAAAA,IAAI,EAAEE;AAJQ,OAAhB;;AAMA,UAAIT,KAAK,CAACL,WAAV,EAAuB;AACrBK,QAAAA,KAAK,CAAC6D,OAAN,CAAcC,aAAd,GAA8B,WAAWzI,IAAI,CAAC2E,KAAK,CAACL,WAAP,CAA7C;AACD;;AACDK,MAAAA,KAAK,CAAC+D,MAAN,GAAe,EAAf;;AACA/D,MAAAA,KAAK,CAACgE,YAAN,GAAqB,YAAY;AAC/BhE,QAAAA,KAAK,CAACiE,QAAN;AACD,OAFD;;AAGAjE,MAAAA,KAAK,CAACkE,YAAN,GAAqB,UAAUf,GAAV,EAAe;AAClCnD,QAAAA,KAAK,CAACmE,YAAN,CAAmBC,KAAnB,CAAyBpE,KAAzB,EAAgC,CAACmD,GAAD,CAAhC;AACD,OAFD;;AAGAnD,MAAAA,KAAK,CAACqE,cAAN,GAAuB,UAAUC,OAAV,EAAmB;AACxC,YAAIC,OAAO,GAAGtG,IAAI,CAACC,KAAL,CAAWoG,OAAO,CAACnC,IAAnB,CAAd;;AACA,YAAIoC,OAAO,CAAChE,IAAR,IAAgBgE,OAAO,CAAChE,IAAR,CAAa0B,MAAb,IAAuB,GAA3C,EAAgD;AAC9CjC,UAAAA,KAAK,CAACmE,YAAN,CAAmBC,KAAnB,CAAyBpE,KAAzB,EAAgC,CAACuE,OAAD,CAAhC;AACD,SAFD,MAEO;AACLvE,UAAAA,KAAK,CAACwE,cAAN,CAAqBJ,KAArB,CAA2BpE,KAA3B,EAAkC,CAACuE,OAAD,CAAlC;AACD;AACF,OAPD;;AAQAvE,MAAAA,KAAK,CAACyE,IAAN,GAAa,UAAUZ,OAAV,EAAmB;AAC9B1F,QAAAA,uBAAuB,CAAC6B,KAAK,CAAC4D,EAAP,EAAW,YAAY;AAC5C,cAAI;AACF5D,YAAAA,KAAK,CAAC4D,EAAN,CAASa,IAAT,CAAcxG,IAAI,CAACzD,SAAL,CAAeqJ,OAAf,CAAd;AACD,WAFD,CAEE,OAAOX,CAAP,EAAU;AACVwB,YAAAA,OAAO,CAACC,IAAR,CAAazB,CAAb;AACD;AACF,SANsB,CAAvB;AAOD,OARD;;AASAlD,MAAAA,KAAK,CAAC4D,EAAN,CAASgB,SAAT,GAAqB5E,KAAK,CAACqE,cAA3B;AACArE,MAAAA,KAAK,CAAC4D,EAAN,CAASiB,OAAT,GAAmB7E,KAAK,CAACkE,YAAzB;AACAlE,MAAAA,KAAK,CAAC4D,EAAN,CAASkB,OAAT,GAAmB9E,KAAK,CAACgE,YAAzB;;AACAhE,MAAAA,KAAK,CAACyE,IAAN,CAAWzE,KAAK,CAAC6D,OAAjB;;AACA7D,MAAAA,KAAK,CAAC+D,MAAN,CAAagB,IAAb,GAAoB/E,KAAK,CAAC+E,IAA1B;AACA/E,MAAAA,KAAK,CAAC+D,MAAN,CAAaiB,SAAb,GAAyBhF,KAAK,CAACgF,SAA/B;AAEA,aAAOhF,KAAK,CAAC+D,MAAb;AACD,KA7CD;;AA8CA,SAAKE,QAAL,GAAgB,YAAY;AAC1B,UAAIP,OAAJ,EAAa;AACXA,QAAAA,OAAO;AACR;AACF,KAJD;;AAKA,SAAKqB,IAAL,GAAY,YAAY;AACtB/E,MAAAA,KAAK,CAAC4D,EAAN,CAASgB,SAAT,GAAqBnJ,SAArB;AACAuE,MAAAA,KAAK,CAAC4D,EAAN,CAASkB,OAAT,GAAmBrJ,SAAnB;AACAuE,MAAAA,KAAK,CAAC4D,EAAN,CAASiB,OAAT,GAAmBpJ,SAAnB;;AACAuE,MAAAA,KAAK,CAACiE,QAAN;;AACA,UAAIgB,YAAY,GAAGhH,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACzD,SAAL,CAAewF,KAAK,CAAC6D,OAArB,CAAX,CAAnB;AACAoB,MAAAA,YAAY,CAACC,WAAb,GAA2B,IAA3B;;AAEA,UAAIlF,KAAK,CAACmF,YAAN,KAAuB,IAA3B,EAAiC;AAC/BnF,QAAAA,KAAK,CAACyE,IAAN,CAAWQ,YAAX;AACD;;AAEDjF,MAAAA,KAAK,CAACmF,YAAN,GAAqB,IAArB;AACD,KAbD;;AAcA,SAAKH,SAAL,GAAiB,YAAY;AAC3BhF,MAAAA,KAAK,CAAC+E,IAAN;;AACA,aAAOxB,SAAS,CAACxD,IAAD,EAAOyD,MAAP,EAAeC,OAAf,EAAwBC,OAAxB,CAAhB;AACD,KAHD;;AAIA,SAAKS,YAAL,GAAoB,UAAUhB,GAAV,EAAe;AACjC,UAAIM,OAAJ,EAAa;AACXA,QAAAA,OAAO,CAACN,GAAD,CAAP;AACD,OAFD,MAEO;AACLuB,QAAAA,OAAO,CAACC,IAAR,CAAaxB,GAAb;AACD;AACF,KAND;;AAQA,SAAKqB,cAAL,GAAsB,UAAUY,WAAV,EAAuB;AAC3C,UAAIb,OAAO,GAAGtG,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACzD,SAAL,CAAe4K,WAAf,CAAX,CAAd;;AACA,UAAI,CAACb,OAAO,CAACrH,EAAT,IAAeqH,OAAO,CAACD,OAA3B,EAAoC;AAClC,YAAIb,OAAJ,EAAa;AACXA,UAAAA,OAAO,CAACc,OAAD,CAAP;AACD;;AACD;AACD;;AAED,UAAIA,OAAO,CAACrH,EAAR,KAAe8C,KAAK,CAAC9C,EAAzB,EAA6B;AAC3B,YAAIqH,OAAO,CAACD,OAAZ,EAAqB;AACnB,iBAAOC,OAAO,CAACrH,EAAf;;AACA,cAAIuG,OAAJ,EAAa;AACXA,YAAAA,OAAO,CAACc,OAAD,CAAP;AACD;;AACD;AACD;;AAED,YAAIA,OAAO,CAACc,QAAZ,EAAsB;AACpBrF,UAAAA,KAAK,CAACqF,QAAN,GAAiBd,OAAO,CAACc,QAAzB;AACD;;AAED,YAAId,OAAO,CAACe,OAAZ,EAAqB;AACnBtF,UAAAA,KAAK,CAACsF,OAAN,GAAgBf,OAAO,CAACe,OAAxB;AACD;;AAED,YAAIf,OAAO,CAAChE,IAAR,IAAgBgE,OAAO,CAAChE,IAAR,KAAiB,EAArC,EAAyC;AACvC,cAAIiD,MAAJ,EAAY;AACVA,YAAAA,MAAM,CAACe,OAAO,CAAChE,IAAT,CAAN;AACD;AACF;;AAED;AACD;;AAED,UAAI,CAACgE,OAAO,CAACrH,EAAT,IAAeqH,OAAO,CAACe,OAAvB,IAAkCf,OAAO,CAACe,OAAR,KAAoBtF,KAAK,CAACsF,OAAhE,EAAyE;AACvE,YAAI9B,MAAJ,EAAY;AACVA,UAAAA,MAAM,CAACe,OAAO,CAACgB,KAAT,CAAN;AACD;AACF;AACF,KAxCD;;AAyCA,WAAO5B,IAAI,EAAX;AACD,GAjID,CAiIE,OAAOT,CAAP,EAAU;AACV,QAAIO,OAAJ,EAAa;AACXA,MAAAA,OAAO,CAACP,CAAD,CAAP;AACD,KAFD,MAEO;AACLwB,MAAAA,OAAO,CAACC,IAAR,CAAazB,CAAb;AACD;;AACD,WAAO,IAAP;AACD;AACF;AAED;;;;;;;;;AAOA,SAASsC,QAAT,CAAkBzF,IAAlB,EAAwB;AACtB,MAAIK,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC,CADsB,CAEtB;;AACA,MAAI0F,KAAK,GAAGpI,QAAQ,CAAC+C,UAAD,EAAa;AAC/BjD,IAAAA,IAAI,EAAE,QADyB;AAE/BoD,IAAAA,IAAI,EAAE;AAFyB,GAAb,CAApB;;AAIA,MAAIkF,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AACD,MAAItI,IAAI,GAAGiD,UAAU,CAACjD,IAAtB;AAAA,MACID,EAAE,GAAGkD,UAAU,CAAClD,EADpB;AAAA,MAEIqD,IAAI,GAAGH,UAAU,CAACG,IAFtB;AAKA,SAAOH,UAAU,CAACjD,IAAlB;AACA,SAAOiD,UAAU,CAACG,IAAlB;AACA,SAAOH,UAAU,CAAClD,EAAlB;AAEA,MAAIoC,IAAI,GAAG,KAAK,CAAhB;;AACA,MAAIpC,EAAJ,EAAQ;AACNoC,IAAAA,IAAI,GAAGnC,IAAI,GAAG,GAAP,GAAauI,kBAAkB,CAACxI,EAAD,CAAtC;AACD,GAFD,MAEO;AACLoC,IAAAA,IAAI,GAAGnC,IAAP;AACD;;AACD,SAAO,KAAKwI,mBAAL,CAAyB;AAC9BtF,IAAAA,MAAM,EAAE,MADsB;AAE9Bf,IAAAA,IAAI,EAAEA,IAFwB;AAG9BgB,IAAAA,MAAM,EAAEF,UAHsB;AAI9BG,IAAAA,IAAI,EAAEA;AAJwB,GAAzB,CAAP;AAMD;AAED;;;;;;;;AAMA,SAASqF,MAAT,CAAgB7F,IAAhB,EAAsB;AACpB,MAAIK,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC,CADoB,CAEpB;;AACA,MAAI0F,KAAK,GAAGpI,QAAQ,CAAC+C,UAAD,EAAa;AAC/BjD,IAAAA,IAAI,EAAE,QADyB;AAE/BD,IAAAA,EAAE,EAAE;AAF2B,GAAb,CAApB;;AAKA,MAAIuI,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAItI,IAAI,GAAGiD,UAAU,CAACjD,IAAtB;AAAA,MACID,EAAE,GAAGkD,UAAU,CAAClD,EADpB;AAIA,SAAOkD,UAAU,CAACjD,IAAlB;AACA,SAAOiD,UAAU,CAAClD,EAAlB;AAEA,MAAIoC,IAAI,GAAGnC,IAAI,GAAG,GAAP,GAAauI,kBAAkB,CAACxI,EAAD,CAA1C;AAEA,SAAO,KAAKyI,mBAAL,CAAyB;AAC9BtF,IAAAA,MAAM,EAAE,KADsB;AAE9Bf,IAAAA,IAAI,EAAEA,IAFwB;AAG9BgB,IAAAA,MAAM,EAAEF;AAHsB,GAAzB,CAAP;AAKD;AAED;;;;;;;;;AAOA,SAASyF,SAAT,CAAmB9F,IAAnB,EAAyB;AACvB,MAAIK,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC,CADuB,CAEvB;;AACA,MAAI0F,KAAK,GAAGpI,QAAQ,CAAC+C,UAAD,EAAa;AAC/BjD,IAAAA,IAAI,EAAE,QADyB;AAE/BD,IAAAA,EAAE,EAAE,QAF2B;AAG/BqD,IAAAA,IAAI,EAAE;AAHyB,GAAb,CAApB;;AAKA,MAAIkF,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAItI,IAAI,GAAGiD,UAAU,CAACjD,IAAtB;AAAA,MACID,EAAE,GAAGkD,UAAU,CAAClD,EADpB;AAAA,MAEIqD,IAAI,GAAGH,UAAU,CAACG,IAFtB;AAIA,SAAOH,UAAU,CAACjD,IAAlB;AACA,SAAOiD,UAAU,CAAClD,EAAlB;AACA,SAAOkD,UAAU,CAACG,IAAlB;AACA,MAAIjB,IAAI,GAAGnC,IAAI,GAAG,GAAP,GAAauI,kBAAkB,CAACxI,EAAD,CAA/B,GAAsC,UAAjD;AAEA,SAAO,KAAKyI,mBAAL,CAAyB;AAC9BtF,IAAAA,MAAM,EAAE,MADsB;AAE9Bf,IAAAA,IAAI,EAAEA,IAFwB;AAG9BgB,IAAAA,MAAM,EAAEF,UAHsB;AAI9BG,IAAAA,IAAI,EAAEA;AAJwB,GAAzB,CAAP;AAMD;AAED;;;;;;;;AAMA,SAASuF,SAAT,CAAmB/F,IAAnB,EAAyB;AACvB,MAAIK,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC,CADuB,CAEvB;;AACA,MAAI0F,KAAK,GAAGpI,QAAQ,CAAC+C,UAAD,EAAa;AAC/BjD,IAAAA,IAAI,EAAE,QADyB;AAE/BD,IAAAA,EAAE,EAAE;AAF2B,GAAb,CAApB;;AAIA,MAAIuI,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAItI,IAAI,GAAGiD,UAAU,CAACjD,IAAtB;AAAA,MACID,EAAE,GAAGkD,UAAU,CAAClD,EADpB;AAGA,SAAOkD,UAAU,CAACjD,IAAlB;AACA,SAAOiD,UAAU,CAAClD,EAAlB;AAEA,MAAIoC,IAAI,GAAGnC,IAAI,GAAG,GAAP,GAAauI,kBAAkB,CAACxI,EAAD,CAA1C;AAEA,SAAO,KAAKyI,mBAAL,CAAyB;AAC9BtF,IAAAA,MAAM,EAAE,QADsB;AAE9Bf,IAAAA,IAAI,EAAEA,IAFwB;AAG9BgB,IAAAA,MAAM,EAAEF;AAHsB,GAAzB,CAAP;AAKD;AAED;;;;;;;;AAMA,SAAS2F,OAAT,CAAiBhG,IAAjB,EAAuB;AACrB,MAAIK,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC,CADqB,CAErB;;AACA,MAAI0F,KAAK,GAAGpI,QAAQ,CAAC+C,UAAD,EAAa;AAC/BG,IAAAA,IAAI,EAAE;AADyB,GAAb,CAApB;;AAGA,MAAIkF,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAItI,IAAI,GAAGiD,UAAU,CAACjD,IAAtB;AAAA,MACIoD,IAAI,GAAGH,UAAU,CAACG,IADtB;AAIA,SAAOH,UAAU,CAACjD,IAAlB;AACA,SAAOiD,UAAU,CAACG,IAAlB;AAEA,MAAIjB,IAAI,GAAG,KAAK,CAAhB;;AACA,MAAInC,IAAJ,EAAU;AACRmC,IAAAA,IAAI,GAAGnC,IAAI,GAAG,QAAd;AACD,GAFD,MAEO;AACLmC,IAAAA,IAAI,GAAG,QAAP;AACD;;AAED,SAAO,KAAKqG,mBAAL,CAAyB;AAC9BtF,IAAAA,MAAM,EAAE,MADsB;AAE9Bf,IAAAA,IAAI,EAAEA,IAFwB;AAG9BgB,IAAAA,MAAM,EAAEF,UAHsB;AAI9BG,IAAAA,IAAI,EAAEA;AAJwB,GAAzB,CAAP;AAMD;AAED;;;;;;;;AAMA,SAASyF,SAAT,CAAmBjG,IAAnB,EAAyB;AACvB,MAAIK,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC,CADuB,CAEvB;;AACA,MAAI0F,KAAK,GAAGpI,QAAQ,CAAC+C,UAAD,EAAa;AAC/BG,IAAAA,IAAI,EAAE;AADyB,GAAb,CAApB;;AAGA,MAAIkF,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAItI,IAAI,GAAG,KAAK,CAAhB;;AACA,MAAIgE,KAAK,CAACC,OAAN,CAAchB,UAAU,CAACjD,IAAzB,CAAJ,EAAoC;AAClCA,IAAAA,IAAI,GAAGiD,UAAU,CAACjD,IAAX,CAAgB8I,IAAhB,EAAP;AACD,GAFD,MAEO;AACL;AACA9I,IAAAA,IAAI,GAAGiD,UAAU,CAACjD,IAAlB;AACD;;AAED,MAAIoD,IAAI,GAAGH,UAAU,CAACG,IAAtB;AAGA,SAAOH,UAAU,CAACjD,IAAlB;AACA,SAAOiD,UAAU,CAACG,IAAlB;AAEA,MAAIjB,IAAI,GAAG,KAAK,CAAhB;;AACA,MAAInC,IAAJ,EAAU;AACRmC,IAAAA,IAAI,GAAGnC,IAAI,GAAG,UAAd;AACD,GAFD,MAEO;AACLmC,IAAAA,IAAI,GAAG,SAAP;AACD;;AAED,SAAO,KAAKqG,mBAAL,CAAyB;AAC9BtF,IAAAA,MAAM,EAAE,MADsB;AAE9Bf,IAAAA,IAAI,EAAEA,IAFwB;AAG9BgB,IAAAA,MAAM,EAAEF,UAHsB;AAI9BG,IAAAA,IAAI,EAAEA;AAJwB,GAAzB,CAAP;AAMD;AAED;;;;;;;;AAMA,SAAS2F,UAAT,CAAoBnG,IAApB,EAA0B;AACxB,MAAIK,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC,CADwB,CAExB;;AACA,MAAI0F,KAAK,GAAGpI,QAAQ,CAAC+C,UAAD,EAAa;AAC/BG,IAAAA,IAAI,EAAE;AADyB,GAAb,CAApB;;AAGA,MAAIkF,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAItI,IAAI,GAAG,KAAK,CAAhB;;AACA,MAAIgE,KAAK,CAACC,OAAN,CAAchB,UAAU,CAACjD,IAAzB,CAAJ,EAAoC;AAClCA,IAAAA,IAAI,GAAGiD,UAAU,CAACjD,IAAX,CAAgB8I,IAAhB,EAAP;AACD,GAFD,MAEO;AACL9I,IAAAA,IAAI,GAAGiD,UAAU,CAACjD,IAAlB;AACD;;AAED,MAAIoD,IAAI,GAAGH,UAAU,CAACG,IAAtB;AAGA,SAAOH,UAAU,CAACjD,IAAlB;AACA,SAAOiD,UAAU,CAACG,IAAlB;AAEA,MAAIjB,IAAI,GAAG,KAAK,CAAhB;;AACA,MAAInC,IAAJ,EAAU;AACRmC,IAAAA,IAAI,GAAGnC,IAAI,GAAG,WAAd;AACD,GAFD,MAEO;AACLmC,IAAAA,IAAI,GAAG,UAAP;AACD;;AAED,SAAO,KAAKqG,mBAAL,CAAyB;AAC9BtF,IAAAA,MAAM,EAAE,MADsB;AAE9Bf,IAAAA,IAAI,EAAEA,IAFwB;AAG9BgB,IAAAA,MAAM,EAAEF,UAHsB;AAI9BG,IAAAA,IAAI,EAAEA;AAJwB,GAAzB,CAAP;AAMD;AAED;;;;;;;;;;;AASA,SAAS4F,mBAAT,CAA6BtJ,KAA7B,EAAoCuJ,QAApC,EAA8C;AAC5C,MAAIC,cAAc,GAAGtI,eAAe,CAACqI,QAAD,CAApC,CAD4C,CAG5C;;AACA,MAAIX,KAAK,GAAG7I,eAAe,CAACC,KAAD,CAA3B;;AAEA,MAAI4I,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAIlF,IAAI,GAAG;AACT6F,IAAAA,QAAQ,EAAEC,cADD;AAETxJ,IAAAA,KAAK,EAAEA;AAFE,GAAX;AAKA,SAAO,KAAK8I,mBAAL,CAAyB;AAC9BtF,IAAAA,MAAM,EAAE,MADsB;AAE9Bf,IAAAA,IAAI,EAAE,oBAFwB;AAG9BiB,IAAAA,IAAI,EAAEA,IAHwB;AAI9BC,IAAAA,OAAO,EAAE;AAJqB,GAAzB,CAAP;AAMD;AAED;;;;;;;;;;;;AAUA,SAAS8F,SAAT,CAAmBvG,IAAnB,EAAyB;AACvB,MAAIK,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC,CADuB,CAEvB;;AACA,MAAI0F,KAAK,GAAGpI,QAAQ,CAAC+C,UAAD,EAAa;AAC/BjD,IAAAA,IAAI,EAAE,QADyB;AAE/BD,IAAAA,EAAE,EAAE;AAF2B,GAAb,CAApB;;AAIA,MAAIuI,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAItI,IAAI,GAAGiD,UAAU,CAACjD,IAAtB;AAAA,MACID,EAAE,GAAGkD,UAAU,CAAClD,EADpB;AAIA,SAAOkD,UAAU,CAACjD,IAAlB;AACA,SAAOiD,UAAU,CAAClD,EAAlB;AACA,SAAOkD,UAAU,CAACmG,MAAlB;;AAEA,MAAInG,UAAU,CAACmG,MAAX,KAAsB,IAA1B,EAAgC;AAC9BnG,IAAAA,UAAU,CAACmG,MAAX,GAAoB,MAApB;AACD,GAFD,MAEO;AACL,WAAOnG,UAAU,CAACmG,MAAlB;AACAnG,IAAAA,UAAU,CAACoG,UAAX,GAAwB,MAAxB;AACD;;AAED,OAAK,IAAIC,IAAI,GAAGlL,SAAS,CAACC,MAArB,EAA6BkL,IAAI,GAAGvF,KAAK,CAACsF,IAAI,GAAG,CAAP,GAAWA,IAAI,GAAG,CAAlB,GAAsB,CAAvB,CAAzC,EAAoEE,IAAI,GAAG,CAAhF,EAAmFA,IAAI,GAAGF,IAA1F,EAAgGE,IAAI,EAApG,EAAwG;AACtGD,IAAAA,IAAI,CAACC,IAAI,GAAG,CAAR,CAAJ,GAAiBpL,SAAS,CAACoL,IAAD,CAA1B;AACD;;AAED,SAAO,KAAKC,gBAAL,CAAsBxC,KAAtB,CAA4B,IAA5B,EAAkC,CAAC;AACxC/D,IAAAA,MAAM,EAAE,KADgC;AAExCf,IAAAA,IAAI,EAAEnC,IAAI,GAAG,GAAP,GAAauI,kBAAkB,CAACxI,EAAD,CAFG;AAGxCoD,IAAAA,MAAM,EAAEF;AAHgC,GAAD,EAItCyG,MAJsC,CAI/BH,IAJ+B,CAAlC,CAAP;AAKD;AAED;;;;;;;;;;;;AAUA,SAASI,eAAT,CAAyB/G,IAAzB,EAA+B;AAC7B,MAAIK,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC,CAD6B,CAE7B;;AACA,MAAI0F,KAAK,GAAGpI,QAAQ,CAAC+C,UAAD,EAAa;AAC/BG,IAAAA,IAAI,EAAE;AADyB,GAAb,CAApB;;AAGA,MAAIkF,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAIrF,UAAU,CAACjD,IAAX,KAAoB1B,SAApB,IAAiC0F,KAAK,CAACC,OAAN,CAAchB,UAAU,CAACjD,IAAzB,KAAkCiD,UAAU,CAACjD,IAAX,CAAgB3B,MAAhB,KAA2B,CAAlG,EAAqG;AACnG,UAAM,IAAIW,KAAJ,CAAU,sBAAV,CAAN;AACD;;AAED,MAAIgB,IAAI,GAAG,KAAK,CAAhB;;AACA,MAAIgE,KAAK,CAACC,OAAN,CAAchB,UAAU,CAACjD,IAAzB,CAAJ,EAAoC;AAClCA,IAAAA,IAAI,GAAGiD,UAAU,CAACjD,IAAX,CAAgB8I,IAAhB,EAAP;AACD,GAFD,MAEO;AACL9I,IAAAA,IAAI,GAAGiD,UAAU,CAACjD,IAAlB;AACD;;AAED,MAAIoD,IAAI,GAAGH,UAAU,CAACG,IAAtB;AAEA,SAAOH,UAAU,CAACjD,IAAlB;AACA,SAAOiD,UAAU,CAACG,IAAlB;AACA,SAAOH,UAAU,CAACmG,MAAlB;AAEAnG,EAAAA,UAAU,CAACoG,UAAX,GAAwB,MAAxB;;AAEA,OAAK,IAAIC,IAAI,GAAGlL,SAAS,CAACC,MAArB,EAA6BkL,IAAI,GAAGvF,KAAK,CAACsF,IAAI,GAAG,CAAP,GAAWA,IAAI,GAAG,CAAlB,GAAsB,CAAvB,CAAzC,EAAoEE,IAAI,GAAG,CAAhF,EAAmFA,IAAI,GAAGF,IAA1F,EAAgGE,IAAI,EAApG,EAAwG;AACtGD,IAAAA,IAAI,CAACC,IAAI,GAAG,CAAR,CAAJ,GAAiBpL,SAAS,CAACoL,IAAD,CAA1B;AACD;;AAED,SAAO,KAAKC,gBAAL,CAAsBxC,KAAtB,CAA4B,IAA5B,EAAkC,CAAC;AACxC/D,IAAAA,MAAM,EAAE,MADgC;AAExCf,IAAAA,IAAI,EAAEnC,IAAI,GAAG,UAF2B;AAGxCmD,IAAAA,MAAM,EAAEF,UAHgC;AAIxCG,IAAAA,IAAI,EAAEA;AAJkC,GAAD,EAKtCsG,MALsC,CAK/BH,IAL+B,CAAlC,CAAP;AAMD;AAED;;;;;;;;;;;;AAUA,SAASK,oBAAT,CAA8BhH,IAA9B,EAAoCiH,OAApC,EAA6C;AAC3C,OAAK,IAAIP,IAAI,GAAGlL,SAAS,CAACC,MAArB,EAA6BkL,IAAI,GAAGvF,KAAK,CAACsF,IAAI,GAAG,CAAP,GAAWA,IAAI,GAAG,CAAlB,GAAsB,CAAvB,CAAzC,EAAoEE,IAAI,GAAG,CAAhF,EAAmFA,IAAI,GAAGF,IAA1F,EAAgGE,IAAI,EAApG,EAAwG;AACtGD,IAAAA,IAAI,CAACC,IAAI,GAAG,CAAR,CAAJ,GAAiBpL,SAAS,CAACoL,IAAD,CAA1B;AACD;;AAED,MAAI3G,KAAK,GAAG,IAAZ;;AAEA,MAAII,UAAU,GAAGrC,eAAe,CAACgC,IAAD,CAAhC;AACA,MAAIU,QAAQ,GAAGL,UAAU,CAACG,IAA1B;AACA,MAAIpD,IAAI,GAAG,KAAK,CAAhB;AACA,MAAI8J,UAAU,GAAG,KAAK,CAAtB,CAV2C,CAW3C;;AACA,MAAIxB,KAAK,GAAGpI,QAAQ,CAAC+C,UAAD,EAAa;AAC/BG,IAAAA,IAAI,EAAE;AADyB,GAAb,CAApB;;AAGA,MAAIkF,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAIrF,UAAU,CAACjD,IAAX,KAAoB1B,SAApB,IAAiC,EAAE,OAAO2E,UAAU,CAACjD,IAAlB,KAA2B,QAA3B,IAAuCgE,KAAK,CAACC,OAAN,CAAchB,UAAU,CAACjD,IAAzB,CAAzC,CAAjC,IAA6GiD,UAAU,CAACjD,IAAX,KAAoB,EAAjI,IAAuIiD,UAAU,CAACjD,IAAX,CAAgB3B,MAAhB,KAA2B,CAAtK,EAAyK;AACvK,UAAM,IAAIW,KAAJ,CAAU,sBAAV,CAAN;AACD;;AAEDsJ,EAAAA,KAAK,GAAGpI,QAAQ,CAAC+C,UAAU,CAACG,IAAZ,EAAkB;AAChC1D,IAAAA,KAAK,EAAE;AADyB,GAAlB,CAAhB;;AAGA,MAAI4I,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAItE,KAAK,CAACC,OAAN,CAAchB,UAAU,CAACjD,IAAzB,CAAJ,EAAoC;AAClCA,IAAAA,IAAI,GAAGiD,UAAU,CAACjD,IAAlB;AAEA8J,IAAAA,UAAU,GAAG7G,UAAU,CAACjD,IAAX,CAAgB8I,IAAhB,EAAb;AACD,GAJD,MAIO;AACL9I,IAAAA,IAAI,GAAG,CAACiD,UAAU,CAACjD,IAAZ,CAAP;AACA8J,IAAAA,UAAU,GAAG7G,UAAU,CAACjD,IAAxB;AACD;;AAED,MAAI+J,QAAQ,GAAG,EAAf;AACA,MAAIC,SAAS,GAAG1G,QAAhB;AAAA,MACI5D,KAAK,GAAGsK,SAAS,CAACtK,KADtB;;AAIA,MAAI,OAAOmK,OAAP,KAAmB,QAAvB,EAAiC;AAC/B,QAAII,UAAU,GAAG,EAAjB;AACAA,IAAAA,UAAU,CAAChM,GAAX,GAAiB4L,OAAjB;AACAI,IAAAA,UAAU,CAAC/G,MAAX,GAAoB,KAApB;AACA6G,IAAAA,QAAQ,CAACrJ,IAAT,CAAcuJ,UAAd;AACD,GALD,MAKO,IAAIJ,OAAO,CAACnM,WAAR,KAAwBsG,KAA5B,EAAmC;AACxC+F,IAAAA,QAAQ,GAAGF,OAAX;AACD,GAFM,MAEA,IAAIA,OAAO,KAAKjK,MAAM,CAACiK,OAAD,CAAtB,EAAiC;AACtCE,IAAAA,QAAQ,CAACrJ,IAAT,CAAcmJ,OAAd;AACD,GAFM,MAEA;AACL,UAAM,IAAI7K,KAAJ,CAAU,uDAAV,CAAN;AACD;;AAED,MAAIkL,YAAY,GAAG,SAASA,YAAT,GAAwB;AACzC5G,IAAAA,QAAQ,GAAG,EAAX;AACAA,IAAAA,QAAQ,CAACyG,QAAT,GAAoBA,QAApB;AACAzG,IAAAA,QAAQ,CAAC5D,KAAT,GAAiBA,KAAjB;AACA4D,IAAAA,QAAQ,CAACtD,IAAT,GAAgBA,IAAhB;AACD,GALD;;AAOAkK,EAAAA,YAAY;AAEZ,MAAIC,QAAQ,GAAGjM,IAAI,CAACb,SAAS,CAACqC,KAAD,CAAV,CAAnB;AACA,MAAIyC,IAAI,GAAG,4BAA4B2H,UAA5B,GAAyC,KAAzC,GAAiDK,QAA5D;;AAEA,OAAKC,MAAL,GAAc,YAAY;AACxBL,IAAAA,QAAQ,GAAG,EAAX;;AAEA,QAAI,OAAO9G,UAAP,KAAsB,QAA1B,EAAoC;AAClC,UAAIoH,QAAQ,GAAG,EAAf;AACAA,MAAAA,QAAQ,CAACpM,GAAT,GAAegF,UAAf;AACAoH,MAAAA,QAAQ,CAACnH,MAAT,GAAkB,MAAlB;AACA6G,MAAAA,QAAQ,CAACrJ,IAAT,CAAc2J,QAAd;AACD,KALD,MAKO,IAAIpH,UAAU,CAACvF,WAAX,KAA2BsG,KAA/B,EAAsC;AAC3C+F,MAAAA,QAAQ,GAAG9G,UAAX;AACD,KAFM,MAEA,IAAIA,UAAU,KAAKrD,MAAM,CAACqD,UAAD,CAAzB,EAAuC;AAC5C8G,MAAAA,QAAQ,CAACrJ,IAAT,CAAcuC,UAAd;AACD,KAFM,MAEA;AACL,YAAM,IAAIjE,KAAJ,CAAU,0DAAV,CAAN;AACD;;AAEDkL,IAAAA,YAAY;AAEZ,WAAOrH,KAAK,CAACyH,cAAN,CAAqB,MAArB,CAAP;AACD,GAnBD;;AAoBA,OAAK1C,IAAL,GAAY,YAAY;AACtBtE,IAAAA,QAAQ,GAAGhF,SAAX;AACA,WAAOuE,KAAK,CAACyH,cAAN,CAAqB,QAArB,CAAP;AACD,GAHD;;AAIA,OAAKA,cAAL,GAAsB,UAAUpH,MAAV,EAAkB;AACtC,QAAImB,GAAG,GAAGxB,KAAK,CAAC4G,gBAAN,CAAuBxC,KAAvB,CAA6BpE,KAA7B,EAAoC,CAAC;AAC7CK,MAAAA,MAAM,EAAEA,MADqC;AAE7Cf,MAAAA,IAAI,EAAEA,IAFuC;AAG7CiB,MAAAA,IAAI,EAAEE;AAHuC,KAAD,EAI3CoG,MAJ2C,CAIpCH,IAJoC,CAApC,CAAV;;AAMAlF,IAAAA,GAAG,CAAC+F,MAAJ,GAAavH,KAAK,CAACuH,MAAnB;AACA/F,IAAAA,GAAG,CAACuD,IAAJ,GAAW/E,KAAK,CAAC+E,IAAjB;AAEA,WAAOvD,GAAP;AACD,GAXD;;AAYA,SAAO,KAAKiG,cAAL,CAAoB,MAApB,CAAP;AACD;AAED;;;;;AAGA,SAASC,eAAT,GAA2B;AACzB,MAAI1H,KAAK,GAAG,IAAZ;;AAEA,SAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5C,QAAI;AACF,aAAOH,KAAK,CAAC2F,mBAAN,CAA0B;AAC/BtF,QAAAA,MAAM,EAAE,KADuB;AAE/Bf,QAAAA,IAAI,EAAE;AAFyB,OAA1B,EAGJwC,IAHI,CAGC,UAAUK,IAAV,EAAgB;AACtB,YAAIwF,KAAK,GAAG5K,MAAM,CAACW,IAAP,CAAYyE,IAAI,CAACnC,KAAK,CAACP,GAAP,CAAJ,CAAgBmI,QAA5B,EAAsCrF,MAAtC,CAA6C,UAAUpF,IAAV,EAAgB;AACvE,iBAAOA,IAAI,KAAK,WAAhB;AACD,SAFW,CAAZ;AAGA,eAAO+C,OAAO,CAACyH,KAAD,CAAd;AACD,OARM,CAAP;AASD,KAVD,CAUE,OAAOzE,CAAP,EAAU;AACV,aAAO/C,MAAM,CAAC+C,CAAD,CAAb;AACD;AACF,GAdM,CAAP;AAeD;AAED;;;;;AAGA,SAAS2E,WAAT,GAAuB;AACrB,SAAO,KAAKlC,mBAAL,CAAyB;AAC9BtF,IAAAA,MAAM,EAAE,KADsB;AAE9Bf,IAAAA,IAAI,EAAE;AAFwB,GAAzB,CAAP;AAID;AAED;;;;;;;;;;;AASA,SAASwI,mBAAT,CAA6BjL,KAA7B,EAAoCuJ,QAApC,EAA8C;AAC5C,MAAIC,cAAc,GAAGtI,eAAe,CAACqI,QAAD,CAApC,CAD4C,CAG5C;;AACA,MAAIX,KAAK,GAAG7I,eAAe,CAACC,KAAD,EAAQ,IAAR,CAA3B;;AAEA,MAAI4I,KAAK,KAAK,IAAd,EAAoB;AAClB,UAAMA,KAAN;AACD;;AAED,MAAIlF,IAAI,GAAG;AACT6F,IAAAA,QAAQ,EAAEC,cADD;AAETxJ,IAAAA,KAAK,EAAEA;AAFE,GAAX;AAKA,SAAO,KAAK8I,mBAAL,CAAyB;AAC9BtF,IAAAA,MAAM,EAAE,MADsB;AAE9Bf,IAAAA,IAAI,EAAE,oBAFwB;AAG9BiB,IAAAA,IAAI,EAAEA,IAHwB;AAI9BC,IAAAA,OAAO,EAAE,IAJqB;AAK9B1D,IAAAA,gBAAgB,EAAE;AALY,GAAzB,CAAP;AAOD;;AAED,SAASiL,KAAT,CAAgBhJ,MAAhB,EAAwB;AACtB,MAAIiJ,MAAM,GAAG,IAAIlJ,OAAJ,CAAYC,MAAZ,CAAb;AAEAD,EAAAA,OAAO,CAAChE,SAAR,CAAkB6K,mBAAlB,GAAwC7F,YAAxC;AAEAhB,EAAAA,OAAO,CAAChE,SAAR,CAAkB8L,gBAAlB,GAAqCrD,SAArC;AAEAzE,EAAAA,OAAO,CAAChE,SAAR,CAAkBiN,KAAlB,GAA0BvC,QAA1B;AAEA1G,EAAAA,OAAO,CAAChE,SAAR,CAAkBmN,GAAlB,GAAwBrC,MAAxB;AAEA9G,EAAAA,OAAO,CAAChE,SAAR,CAAkBoN,MAAlB,GAA2BrC,SAA3B;AAEA/G,EAAAA,OAAO,CAAChE,SAAR,CAAkBqN,MAAlB,GAA2BrC,SAA3B;AAEAhH,EAAAA,OAAO,CAAChE,SAAR,CAAkBsN,IAAlB,GAAyBrC,OAAzB;AAEAjH,EAAAA,OAAO,CAAChE,SAAR,CAAkBuN,MAAlB,GAA2BrC,SAA3B;AAEAlH,EAAAA,OAAO,CAAChE,SAAR,CAAkBwN,OAAlB,GAA4BpC,UAA5B;AAEApH,EAAAA,OAAO,CAAChE,SAAR,CAAkByN,gBAAlB,GAAqCpC,mBAArC;AAEArH,EAAAA,OAAO,CAAChE,SAAR,CAAkB0N,mBAAlB,GAAwCV,mBAAxC;AAEAhJ,EAAAA,OAAO,CAAChE,SAAR,CAAkBwL,SAAlB,GAA8BA,SAA9B;AAEAxH,EAAAA,OAAO,CAAChE,SAAR,CAAkB2N,YAAlB,GAAiC3B,eAAjC;AAEAhI,EAAAA,OAAO,CAAChE,SAAR,CAAkB4N,iBAAlB,GAAsC3B,oBAAtC;AAEAjI,EAAAA,OAAO,CAAChE,SAAR,CAAkB6N,QAAlB,GAA6BjB,eAA7B;AAEA5I,EAAAA,OAAO,CAAChE,SAAR,CAAkB+M,WAAlB,GAAgCA,WAAhC;;AAEA/I,EAAAA,OAAO,CAAChE,SAAR,CAAkB8N,UAAlB,GAA+B,YAAY;AACzC,QAAInK,OAAO,GAAGlD,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAlF;AACA,QAAImD,YAAY,GAAGnD,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,KAAvF,CAFyC,CAIzC;;AACA,QAAImD,YAAJ,EAAkB;AAChB,WAAKD,OAAL,GAAeD,aAAa,CAACC,OAAD,CAA5B;AACD,KAFD,MAEO;AACL,WAAKA,OAAL,GAAeA,OAAf;AACD;AACF,GAVD;;AAYA,MAAI,OAAO4E,MAAP,KAAkB,WAAtB,EAAmC;AACjCA,IAAAA,MAAM,CAACwF,OAAP,GAAiBb,MAAjB;AACD;;AACD,SAAOA,MAAP;AACD;;AAED,eAAeD,KAAf","sourcesContent":["import URL from 'url-parser-lite';\nimport querystring from 'querystring';\nimport fetch from 'cross-fetch';\nimport stringify from 'json-stable-stringify';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nfunction contains(string, substring) {\n  return string.indexOf(substring) !== -1;\n}\nfunction isAppbase(url) {\n  return contains(url, 'scalr.api.appbase.io');\n}\nfunction btoa() {\n  var input = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n\n  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  var str = input;\n  var output = '';\n\n  // eslint-disable-next-line\n  for (var block = 0, charCode, i = 0, map = chars; str.charAt(i | 0) || (map = '=', i % 1); // eslint-disable-line no-bitwise\n  output += map.charAt(63 & block >> 8 - i % 1 * 8) // eslint-disable-line no-bitwise\n  ) {\n    charCode = str.charCodeAt(i += 3 / 4);\n\n    if (charCode > 0xff) {\n      throw new Error('\"btoa\" failed: The string to be encoded contains characters outside of the Latin1 range.');\n    }\n\n    block = block << 8 | charCode; // eslint-disable-line no-bitwise\n  }\n\n  return output;\n}\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0; // eslint-disable-line no-bitwise\n\n    var v = c === 'x' ? r : r & 0x3 | 0x8; // eslint-disable-line no-bitwise\n    return v.toString(16);\n  });\n}\n\nfunction validateRSQuery(query) {\n  var isSuggestionsAPI = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  if (query && Object.prototype.toString.call(query) === '[object Array]') {\n    for (var i = 0; i < query.length; i += 1) {\n      var q = query[i];\n      if (q) {\n        if (!q.id) {\n          return new Error('\\'id\\' field must be present in query object');\n        }\n        // `dataField` is only optional for search types\n        if (q.type !== 'search' || isSuggestionsAPI) {\n          if (!q.dataField) return new Error('\\'dataField\\' field must be present in query object');\n        }\n        if (q.dataField && Object.prototype.toString.call(q.dataField) !== '[object Array]') {\n          return new Error('\\'dataField\\' field must be an array');\n        }\n      } else {\n        return new Error('query object can not have an empty value');\n      }\n    }\n    return true;\n  }\n  return new Error('invalid query value, \\'query\\' value must be an array');\n}\n\nfunction validate(object, fields) {\n  var invalid = [];\n  var emptyFor = {\n    object: null,\n    string: ''\n  };\n  var keys = Object.keys(fields);\n  keys.forEach(function (key) {\n    var type = fields[key];\n    // eslint-disable-next-line\n    if (_typeof(object[key]) !== type || object[key] === emptyFor[type]) {\n      invalid.push(key);\n    }\n  });\n  var missing = '';\n  for (var i = 0; i < invalid.length; i += 1) {\n    missing += invalid[i] + ', ';\n  }\n  if (invalid.length > 0) {\n    return new Error('fields missing: ' + missing);\n  }\n\n  return true;\n}\n\nfunction removeUndefined() {\n  var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (value || !(Object.keys(value).length === 0 && value.constructor === Object)) {\n    return JSON.parse(JSON.stringify(value));\n  }\n  return null;\n}\n\n/**\n * Send only when a connection is opened\n * @param {Object} socket\n * @param {Function} callback\n */\nfunction waitForSocketConnection(socket, callback) {\n  setTimeout(function () {\n    if (socket.readyState === 1) {\n      if (callback != null) {\n        callback();\n      }\n    } else {\n      waitForSocketConnection(socket, callback);\n    }\n  }, 5); // wait 5 ms for the connection...\n}\n\nfunction encodeHeaders() {\n  var headers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var shouldEncode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n  // Encode headers\n  var encodedHeaders = {};\n  if (shouldEncode) {\n    Object.keys(headers).forEach(function (header) {\n      encodedHeaders[header] = encodeURI(headers[header]);\n    });\n  } else {\n    encodedHeaders = headers;\n  }\n  return encodedHeaders;\n}\n\n/**\n * Returns an instance of Appbase client\n * @param {Object} config To configure properties\n * @param {String} config.url\n * @param {String} config.app\n * @param {String} config.credentials\n * @param {String} config.username\n * @param {String} config.password\n * A callback function which will be invoked before a fetch request made\n */\nfunction AppBase(config) {\n  var _URL = URL(config.url || ''),\n      _URL$auth = _URL.auth,\n      auth = _URL$auth === undefined ? null : _URL$auth,\n      _URL$host = _URL.host,\n      host = _URL$host === undefined ? '' : _URL$host,\n      _URL$path = _URL.path,\n      path = _URL$path === undefined ? '' : _URL$path,\n      _URL$protocol = _URL.protocol,\n      protocol = _URL$protocol === undefined ? '' : _URL$protocol;\n\n  var url = host + path;\n\n  // Validate config and throw appropriate error\n  if (typeof url !== 'string' || url === '') {\n    throw new Error('URL not present in options.');\n  }\n  if (typeof config.app !== 'string' || config.app === '') {\n    throw new Error('App name is not present in options.');\n  }\n  if (typeof protocol !== 'string' || protocol === '') {\n    throw new Error('Protocol is not present in url. URL should be of the form https://scalr.api.appbase.io');\n  }\n  // Parse url\n  if (url.slice(-1) === '/') {\n    url = url.slice(0, -1);\n  }\n  var credentials = auth || null;\n  /**\n   * Credentials can be provided as a part of the URL,\n   * as username, password args or as a credentials argument directly */\n  if (typeof config.credentials === 'string' && config.credentials !== '') {\n    // eslint-disable-next-line\n    credentials = config.credentials;\n  } else if (typeof config.username === 'string' && config.username !== '' && typeof config.password === 'string' && config.password !== '') {\n    credentials = config.username + ':' + config.password;\n  }\n\n  if (isAppbase(url) && credentials === null) {\n    throw new Error('Authentication information is not present. Did you add credentials?');\n  }\n  this.url = url;\n  this.protocol = protocol;\n  this.app = config.app;\n  this.credentials = credentials;\n  this.headers = {};\n}\n\n/**\n * To perform fetch request\n * @param {Object} args\n * @param {String} args.method\n * @param {String} args.path\n * @param {Object} args.params\n * @param {Object} args.body\n * @param {boolean} args.isSuggestionsAPI\n */\nfunction fetchRequest(args) {\n  var _this = this;\n\n  return new Promise(function (resolve, reject) {\n    var parsedArgs = removeUndefined(args);\n    try {\n      var method = parsedArgs.method,\n          path = parsedArgs.path,\n          params = parsedArgs.params,\n          body = parsedArgs.body,\n          isRSAPI = parsedArgs.isRSAPI,\n          isSuggestionsAPI = parsedArgs.isSuggestionsAPI;\n\n      var app = isSuggestionsAPI ? '.suggestions' : _this.app;\n      var bodyCopy = body;\n      var contentType = path.endsWith('msearch') || path.endsWith('bulk') ? 'application/x-ndjson' : 'application/json';\n      var headers = Object.assign({}, {\n        Accept: 'application/json',\n        'Content-Type': contentType\n      }, _this.headers);\n      var timestamp = Date.now();\n      if (_this.credentials) {\n        headers.Authorization = 'Basic ' + btoa(_this.credentials);\n      }\n      var requestOptions = {\n        method: method,\n        headers: headers\n      };\n      if (Array.isArray(bodyCopy)) {\n        var arrayBody = '';\n        bodyCopy.forEach(function (item) {\n          arrayBody += JSON.stringify(item);\n          arrayBody += '\\n';\n        });\n\n        bodyCopy = arrayBody;\n      } else {\n        bodyCopy = JSON.stringify(bodyCopy) || {};\n      }\n\n      if (Object.keys(bodyCopy).length !== 0) {\n        requestOptions.body = bodyCopy;\n      }\n\n      var handleTransformRequest = function handleTransformRequest(res) {\n        if (_this.transformRequest && typeof _this.transformRequest === 'function') {\n          var tarnsformRequestPromise = _this.transformRequest(res);\n          return tarnsformRequestPromise instanceof Promise ? tarnsformRequestPromise : Promise.resolve(tarnsformRequestPromise);\n        }\n        return Promise.resolve(res);\n      };\n\n      var responseHeaders = {};\n\n      var paramsString = '';\n      if (params) {\n        paramsString = '?' + querystring.stringify(params);\n      }\n      var finalURL = _this.protocol + '://' + _this.url + '/' + app + '/' + path + paramsString;\n      return handleTransformRequest(Object.assign({}, {\n        url: finalURL\n      }, requestOptions)).then(function (ts) {\n        var transformedRequest = Object.assign({}, ts);\n        var url = transformedRequest.url;\n\n        delete transformedRequest.url;\n        return fetch(url || finalURL, transformedRequest).then(function (res) {\n          if (res.status >= 500) {\n            return reject(res);\n          }\n          responseHeaders = res.headers;\n          return res.json().then(function (data) {\n            if (res.status >= 400) {\n              return reject(res);\n            }\n            if (data && data.error) {\n              return reject(data);\n            }\n            // Handle error from RS API RESPONSE\n            if (isRSAPI && data && Object.prototype.toString.call(data) === '[object Object]') {\n              if (body && body.query && body.query instanceof Array) {\n                var errorResponses = 0;\n                var allResponses = body.query.filter(function (q) {\n                  return q.execute || q.execute === undefined;\n                }).length;\n                if (data) {\n                  Object.keys(data).forEach(function (key) {\n                    if (data[key] && Object.prototype.hasOwnProperty.call(data[key], 'error')) {\n                      errorResponses += 1;\n                    }\n                  });\n                }\n                // reject only when all responses has error\n                if (errorResponses > 0 && allResponses === errorResponses) {\n                  return reject(data);\n                }\n              }\n            }\n\n            // Handle error from _msearch response\n            if (data && data.responses instanceof Array) {\n              var _allResponses = data.responses.length;\n              var _errorResponses = data.responses.filter(function (entry) {\n                return Object.prototype.hasOwnProperty.call(entry, 'error');\n              }).length;\n              // reject only when all responses has error\n              if (_allResponses === _errorResponses) {\n                return reject(data);\n              }\n            }\n            var response = Object.assign({}, data, {\n              _timestamp: timestamp,\n              _headers: responseHeaders\n            });\n            return resolve(response);\n          });\n        }).catch(function (e) {\n          return reject(e);\n        });\n      }).catch(function (err) {\n        return reject(err);\n      });\n    } catch (e) {\n      return reject(e);\n    }\n  });\n}\n\nvar WebSocket = typeof window !== 'undefined' ? window.WebSocket : require('ws');\n\n/**\n * To connect a web socket\n * @param {Object} args\n * @param {String} args.method\n * @param {String} args.path\n * @param {Object} args.params\n * @param {Object} args.body\n */\nfunction wsRequest(args, onData, onError, onClose) {\n  var _this = this;\n\n  try {\n    var parsedArgs = removeUndefined(args);\n    var method = parsedArgs.method,\n        path = parsedArgs.path,\n        params = parsedArgs.params;\n\n    var bodyCopy = args.body;\n    if (!bodyCopy || (typeof bodyCopy === 'undefined' ? 'undefined' : _typeof(bodyCopy)) !== 'object') {\n      bodyCopy = {};\n    }\n    var init = function init() {\n      _this.ws = new WebSocket('wss://' + _this.url + '/' + _this.app);\n      _this.id = uuidv4();\n\n      _this.request = {\n        id: _this.id,\n        path: _this.app + '/' + path + '?' + querystring.stringify(params),\n        method: method,\n        body: bodyCopy\n      };\n      if (_this.credentials) {\n        _this.request.authorization = 'Basic ' + btoa(_this.credentials);\n      }\n      _this.result = {};\n      _this.closeHandler = function () {\n        _this.wsClosed();\n      };\n      _this.errorHandler = function (err) {\n        _this.processError.apply(_this, [err]);\n      };\n      _this.messageHandler = function (message) {\n        var dataObj = JSON.parse(message.data);\n        if (dataObj.body && dataObj.body.status >= 400) {\n          _this.processError.apply(_this, [dataObj]);\n        } else {\n          _this.processMessage.apply(_this, [dataObj]);\n        }\n      };\n      _this.send = function (request) {\n        waitForSocketConnection(_this.ws, function () {\n          try {\n            _this.ws.send(JSON.stringify(request));\n          } catch (e) {\n            console.warn(e);\n          }\n        });\n      };\n      _this.ws.onmessage = _this.messageHandler;\n      _this.ws.onerror = _this.errorHandler;\n      _this.ws.onclose = _this.closeHandler;\n      _this.send(_this.request);\n      _this.result.stop = _this.stop;\n      _this.result.reconnect = _this.reconnect;\n\n      return _this.result;\n    };\n    this.wsClosed = function () {\n      if (onClose) {\n        onClose();\n      }\n    };\n    this.stop = function () {\n      _this.ws.onmessage = undefined;\n      _this.ws.onclose = undefined;\n      _this.ws.onerror = undefined;\n      _this.wsClosed();\n      var unsubRequest = JSON.parse(JSON.stringify(_this.request));\n      unsubRequest.unsubscribe = true;\n\n      if (_this.unsubscribed !== true) {\n        _this.send(unsubRequest);\n      }\n\n      _this.unsubscribed = true;\n    };\n    this.reconnect = function () {\n      _this.stop();\n      return wsRequest(args, onData, onError, onClose);\n    };\n    this.processError = function (err) {\n      if (onError) {\n        onError(err);\n      } else {\n        console.warn(err);\n      }\n    };\n\n    this.processMessage = function (origDataObj) {\n      var dataObj = JSON.parse(JSON.stringify(origDataObj));\n      if (!dataObj.id && dataObj.message) {\n        if (onError) {\n          onError(dataObj);\n        }\n        return;\n      }\n\n      if (dataObj.id === _this.id) {\n        if (dataObj.message) {\n          delete dataObj.id;\n          if (onError) {\n            onError(dataObj);\n          }\n          return;\n        }\n\n        if (dataObj.query_id) {\n          _this.query_id = dataObj.query_id;\n        }\n\n        if (dataObj.channel) {\n          _this.channel = dataObj.channel;\n        }\n\n        if (dataObj.body && dataObj.body !== '') {\n          if (onData) {\n            onData(dataObj.body);\n          }\n        }\n\n        return;\n      }\n\n      if (!dataObj.id && dataObj.channel && dataObj.channel === _this.channel) {\n        if (onData) {\n          onData(dataObj.event);\n        }\n      }\n    };\n    return init();\n  } catch (e) {\n    if (onError) {\n      onError(e);\n    } else {\n      console.warn(e);\n    }\n    return null;\n  }\n}\n\n/**\n * Index Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {String} args.id\n */\nfunction indexApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    type: 'string',\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n  var type = parsedArgs.type,\n      id = parsedArgs.id,\n      body = parsedArgs.body;\n\n\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  delete parsedArgs.id;\n\n  var path = void 0;\n  if (id) {\n    path = type + '/' + encodeURIComponent(id);\n  } else {\n    path = type;\n  }\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n\n/**\n * Get Service\n * @param {Object} args\n * @param {String} args.type\n * @param {String} args.id\n */\nfunction getApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    type: 'string',\n    id: 'string'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      id = parsedArgs.id;\n\n\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n\n  var path = type + '/' + encodeURIComponent(id);\n\n  return this.performFetchRequest({\n    method: 'GET',\n    path: path,\n    params: parsedArgs\n  });\n}\n\n/**\n * Update Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {String} args.id\n */\nfunction updateApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    type: 'string',\n    id: 'string',\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      id = parsedArgs.id,\n      body = parsedArgs.body;\n\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n  delete parsedArgs.body;\n  var path = type + '/' + encodeURIComponent(id) + '/_update';\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n\n/**\n * Delete Service\n * @param {Object} args\n * @param {String} args.type\n * @param {String} args.id\n */\nfunction deleteApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    type: 'string',\n    id: 'string'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      id = parsedArgs.id;\n\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n\n  var path = type + '/' + encodeURIComponent(id);\n\n  return this.performFetchRequest({\n    method: 'DELETE',\n    path: path,\n    params: parsedArgs\n  });\n}\n\n/**\n * Bulk Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\nfunction bulkApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      body = parsedArgs.body;\n\n\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n\n  var path = void 0;\n  if (type) {\n    path = type + '/_bulk';\n  } else {\n    path = '/_bulk';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n\n/**\n * Search Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\nfunction searchApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = void 0;\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type.join();\n  } else {\n    // eslint-disable-next-line\n    type = parsedArgs.type;\n  }\n\n  var body = parsedArgs.body;\n\n\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n\n  var path = void 0;\n  if (type) {\n    path = type + '/_search';\n  } else {\n    path = '_search';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n\n/**\n * Msearch Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\nfunction msearchApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = void 0;\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type.join();\n  } else {\n    type = parsedArgs.type;\n  }\n\n  var body = parsedArgs.body;\n\n\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n\n  var path = void 0;\n  if (type) {\n    path = type + '/_msearch';\n  } else {\n    path = '_msearch';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n\n/**\n * ReactiveSearch API Service for v3\n * @param {Array<Object>} query\n * @param {Object} settings\n * @param {boolean} settings.recordAnalytics\n * @param {boolean} settings.userId\n * @param {boolean} settings.enableQueryRules\n * @param {boolean} settings.customEvents\n */\nfunction reactiveSearchv3Api(query, settings) {\n  var parsedSettings = removeUndefined(settings);\n\n  // Validate query\n  var valid = validateRSQuery(query);\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var body = {\n    settings: parsedSettings,\n    query: query\n  };\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: '_reactivesearch.v3',\n    body: body,\n    isRSAPI: true\n  });\n}\n\n/**\n * Stream Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Boolean} args.stream\n * @param {String} args.id\n * @param {Function} onData\n * @param {Function} onError\n * @param {Function} onClose\n */\nfunction getStream(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    type: 'string',\n    id: 'string'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      id = parsedArgs.id;\n\n\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n  delete parsedArgs.stream;\n\n  if (parsedArgs.stream === true) {\n    parsedArgs.stream = 'true';\n  } else {\n    delete parsedArgs.stream;\n    parsedArgs.streamonly = 'true';\n  }\n\n  for (var _len = arguments.length, rest = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    rest[_key - 1] = arguments[_key];\n  }\n\n  return this.performWsRequest.apply(this, [{\n    method: 'GET',\n    path: type + '/' + encodeURIComponent(id),\n    params: parsedArgs\n  }].concat(rest));\n}\n\n/**\n * Search Stream\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {Boolean} args.stream\n * @param {Function} onData\n * @param {Function} onError\n * @param {Function} onClose\n */\nfunction searchStreamApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  if (parsedArgs.type === undefined || Array.isArray(parsedArgs.type) && parsedArgs.type.length === 0) {\n    throw new Error('Missing fields: type');\n  }\n\n  var type = void 0;\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type.join();\n  } else {\n    type = parsedArgs.type;\n  }\n\n  var body = parsedArgs.body;\n\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  delete parsedArgs.stream;\n\n  parsedArgs.streamonly = 'true';\n\n  for (var _len = arguments.length, rest = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    rest[_key - 1] = arguments[_key];\n  }\n\n  return this.performWsRequest.apply(this, [{\n    method: 'POST',\n    path: type + '/_search',\n    params: parsedArgs,\n    body: body\n  }].concat(rest));\n}\n\n/**\n * Webhook Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {Object} webhook\n * @param {Function} onData\n * @param {Function} onError\n * @param {Function} onClose\n */\nfunction searchStreamToURLApi(args, webhook) {\n  for (var _len = arguments.length, rest = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n    rest[_key - 2] = arguments[_key];\n  }\n\n  var _this = this;\n\n  var parsedArgs = removeUndefined(args);\n  var bodyCopy = parsedArgs.body;\n  var type = void 0;\n  var typeString = void 0;\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  if (parsedArgs.type === undefined || !(typeof parsedArgs.type === 'string' || Array.isArray(parsedArgs.type)) || parsedArgs.type === '' || parsedArgs.type.length === 0) {\n    throw new Error('fields missing: type');\n  }\n\n  valid = validate(parsedArgs.body, {\n    query: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type;\n\n    typeString = parsedArgs.type.join();\n  } else {\n    type = [parsedArgs.type];\n    typeString = parsedArgs.type;\n  }\n\n  var webhooks = [];\n  var _bodyCopy = bodyCopy,\n      query = _bodyCopy.query;\n\n\n  if (typeof webhook === 'string') {\n    var webHookObj = {};\n    webHookObj.url = webhook;\n    webHookObj.method = 'GET';\n    webhooks.push(webHookObj);\n  } else if (webhook.constructor === Array) {\n    webhooks = webhook;\n  } else if (webhook === Object(webhook)) {\n    webhooks.push(webhook);\n  } else {\n    throw new Error('fields missing: second argument(webhook) is necessary');\n  }\n\n  var populateBody = function populateBody() {\n    bodyCopy = {};\n    bodyCopy.webhooks = webhooks;\n    bodyCopy.query = query;\n    bodyCopy.type = type;\n  };\n\n  populateBody();\n\n  var encode64 = btoa(stringify(query));\n  var path = '.percolator/webhooks-0-' + typeString + '-0-' + encode64;\n\n  this.change = function () {\n    webhooks = [];\n\n    if (typeof parsedArgs === 'string') {\n      var webhook2 = {};\n      webhook2.url = parsedArgs;\n      webhook2.method = 'POST';\n      webhooks.push(webhook2);\n    } else if (parsedArgs.constructor === Array) {\n      webhooks = parsedArgs;\n    } else if (parsedArgs === Object(parsedArgs)) {\n      webhooks.push(parsedArgs);\n    } else {\n      throw new Error('fields missing: one of webhook or url fields is required');\n    }\n\n    populateBody();\n\n    return _this.performRequest('POST');\n  };\n  this.stop = function () {\n    bodyCopy = undefined;\n    return _this.performRequest('DELETE');\n  };\n  this.performRequest = function (method) {\n    var res = _this.performWsRequest.apply(_this, [{\n      method: method,\n      path: path,\n      body: bodyCopy\n    }].concat(rest));\n\n    res.change = _this.change;\n    res.stop = _this.stop;\n\n    return res;\n  };\n  return this.performRequest('POST');\n}\n\n/**\n * To get types\n */\nfunction getTypesService() {\n  var _this = this;\n\n  return new Promise(function (resolve, reject) {\n    try {\n      return _this.performFetchRequest({\n        method: 'GET',\n        path: '_mapping'\n      }).then(function (data) {\n        var types = Object.keys(data[_this.app].mappings).filter(function (type) {\n          return type !== '_default_';\n        });\n        return resolve(types);\n      });\n    } catch (e) {\n      return reject(e);\n    }\n  });\n}\n\n/**\n * To get mappings\n */\nfunction getMappings() {\n  return this.performFetchRequest({\n    method: 'GET',\n    path: '_mapping'\n  });\n}\n\n/**\n * ReactiveSearch suggestions API for v3\n * @param {Array<Object>} query\n * @param {Object} settings\n * @param {boolean} settings.recordAnalytics\n * @param {boolean} settings.userId\n * @param {boolean} settings.enableQueryRules\n * @param {boolean} settings.customEvents\n */\nfunction getSuggestionsv3Api(query, settings) {\n  var parsedSettings = removeUndefined(settings);\n\n  // Validate query\n  var valid = validateRSQuery(query, true);\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var body = {\n    settings: parsedSettings,\n    query: query\n  };\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: '_reactivesearch.v3',\n    body: body,\n    isRSAPI: true,\n    isSuggestionsAPI: true\n  });\n}\n\nfunction index (config) {\n  var client = new AppBase(config);\n\n  AppBase.prototype.performFetchRequest = fetchRequest;\n\n  AppBase.prototype.performWsRequest = wsRequest;\n\n  AppBase.prototype.index = indexApi;\n\n  AppBase.prototype.get = getApi;\n\n  AppBase.prototype.update = updateApi;\n\n  AppBase.prototype.delete = deleteApi;\n\n  AppBase.prototype.bulk = bulkApi;\n\n  AppBase.prototype.search = searchApi;\n\n  AppBase.prototype.msearch = msearchApi;\n\n  AppBase.prototype.reactiveSearchv3 = reactiveSearchv3Api;\n\n  AppBase.prototype.getQuerySuggestions = getSuggestionsv3Api;\n\n  AppBase.prototype.getStream = getStream;\n\n  AppBase.prototype.searchStream = searchStreamApi;\n\n  AppBase.prototype.searchStreamToURL = searchStreamToURLApi;\n\n  AppBase.prototype.getTypes = getTypesService;\n\n  AppBase.prototype.getMappings = getMappings;\n\n  AppBase.prototype.setHeaders = function () {\n    var headers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var shouldEncode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n    // Encode headers\n    if (shouldEncode) {\n      this.headers = encodeHeaders(headers);\n    } else {\n      this.headers = headers;\n    }\n  };\n\n  if (typeof window !== 'undefined') {\n    window.Appbase = client;\n  }\n  return client;\n}\n\nexport default index;\n"]},"metadata":{},"sourceType":"module"}