{"ast":null,"code":"Object.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.executeQuery = executeQuery;\nexports.setQueryOptions = setQueryOptions;\nexports.updateQuery = updateQuery;\nexports.loadMore = loadMore;\n\nvar _value = require('./value');\n\nvar _utils = require('./utils');\n\nvar _hits = require('./hits');\n\nvar _misc = require('./misc');\n\nvar _helper = require('../utils/helper');\n\nvar _analytics = require('../utils/analytics');\n\nvar _analytics2 = _interopRequireDefault(_analytics);\n\nvar _maps = require('./maps');\n\nvar _graphQL = require('../utils/graphQL');\n\nvar _graphQL2 = _interopRequireDefault(_graphQL);\n\nvar _constants = require('../utils/constants');\n\nvar _transform = require('../utils/transform');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction msearch(query, orderOfQueries) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var isInternalComponent = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var appendToAggs = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n  var componentType = arguments[5];\n  return function (dispatch, getState) {\n    var _getState = getState(),\n        appbaseRef = _getState.appbaseRef,\n        config = _getState.config,\n        headers = _getState.headers,\n        analytics = _getState.analytics,\n        selectedValues = _getState.selectedValues;\n\n    var searchHeaders = {};\n    var suggestionsComponents = [_constants.componentTypes.dataSearch, _constants.componentTypes.categorySearch];\n    var isSuggestionsQuery = isInternalComponent && suggestionsComponents.indexOf(componentType) !== -1;\n\n    if (config.analytics) {\n      if (config.analyticsConfig.suggestionAnalytics && isSuggestionsQuery) {\n        var suggestionsSearchValue = analytics.suggestionsSearchValue;\n        var shouldIncludeQuery = !!(config.analyticsConfig.emptyQuery || suggestionsSearchValue);\n\n        if (shouldIncludeQuery) {\n          searchHeaders = {\n            'X-Search-Query': suggestionsSearchValue || ''\n          };\n        }\n      } else {\n        var searchValue = analytics.searchValue,\n            searchId = analytics.searchId;\n        var filterString = (0, _analytics2.default)(selectedValues);\n\n        if (searchId) {\n          searchHeaders = _extends({\n            'X-Search-Id': searchId,\n            'X-Search-Query': searchValue || ''\n          }, filterString && {\n            'X-Search-Filters': filterString\n          });\n        } else {\n          var _shouldIncludeQuery = !!(config.analyticsConfig.emptyQuery || searchValue);\n\n          searchHeaders = _extends(_shouldIncludeQuery && {\n            'X-Search-Query': searchValue || ''\n          }, filterString && {\n            'X-Search-Filters': filterString\n          });\n        }\n      }\n\n      if (config.analyticsConfig.searchStateHeader) {\n        var searchState = (0, _helper.getSearchState)(getState(), true);\n\n        if (searchState && Object.keys(searchState).length) {\n          searchHeaders['X-Search-State'] = JSON.stringify(searchState);\n        }\n      }\n\n      if (config.analyticsConfig.userId) {\n        searchHeaders['X-User-Id'] = config.analyticsConfig.userId;\n      }\n\n      if (config.analyticsConfig.customEvents) {\n        searchHeaders['X-Search-CustomEvent'] = (0, _analytics.parseCustomEvents)(config.analyticsConfig.customEvents);\n      }\n    }\n\n    orderOfQueries.forEach(function (component) {\n      dispatch((0, _misc.setLoading)(component, true));\n      dispatch((0, _misc.setError)(component, null));\n    });\n\n    if (config.graphQLUrl) {\n      (0, _graphQL2.default)(config.graphQLUrl, config.url, config.credentials, config.app, query).then(function (res) {\n        (0, _utils.handleResponseMSearch)({\n          res: res,\n          isSuggestionsQuery: isSuggestionsQuery,\n          orderOfQueries: orderOfQueries,\n          appendToHits: appendToHits,\n          appendToAggs: appendToAggs\n        }, getState, dispatch);\n      }).catch(function (err) {\n        (0, _utils.handleError)({\n          orderOfQueries: orderOfQueries,\n          error: err\n        }, getState, dispatch);\n      });\n    } else {\n      appbaseRef.setHeaders(_extends({}, headers, searchHeaders));\n      appbaseRef.msearch({\n        type: config.type === '*' ? '' : config.type,\n        body: query\n      }).then(function (res) {\n        (0, _utils.handleResponseMSearch)({\n          res: res,\n          isSuggestionsQuery: isSuggestionsQuery,\n          orderOfQueries: orderOfQueries,\n          appendToHits: appendToHits,\n          appendToAggs: appendToAggs\n        }, getState, dispatch);\n      }).catch(function (err) {\n        (0, _utils.handleError)({\n          orderOfQueries: orderOfQueries,\n          error: err\n        }, getState, dispatch);\n      });\n    }\n  };\n}\n\nfunction appbaseSearch() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      query = _ref.query,\n      orderOfQueries = _ref.orderOfQueries,\n      _ref$appendToHits = _ref.appendToHits,\n      appendToHits = _ref$appendToHits === undefined ? false : _ref$appendToHits,\n      _ref$isInternalCompon = _ref.isInternalComponent,\n      isInternalComponent = _ref$isInternalCompon === undefined ? false : _ref$isInternalCompon,\n      _ref$appendToAggs = _ref.appendToAggs,\n      appendToAggs = _ref$appendToAggs === undefined ? false : _ref$appendToAggs,\n      componentType = _ref.componentType,\n      _ref$props = _ref.props,\n      props = _ref$props === undefined ? {} : _ref$props,\n      componentId = _ref.componentId;\n\n  return function (dispatch, getState) {\n    var _getState2 = getState(),\n        appbaseRef = _getState2.appbaseRef,\n        config = _getState2.config,\n        headers = _getState2.headers;\n\n    var isAnalyticsEnabled = false;\n\n    if (config) {\n      if ((0, _utils.isPropertyDefined)(config.analytics)) {\n        isAnalyticsEnabled = config.analytics;\n      } else if (config.analyticsConfig) {\n        if ((0, _utils.isPropertyDefined)(config.analyticsConfig.recordAnalytics)) {\n          isAnalyticsEnabled = config.analyticsConfig.recordAnalytics;\n        } else if ((0, _utils.isPropertyDefined)(config.analyticsConfig.analytics)) {\n          isAnalyticsEnabled = config.analyticsConfig.analytics;\n        }\n      }\n    }\n\n    var settings = {\n      recordAnalytics: isAnalyticsEnabled\n    };\n\n    if (config.analyticsConfig) {\n      settings.userId = (0, _utils.isPropertyDefined)(config.analyticsConfig.userId) ? config.analyticsConfig.userId : undefined;\n      settings.enableQueryRules = (0, _utils.isPropertyDefined)(config.analyticsConfig.enableQueryRules) ? config.analyticsConfig.enableQueryRules : undefined;\n      settings.customEvents = (0, _utils.isPropertyDefined)(config.analyticsConfig.customEvents) ? config.analyticsConfig.customEvents : undefined;\n    }\n\n    orderOfQueries.forEach(function (component) {\n      dispatch((0, _misc.setLoading)(component, true));\n      dispatch((0, _misc.setError)(component, null));\n    });\n    appbaseRef.setHeaders(_extends({}, headers));\n    appbaseRef.reactiveSearchv3(query, settings).then(function (res) {\n      var enableQuerySuggestions = props.enableQuerySuggestions;\n\n      if (enableQuerySuggestions) {\n        var suggQuery = (0, _utils.getSuggestionQuery)(getState, componentId);\n        appbaseRef.getQuerySuggestions(suggQuery).then(function (suggestions) {\n          (0, _utils.handleResponse)({\n            res: res,\n            querySuggestions: suggestions,\n            isInternalComponent: isInternalComponent,\n            orderOfQueries: orderOfQueries,\n            appendToHits: appendToHits,\n            appendToAggs: appendToAggs,\n            componentType: componentType,\n            componentId: componentId\n          }, getState, dispatch);\n        }).catch(function (e) {\n          (0, _utils.handleError)({\n            orderOfQueries: orderOfQueries,\n            error: e\n          }, getState, dispatch);\n        });\n      } else {\n        (0, _utils.handleResponse)({\n          res: res,\n          isInternalComponent: isInternalComponent,\n          orderOfQueries: orderOfQueries,\n          appendToHits: appendToHits,\n          appendToAggs: appendToAggs,\n          componentType: componentType,\n          componentId: componentId\n        }, getState, dispatch);\n      }\n    }).catch(function (err) {\n      (0, _utils.handleError)({\n        orderOfQueries: orderOfQueries,\n        error: err\n      }, getState, dispatch);\n    });\n  };\n}\n\nfunction executeQuery(componentId) {\n  var executeWatchList = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var mustExecuteMapQuery = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var componentType = arguments[3];\n  var metaOptions = arguments[4];\n  return function (dispatch, getState) {\n    var _getState3 = getState(),\n        queryLog = _getState3.queryLog,\n        stream = _getState3.stream,\n        appbaseRef = _getState3.appbaseRef,\n        config = _getState3.config,\n        mapData = _getState3.mapData,\n        watchMan = _getState3.watchMan,\n        dependencyTree = _getState3.dependencyTree,\n        queryList = _getState3.queryList,\n        queryOptions = _getState3.queryOptions,\n        queryListener = _getState3.queryListener,\n        props = _getState3.props;\n\n    var componentList = [componentId];\n    var finalQuery = [];\n    var appbaseQuery = {};\n    var orderOfQueries = [];\n    var isAppbaseEnabled = config && config.enableAppbase;\n\n    if (executeWatchList) {\n      var watchList = watchMan[componentId] || [];\n      componentList = [].concat(_toConsumableArray(componentList), _toConsumableArray(watchList));\n    }\n\n    var matchAllQuery = {\n      match_all: {}\n    };\n    componentList.forEach(function (component) {\n      var _buildQuery = (0, _helper.buildQuery)(component, dependencyTree, queryList, queryOptions),\n          queryObj = _buildQuery.queryObj,\n          options = _buildQuery.options;\n\n      var validOptions = ['aggs', 'from', 'sort'];\n\n      if (queryObj && !!Object.keys(queryObj).length || options && Object.keys(options).some(function (item) {\n        return validOptions.includes(item);\n      })) {\n        if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n          queryObj = _extends({}, matchAllQuery);\n        }\n\n        var currentQuery = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var queryToLog = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var oldQuery = queryLog[component];\n\n        if (mustExecuteMapQuery || !(0, _helper.isEqual)(currentQuery, oldQuery)) {\n          orderOfQueries = [].concat(_toConsumableArray(orderOfQueries), [component]);\n          dispatch((0, _misc.logQuery)(component, queryToLog));\n          var isMapComponent = Object.keys(mapData).includes(component);\n\n          if (isMapComponent && mapData[component].query) {\n            var existingQuery = currentQuery.query;\n            currentQuery.query = {\n              bool: {\n                must: [existingQuery, mapData[component].query]\n              }\n            };\n\n            if (!mapData[component].persistMapQuery) {\n              dispatch((0, _maps.updateMapData)(componentId, null, false));\n            }\n\n            var _getState4 = getState(),\n                combinedLog = _getState4.combinedLog;\n\n            if ((0, _helper.isEqual)(combinedLog[component], currentQuery)) return;\n            dispatch((0, _misc.logCombinedQuery)(component, currentQuery));\n          }\n\n          (0, _utils.executeQueryListener)(queryListener[component], oldQuery, currentQuery);\n\n          if (stream[component] && stream[component].status) {\n            if (stream[component].ref) {\n              stream[component].ref.stop();\n            }\n\n            var ref = appbaseRef.searchStream({\n              type: config.type === '*' ? '' : config.type,\n              body: currentQuery\n            }, function (response) {\n              if (response._id) {\n                dispatch((0, _hits.pushToStreamHits)(component, response));\n              }\n            }, function (error) {\n              if (queryListener[component] && queryListener[component].onError) {\n                queryListener[component].onError(error);\n              }\n\n              console.warn(error);\n              dispatch((0, _misc.setError)(component, error));\n              dispatch((0, _misc.setLoading)(component, false));\n            });\n            dispatch((0, _misc.setStreaming)(component, true, ref));\n          }\n\n          if (isAppbaseEnabled) {\n            var query = (0, _transform.getRSQuery)(component, (0, _transform.extractPropsFromState)(getState(), component, metaOptions ? {\n              from: metaOptions.from\n            } : null));\n\n            if (query) {\n              appbaseQuery = _extends({}, appbaseQuery, _defineProperty({}, component, query), (0, _transform.getDependentQueries)(getState(), component, orderOfQueries));\n            }\n          } else {\n            finalQuery = [].concat(_toConsumableArray(finalQuery), [{\n              preference: component\n            }, currentQuery]);\n          }\n        }\n      }\n    });\n\n    if (isAppbaseEnabled) {\n      finalQuery = Object.keys(appbaseQuery).map(function (component) {\n        return appbaseQuery[component];\n      });\n    }\n\n    if (finalQuery.length) {\n      if (isAppbaseEnabled) {\n        dispatch(appbaseSearch({\n          query: finalQuery,\n          orderOfQueries: orderOfQueries,\n          isInternalComponent: componentId.endsWith('__internal'),\n          componentType: componentType,\n          props: props[componentId],\n          componentId: componentId\n        }));\n      } else {\n        dispatch(msearch(finalQuery, orderOfQueries, false, componentId.endsWith('__internal'), undefined, componentType));\n      }\n    }\n  };\n}\n\nfunction setQueryOptions(component, queryOptions) {\n  var execute = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  return function (dispatch) {\n    dispatch((0, _misc.updateQueryOptions)(component, queryOptions));\n\n    if (execute) {\n      dispatch(executeQuery(component, true));\n    }\n  };\n}\n\nfunction updateQuery(_ref2) {\n  var componentId = _ref2.componentId,\n      query = _ref2.query,\n      value = _ref2.value,\n      _ref2$label = _ref2.label,\n      label = _ref2$label === undefined ? null : _ref2$label,\n      _ref2$showFilter = _ref2.showFilter,\n      showFilter = _ref2$showFilter === undefined ? true : _ref2$showFilter,\n      _ref2$URLParams = _ref2.URLParams,\n      URLParams = _ref2$URLParams === undefined ? false : _ref2$URLParams,\n      _ref2$componentType = _ref2.componentType,\n      componentType = _ref2$componentType === undefined ? null : _ref2$componentType,\n      _ref2$category = _ref2.category,\n      category = _ref2$category === undefined ? null : _ref2$category,\n      _ref2$meta = _ref2.meta,\n      meta = _ref2$meta === undefined ? {} : _ref2$meta;\n  var execute = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  return function (dispatch) {\n    var queryToDispatch = query;\n\n    if (query && query.query) {\n      queryToDispatch = query.query;\n    }\n\n    if (!componentId.endsWith('__internal')) {\n      dispatch((0, _value.setValue)(componentId, value, label, showFilter, URLParams, componentType, category, meta));\n\n      if (componentType === _constants.componentTypes.dynamicRangeSlider) {\n        dispatch((0, _value.setInternalValue)((0, _transform.getHistogramComponentID)(componentId), value, componentType, category, meta));\n      } else {\n        dispatch((0, _value.setInternalValue)(componentId + '__internal', value, componentType, category, meta));\n      }\n    } else {\n      dispatch((0, _value.setInternalValue)(componentId, value, componentType, category, meta));\n    }\n\n    dispatch((0, _misc.setQuery)(componentId, queryToDispatch));\n    if (execute) dispatch(executeQuery(componentId, true, false, componentType));\n  };\n}\n\nfunction loadMore(component, newOptions) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var appendToAggs = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  return function (dispatch, getState) {\n    var store = getState();\n\n    var _buildQuery2 = (0, _helper.buildQuery)(component, store.dependencyTree, store.queryList, store.queryOptions),\n        queryObj = _buildQuery2.queryObj,\n        options = _buildQuery2.options;\n\n    var queryLog = store.queryLog;\n    if (!options) options = {};\n    options = _extends({}, options, newOptions);\n\n    if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n      queryObj = {\n        match_all: {}\n      };\n    }\n\n    var currentQuery = _extends({\n      query: _extends({}, queryObj)\n    }, options);\n\n    if ((0, _helper.isEqual)(queryLog[component], currentQuery)) return;\n    dispatch((0, _misc.logQuery)(component, currentQuery));\n\n    if (store.config && store.config.enableAppbase) {\n      var appbaseQuery = {};\n      var componentProps = store.props[component] || {};\n      var compositeAggregationField = componentProps.aggregationField;\n      var queryType = _transform.componentToTypeMap[componentProps.componentType];\n\n      if (queryType === _constants.queryTypes.term) {\n        compositeAggregationField = componentProps.dataField;\n      }\n\n      var query = (0, _transform.getRSQuery)(component, (0, _transform.extractPropsFromState)(store, component, {\n        from: options.from,\n        after: store.aggregations[component] && store.aggregations[component][compositeAggregationField] && store.aggregations[component][compositeAggregationField].after_key || undefined\n      }));\n      appbaseQuery = _extends(_defineProperty({}, component, query), (0, _transform.getDependentQueries)(getState(), component, []));\n      var finalQuery = Object.keys(appbaseQuery).map(function (c) {\n        return appbaseQuery[c];\n      });\n      dispatch(appbaseSearch({\n        query: finalQuery,\n        orderOfQueries: [component],\n        appendToHits: appendToHits,\n        appendToAggs: appendToAggs\n      }));\n    } else {\n      var _finalQuery = [{\n        preference: component\n      }, currentQuery];\n      dispatch(msearch(_finalQuery, [component], appendToHits, false, appendToAggs));\n    }\n  };\n}","map":{"version":3,"sources":["/Users/rogetgeoffroy/Desktop/Folders/react_js_folder/react-live-search-app/live-search/node_modules/@appbaseio/reactivecore/lib/actions/query.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","executeQuery","setQueryOptions","updateQuery","loadMore","_value","require","_utils","_hits","_misc","_helper","_analytics","_analytics2","_interopRequireDefault","_maps","_graphQL","_graphQL2","_constants","_transform","obj","__esModule","default","_defineProperty","enumerable","configurable","writable","_toConsumableArray","arr","Array","isArray","arr2","from","msearch","query","orderOfQueries","appendToHits","undefined","isInternalComponent","appendToAggs","componentType","dispatch","getState","_getState","appbaseRef","config","headers","analytics","selectedValues","searchHeaders","suggestionsComponents","componentTypes","dataSearch","categorySearch","isSuggestionsQuery","indexOf","analyticsConfig","suggestionAnalytics","suggestionsSearchValue","shouldIncludeQuery","emptyQuery","searchValue","searchId","filterString","_shouldIncludeQuery","searchStateHeader","searchState","getSearchState","keys","JSON","stringify","userId","customEvents","parseCustomEvents","forEach","component","setLoading","setError","graphQLUrl","url","credentials","app","then","res","handleResponseMSearch","catch","err","handleError","error","setHeaders","type","body","appbaseSearch","_ref","_ref$appendToHits","_ref$isInternalCompon","_ref$appendToAggs","_ref$props","props","componentId","_getState2","isAnalyticsEnabled","isPropertyDefined","recordAnalytics","settings","enableQueryRules","reactiveSearchv3","enableQuerySuggestions","suggQuery","getSuggestionQuery","getQuerySuggestions","suggestions","handleResponse","querySuggestions","e","executeWatchList","mustExecuteMapQuery","metaOptions","_getState3","queryLog","stream","mapData","watchMan","dependencyTree","queryList","queryOptions","queryListener","componentList","finalQuery","appbaseQuery","isAppbaseEnabled","enableAppbase","watchList","concat","matchAllQuery","match_all","_buildQuery","buildQuery","queryObj","options","validOptions","some","item","includes","currentQuery","queryToLog","oldQuery","isEqual","logQuery","isMapComponent","existingQuery","bool","must","persistMapQuery","updateMapData","_getState4","combinedLog","logCombinedQuery","executeQueryListener","status","ref","stop","searchStream","response","_id","pushToStreamHits","onError","console","warn","setStreaming","getRSQuery","extractPropsFromState","getDependentQueries","preference","map","endsWith","execute","updateQueryOptions","_ref2","_ref2$label","label","_ref2$showFilter","showFilter","_ref2$URLParams","URLParams","_ref2$componentType","_ref2$category","category","_ref2$meta","meta","queryToDispatch","setValue","dynamicRangeSlider","setInternalValue","getHistogramComponentID","setQuery","newOptions","store","_buildQuery2","componentProps","compositeAggregationField","aggregationField","queryType","componentToTypeMap","queryTypes","term","dataField","after","aggregations","after_key","c","_finalQuery"],"mappings":"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","sourcesContent":["Object.defineProperty(exports,\"__esModule\",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.executeQuery=executeQuery;exports.setQueryOptions=setQueryOptions;exports.updateQuery=updateQuery;exports.loadMore=loadMore;var _value=require('./value');var _utils=require('./utils');var _hits=require('./hits');var _misc=require('./misc');var _helper=require('../utils/helper');var _analytics=require('../utils/analytics');var _analytics2=_interopRequireDefault(_analytics);var _maps=require('./maps');var _graphQL=require('../utils/graphQL');var _graphQL2=_interopRequireDefault(_graphQL);var _constants=require('../utils/constants');var _transform=require('../utils/transform');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function msearch(query,orderOfQueries){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var isInternalComponent=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var appendToAggs=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var componentType=arguments[5];return function(dispatch,getState){var _getState=getState(),appbaseRef=_getState.appbaseRef,config=_getState.config,headers=_getState.headers,analytics=_getState.analytics,selectedValues=_getState.selectedValues;var searchHeaders={};var suggestionsComponents=[_constants.componentTypes.dataSearch,_constants.componentTypes.categorySearch];var isSuggestionsQuery=isInternalComponent&&suggestionsComponents.indexOf(componentType)!==-1;if(config.analytics){if(config.analyticsConfig.suggestionAnalytics&&isSuggestionsQuery){var suggestionsSearchValue=analytics.suggestionsSearchValue;var shouldIncludeQuery=!!(config.analyticsConfig.emptyQuery||suggestionsSearchValue);if(shouldIncludeQuery){searchHeaders={'X-Search-Query':suggestionsSearchValue||''};}}else{var searchValue=analytics.searchValue,searchId=analytics.searchId;var filterString=(0,_analytics2.default)(selectedValues);if(searchId){searchHeaders=_extends({'X-Search-Id':searchId,'X-Search-Query':searchValue||''},filterString&&{'X-Search-Filters':filterString});}else{var _shouldIncludeQuery=!!(config.analyticsConfig.emptyQuery||searchValue);searchHeaders=_extends(_shouldIncludeQuery&&{'X-Search-Query':searchValue||''},filterString&&{'X-Search-Filters':filterString});}}if(config.analyticsConfig.searchStateHeader){var searchState=(0,_helper.getSearchState)(getState(),true);if(searchState&&Object.keys(searchState).length){searchHeaders['X-Search-State']=JSON.stringify(searchState);}}if(config.analyticsConfig.userId){searchHeaders['X-User-Id']=config.analyticsConfig.userId;}if(config.analyticsConfig.customEvents){searchHeaders['X-Search-CustomEvent']=(0,_analytics.parseCustomEvents)(config.analyticsConfig.customEvents);}}orderOfQueries.forEach(function(component){dispatch((0,_misc.setLoading)(component,true));dispatch((0,_misc.setError)(component,null));});if(config.graphQLUrl){(0,_graphQL2.default)(config.graphQLUrl,config.url,config.credentials,config.app,query).then(function(res){(0,_utils.handleResponseMSearch)({res:res,isSuggestionsQuery:isSuggestionsQuery,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs},getState,dispatch);}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});}else{appbaseRef.setHeaders(_extends({},headers,searchHeaders));appbaseRef.msearch({type:config.type==='*'?'':config.type,body:query}).then(function(res){(0,_utils.handleResponseMSearch)({res:res,isSuggestionsQuery:isSuggestionsQuery,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs},getState,dispatch);}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});}};}function appbaseSearch(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},query=_ref.query,orderOfQueries=_ref.orderOfQueries,_ref$appendToHits=_ref.appendToHits,appendToHits=_ref$appendToHits===undefined?false:_ref$appendToHits,_ref$isInternalCompon=_ref.isInternalComponent,isInternalComponent=_ref$isInternalCompon===undefined?false:_ref$isInternalCompon,_ref$appendToAggs=_ref.appendToAggs,appendToAggs=_ref$appendToAggs===undefined?false:_ref$appendToAggs,componentType=_ref.componentType,_ref$props=_ref.props,props=_ref$props===undefined?{}:_ref$props,componentId=_ref.componentId;return function(dispatch,getState){var _getState2=getState(),appbaseRef=_getState2.appbaseRef,config=_getState2.config,headers=_getState2.headers;var isAnalyticsEnabled=false;if(config){if((0,_utils.isPropertyDefined)(config.analytics)){isAnalyticsEnabled=config.analytics;}else if(config.analyticsConfig){if((0,_utils.isPropertyDefined)(config.analyticsConfig.recordAnalytics)){isAnalyticsEnabled=config.analyticsConfig.recordAnalytics;}else if((0,_utils.isPropertyDefined)(config.analyticsConfig.analytics)){isAnalyticsEnabled=config.analyticsConfig.analytics;}}}var settings={recordAnalytics:isAnalyticsEnabled};if(config.analyticsConfig){settings.userId=(0,_utils.isPropertyDefined)(config.analyticsConfig.userId)?config.analyticsConfig.userId:undefined;settings.enableQueryRules=(0,_utils.isPropertyDefined)(config.analyticsConfig.enableQueryRules)?config.analyticsConfig.enableQueryRules:undefined;settings.customEvents=(0,_utils.isPropertyDefined)(config.analyticsConfig.customEvents)?config.analyticsConfig.customEvents:undefined;}orderOfQueries.forEach(function(component){dispatch((0,_misc.setLoading)(component,true));dispatch((0,_misc.setError)(component,null));});appbaseRef.setHeaders(_extends({},headers));appbaseRef.reactiveSearchv3(query,settings).then(function(res){var enableQuerySuggestions=props.enableQuerySuggestions;if(enableQuerySuggestions){var suggQuery=(0,_utils.getSuggestionQuery)(getState,componentId);appbaseRef.getQuerySuggestions(suggQuery).then(function(suggestions){(0,_utils.handleResponse)({res:res,querySuggestions:suggestions,isInternalComponent:isInternalComponent,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs,componentType:componentType,componentId:componentId},getState,dispatch);}).catch(function(e){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:e},getState,dispatch);});}else{(0,_utils.handleResponse)({res:res,isInternalComponent:isInternalComponent,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs,componentType:componentType,componentId:componentId},getState,dispatch);}}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});};}function executeQuery(componentId){var executeWatchList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var mustExecuteMapQuery=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var componentType=arguments[3];var metaOptions=arguments[4];return function(dispatch,getState){var _getState3=getState(),queryLog=_getState3.queryLog,stream=_getState3.stream,appbaseRef=_getState3.appbaseRef,config=_getState3.config,mapData=_getState3.mapData,watchMan=_getState3.watchMan,dependencyTree=_getState3.dependencyTree,queryList=_getState3.queryList,queryOptions=_getState3.queryOptions,queryListener=_getState3.queryListener,props=_getState3.props;var componentList=[componentId];var finalQuery=[];var appbaseQuery={};var orderOfQueries=[];var isAppbaseEnabled=config&&config.enableAppbase;if(executeWatchList){var watchList=watchMan[componentId]||[];componentList=[].concat(_toConsumableArray(componentList),_toConsumableArray(watchList));}var matchAllQuery={match_all:{}};componentList.forEach(function(component){var _buildQuery=(0,_helper.buildQuery)(component,dependencyTree,queryList,queryOptions),queryObj=_buildQuery.queryObj,options=_buildQuery.options;var validOptions=['aggs','from','sort'];if(queryObj&&!!Object.keys(queryObj).length||options&&Object.keys(options).some(function(item){return validOptions.includes(item);})){if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj=_extends({},matchAllQuery);}var currentQuery=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var queryToLog=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var oldQuery=queryLog[component];if(mustExecuteMapQuery||!(0,_helper.isEqual)(currentQuery,oldQuery)){orderOfQueries=[].concat(_toConsumableArray(orderOfQueries),[component]);dispatch((0,_misc.logQuery)(component,queryToLog));var isMapComponent=Object.keys(mapData).includes(component);if(isMapComponent&&mapData[component].query){var existingQuery=currentQuery.query;currentQuery.query={bool:{must:[existingQuery,mapData[component].query]}};if(!mapData[component].persistMapQuery){dispatch((0,_maps.updateMapData)(componentId,null,false));}var _getState4=getState(),combinedLog=_getState4.combinedLog;if((0,_helper.isEqual)(combinedLog[component],currentQuery))return;dispatch((0,_misc.logCombinedQuery)(component,currentQuery));}(0,_utils.executeQueryListener)(queryListener[component],oldQuery,currentQuery);if(stream[component]&&stream[component].status){if(stream[component].ref){stream[component].ref.stop();}var ref=appbaseRef.searchStream({type:config.type==='*'?'':config.type,body:currentQuery},function(response){if(response._id){dispatch((0,_hits.pushToStreamHits)(component,response));}},function(error){if(queryListener[component]&&queryListener[component].onError){queryListener[component].onError(error);}console.warn(error);dispatch((0,_misc.setError)(component,error));dispatch((0,_misc.setLoading)(component,false));});dispatch((0,_misc.setStreaming)(component,true,ref));}if(isAppbaseEnabled){var query=(0,_transform.getRSQuery)(component,(0,_transform.extractPropsFromState)(getState(),component,metaOptions?{from:metaOptions.from}:null));if(query){appbaseQuery=_extends({},appbaseQuery,_defineProperty({},component,query),(0,_transform.getDependentQueries)(getState(),component,orderOfQueries));}}else{finalQuery=[].concat(_toConsumableArray(finalQuery),[{preference:component},currentQuery]);}}}});if(isAppbaseEnabled){finalQuery=Object.keys(appbaseQuery).map(function(component){return appbaseQuery[component];});}if(finalQuery.length){if(isAppbaseEnabled){dispatch(appbaseSearch({query:finalQuery,orderOfQueries:orderOfQueries,isInternalComponent:componentId.endsWith('__internal'),componentType:componentType,props:props[componentId],componentId:componentId}));}else{dispatch(msearch(finalQuery,orderOfQueries,false,componentId.endsWith('__internal'),undefined,componentType));}}};}function setQueryOptions(component,queryOptions){var execute=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return function(dispatch){dispatch((0,_misc.updateQueryOptions)(component,queryOptions));if(execute){dispatch(executeQuery(component,true));}};}function updateQuery(_ref2){var componentId=_ref2.componentId,query=_ref2.query,value=_ref2.value,_ref2$label=_ref2.label,label=_ref2$label===undefined?null:_ref2$label,_ref2$showFilter=_ref2.showFilter,showFilter=_ref2$showFilter===undefined?true:_ref2$showFilter,_ref2$URLParams=_ref2.URLParams,URLParams=_ref2$URLParams===undefined?false:_ref2$URLParams,_ref2$componentType=_ref2.componentType,componentType=_ref2$componentType===undefined?null:_ref2$componentType,_ref2$category=_ref2.category,category=_ref2$category===undefined?null:_ref2$category,_ref2$meta=_ref2.meta,meta=_ref2$meta===undefined?{}:_ref2$meta;var execute=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return function(dispatch){var queryToDispatch=query;if(query&&query.query){queryToDispatch=query.query;}if(!componentId.endsWith('__internal')){dispatch((0,_value.setValue)(componentId,value,label,showFilter,URLParams,componentType,category,meta));if(componentType===_constants.componentTypes.dynamicRangeSlider){dispatch((0,_value.setInternalValue)((0,_transform.getHistogramComponentID)(componentId),value,componentType,category,meta));}else{dispatch((0,_value.setInternalValue)(componentId+'__internal',value,componentType,category,meta));}}else{dispatch((0,_value.setInternalValue)(componentId,value,componentType,category,meta));}dispatch((0,_misc.setQuery)(componentId,queryToDispatch));if(execute)dispatch(executeQuery(componentId,true,false,componentType));};}function loadMore(component,newOptions){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var appendToAggs=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return function(dispatch,getState){var store=getState();var _buildQuery2=(0,_helper.buildQuery)(component,store.dependencyTree,store.queryList,store.queryOptions),queryObj=_buildQuery2.queryObj,options=_buildQuery2.options;var queryLog=store.queryLog;if(!options)options={};options=_extends({},options,newOptions);if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj={match_all:{}};}var currentQuery=_extends({query:_extends({},queryObj)},options);if((0,_helper.isEqual)(queryLog[component],currentQuery))return;dispatch((0,_misc.logQuery)(component,currentQuery));if(store.config&&store.config.enableAppbase){var appbaseQuery={};var componentProps=store.props[component]||{};var compositeAggregationField=componentProps.aggregationField;var queryType=_transform.componentToTypeMap[componentProps.componentType];if(queryType===_constants.queryTypes.term){compositeAggregationField=componentProps.dataField;}var query=(0,_transform.getRSQuery)(component,(0,_transform.extractPropsFromState)(store,component,{from:options.from,after:store.aggregations[component]&&store.aggregations[component][compositeAggregationField]&&store.aggregations[component][compositeAggregationField].after_key||undefined}));appbaseQuery=_extends(_defineProperty({},component,query),(0,_transform.getDependentQueries)(getState(),component,[]));var finalQuery=Object.keys(appbaseQuery).map(function(c){return appbaseQuery[c];});dispatch(appbaseSearch({query:finalQuery,orderOfQueries:[component],appendToHits:appendToHits,appendToAggs:appendToAggs}));}else{var _finalQuery=[{preference:component},currentQuery];dispatch(msearch(_finalQuery,[component],appendToHits,false,appendToAggs));}};}"]},"metadata":{},"sourceType":"script"}